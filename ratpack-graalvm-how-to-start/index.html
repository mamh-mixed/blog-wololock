<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="Szymon Stepniak"><meta name="robots" content="index, follow"><meta name="keywords" content="java,ratpack,non-blocking,graalvm,native-image"><title>Ratpack on GraalVM - how to start?</title><meta name="description" content="The journey inside the exciting world of GraalVM continues. Today I would like to share with you  results of running Ratpack on GraalVM experiment. You are going to learn how to build a native binary"><meta property="og:type" content="article"><meta property="og:title" content="Ratpack on GraalVM - how to start?"><meta property="og:url" content="https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/"><meta property="og:site_name" content="Szymon Stepniak - I want to help you to become a better software developer"><meta property="og:description" content="The journey inside the exciting world of GraalVM continues. Today I would like to share with you  results of running Ratpack on GraalVM experiment. You are going to learn how to build a native binary"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2019-02-15T02:10:39.000Z"><meta property="article:modified_time" content="2019-11-09T20:02:09.000Z"><meta property="article:author" content="Szymon Stepniak"><meta property="article:tag" content="java"><meta property="article:tag" content="ratpack"><meta property="article:tag" content="non-blocking"><meta property="article:tag" content="graalvm"><meta property="article:tag" content="native-image"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@wololock"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//cdn.jsdelivr.net"><link rel="canonical" href="https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,700;1,400;1,700&amp;family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;family=Montserrat:wght@300;400;700&amp;family=DM+Mono:wght@400;500&amp;family=Poppins:wght@500;700;800&amp;family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"><link rel="stylesheet" href="/css/main.css?v=74"><link rel="stylesheet" href="/css/highlight.css?v=74"><link rel="shortcut icon" type="image/png" href="/favicon_new.png"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":["Person","Organization"],"@id":"https://e.printstacktrace.blog/#/schema/person/wololock","name":"Szymon Stepniak","description":"I want to help you to become a better software developer.","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/#avatar","inLanguage":"en-US","url":"https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200","caption":"Szymon Stepniak"},"logo":{"@id":"https://e.printstacktrace.blog/#avatar"},"sameAs":["https://twitter.com/wololock","https://github.com/wololock","https://stackoverflow.com/users/2194470/szymon-stepniak","https://www.youtube.com/c/eprintstacktrace"]},{"@type":"WebSite","@id":"https://e.printstacktrace.blog/#website","url":"https://e.printstacktrace.blog","name":"Szymon Stepniak - I want to help you to become a better software developer","description":"Blog about programming, created by Upwork's Top Rated freelancer, 10+ years experienced Java/Groovy developer. Contact me if you are looking for an experienced and high quality consultant."},{"@type":"WebPage","@id":"https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#webpage","url":"https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/","name":"Ratpack on GraalVM - how to start?","isPartOf":{"@id":"https://e.printstacktrace.blog/#website"},"datePublished":"2019-02-15T02:10:39.000Z","dateModified":"2019-11-09T20:02:09.000Z","description":"\nThe journey inside the exciting world of GraalVM continues.\nToday I would like to share with you  results of running Ratpack on GraalVM experiment.\nYou are going to learn how to build a native binary of a simple \"Hello, World!\" Ratpack application.\nIn the end we are going to run some benchmarks to see if running GraalVM executable produces better results than running JAR on a regular Oracle JDK.\n","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/"]}]},{"@type":"Article","@id":"https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#article","isPartOf":{"@id":"https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#webpage"},"author":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"headline":"Ratpack on GraalVM - how to start?","datePublished":"2019-02-15T02:10:39.000Z","dateModified":"2019-11-09T20:02:09.000Z","mainEntityOfPage":{"@id":"https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#webpage"},"publisher":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"keywords":"java,ratpack,non-blocking,graalvm,native-image","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#primaryimage","url":"https://e.printstacktrace.blog/images/cards/19.png","inLanguage":"en-US","caption":"Ratpack on GraalVM - how to start?"},"inLanguage":"en-US"},{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://e.printstacktrace.blog"},{"@type":"ListItem","position":2,"name":"Ratpack Cookbook","item":"https://e.printstacktrace.blog/ratpack-cookbook/"},{"@type":"ListItem","position":3,"name":"Ratpack on GraalVM - how to start?"}]}]}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Szymon Stepniak - I want to help you to become a better software developer" type="application/atom+xml">
<style>.img-lazyload-container{overflow:hidden;max-width:100%}.img-lazyload-container img{max-width:100%;display:block;height:auto;transition:opacity .5s ease-in-out}.img-lazyload-container img:not([src]){height:0;opacity:0}</style></head><body><header class="fixed-top" id="header"><div class="container"><nav class="navbar navbar-expand-lg px-0 py-lg-0 navbar-dark"><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarLinks" aria-controls="navbarLinks"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarLinks"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link gatr" href="/" data-type="nav" data-name="Home">Home</a></li><li class="nav-item"><a class="nav-link gatr" href="/about/" data-type="nav" data-name="About Me">About Me</a></li><li class="nav-item"><a class="nav-link gatr" href="/youtube/" target="_blank" data-type="nav" data-name="Videos">Videos</a></li><li class="nav-item"><a class="nav-link gatr" href="/archives/" data-type="nav" data-name="Archives">Archives</a></li><li class="nav-item"><a class="nav-link gatr" href="/resources/" data-type="nav" data-name="Resources">Resources</a></li><li class="nav-item"><a class="nav-link gatr" href="/upwork/" target="_blank" data-type="nav" data-name="Hire me">Hire me</a></li></ul></div></nav></div></header><div id="pageprogress"><div class="bar"></div></div><main id="main"><article class="post"><div class="jumbotron pt-lg-5 pb-1"><div class="container pt-lg-5"><div class="row py-5"><div class="order-0 col-lg-12"><div class="pr-lg-5"><p class="subtitle m-0 p-0"><a class="category" href="/ratpack-cookbook/">Ratpack Cookbook</a></p><h1 class="mt-0 mb-2">Ratpack on GraalVM - how to start?</h1><div class="lead my-4"><div class="paragraph"><p>The journey inside the exciting world of <a target="_blank" rel="noopener" href="https://www.graalvm.org/">GraalVM</a> continues. Today I would like to share with you results of running <a target="_blank" rel="noopener" href="https://ratpack.io/">Ratpack</a> on GraalVM experiment. You are going to learn how to build a native binary of a simple "Hello, World!" Ratpack application. In the end we are going to run some benchmarks to see if running GraalVM executable produces better results than running JAR on a regular Oracle JDK.</p></div></div><ul class="post-meta-extended"><li class="d-none d-lg-inline-block"><a href="/about"><img class="rounded-circle" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" height="52" width="52" style="margin-top:-24px"></a></li><li><div class="small">Author</div><div class="font-weight-bold"><a href="/about">Szymon Stepniak</a></div></li><li><div class="small">Published</div><div class="font-weight-bold"><time datetime="2019-02-15T02:10:39.000Z">Feb 15, 2019</time></div></li><li><div class="small">Reading time</div><div class="font-weight-bold">18 minutes</div></li><li><div class="small">Discussion</div><div class="font-weight-bold"><a href="https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#disqus_thread">0 Comments</a></div></li></ul></div></div></div></div></div><div class="container py-5"><a id="more"></a><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">The source code of <em>ratpack-graalvm-demo</em> application can be found here <a target="_blank" rel="noopener" href="https://github.com/wololock/ratpack-graalvm-demo">wololock/ratpack-graalvm-demo</a></td></tr></table></div><div class="sect1"><h2 id="prerequisites">Prerequisites</h2><div class="sectionbody"><div class="paragraph"><p>Below you can find information about the GraalVM and Ratpack versions I used in the experiment:</p></div><div class="ulist"><ul><li><p><strong>GraalVM</strong> 19.2.1 (the most recent version available while writing this blog post)</p></li><li><p><strong>Ratpack</strong> 1.7.5</p></li></ul></div><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">Don&#8217;t know how to install GraalVM on your machine? With SDKMAN! installing GraalVM is as easy as executing the following command in the console <code>sdk install java 19.2.1.-grl</code>.</td></tr></table></div></div></div><div class="sect1"><h2 id="hello-world-application">Hello World application</h2><div class="sectionbody"><div class="paragraph"><p>We start the experiments with the most straightforward possible application - a good old Hello World app.</p></div><div class="listingblock"><div class="title">Listing 1. src/main/java/com/github/wololock/RatpackGraalDemoApp.java</div><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.github.wololock;

import ratpack.server.RatpackServer;

import java.util.HashMap;
import java.util.Map;

import static ratpack.jackson.Jackson.json;

final class RatpackGraalDemoApp &#123;

    public static void main(String[] args) throws Exception &#123;
        final Map&lt;String, String&gt; message = new HashMap&lt;&gt;();
        message.put("message", "Hello, World!");

        RatpackServer.start(server -&gt;
                server.serverConfig(config -&gt; config.sysProps().development(false))
                        .handlers(chain -&gt; chain.get(ctx -&gt; ctx.render(json(message))))
        );
    &#125;
&#125;</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You can bootstrap Ratpack app using Lazybones - <code>lazybones create ratpack your-app-name</code>.</td></tr></table></div><div class="paragraph"><p>When we send an HTTP request to the <code>localhost:5050</code> we get the following response:</p></div><div class="listingblock"><div class="title">Listing 2. HTTP response of <code>(GET) localhost:5050</code> request</div><div class="content"><pre class="highlightjs highlight"><code class="language-http hljs" data-lang="http">HTTP/1.1 200 OK
content-encoding: gzip
content-type: application/json
transfer-encoding: chunked

&#123;
    "message": "Hello, World!"
&#125;</code></pre></div></div></div></div><div class="sect1"><h2 id="preparing-for-graalvm">Preparing for GraalVM</h2><div class="sectionbody"><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">GraalVM specific configuration got simplified enormously starting from Ratpack <code>1.7.0</code> release. This is the first version that used Netty <code>4.1.37</code>. Netty started providing <code>native-image.properties</code> and <code>reflection.json</code> files with version <code>4.1.36</code> which means that Netty-based applications does not have to configure Netty components for the GraalVM native image generation. This is a huge step forward.</td></tr></table></div><div class="paragraph"><p>We need to do some additional work to prepare our <em>"Hello World"</em> application for GraalVM.</p></div><div class="sect2"><h3 id="1-reflection-configuration">1. Reflection configuration</h3><div class="paragraph"><p>We start with preparing a configuration file for classes used via Java reflection mechanism. GraalVM uses <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/tree/master/substratevm">Substrate VM</a> - a framework that allows aggressive ahead-of-time optimizations. All classes, methods or fields accessed via reflection have to be known at the compile time to make AOT compilation possible. Substrate VM resolves most of the basic reflection calls like <code>Class.forName(&#8230;&#8203;)</code>, but in more complex scenarios it requires additional information to be provided. In Ratpack basic "Hello World" application case we need to configure reflection access to the following two Caffeine Cache classes.</p></div><div class="listingblock"><div class="title">Listing 3. reflections.json</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  &#123;
    "name": "com.github.benmanes.caffeine.cache.SSMS",
    "methods": [
      &#123;
        "name": "&lt;init&gt;",
        "parameterTypes": ["com.github.benmanes.caffeine.cache.Caffeine", "com.github.benmanes.caffeine.cache.CacheLoader", "boolean"]
      &#125;
    ]
  &#125;,
  &#123;
    "name": "com.github.benmanes.caffeine.cache.PSMS",
    "methods": [
      &#123;
        "name": "&lt;init&gt;"
      &#125;
    ]
  &#125;
]</code></pre></div></div><div class="paragraph"><p>In the case of our demo app we need to provide information about these 3 classes. <code>SSMS</code> and <code>PSMS</code> are Caffeine caching library generated classes that are used to initialize paths handler internal cache.</p></div></div><div class="sect2"><h3 id="2-dynamic-proxies-configuration">2. Dynamic proxies configuration</h3><div class="paragraph"><p>To make dependency injection via Guice possible, we need to <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/blob/master/substratevm/DYNAMIC_PROXY.md#manual-configuration">generate dynamic proxies</a> at the compile time. It requires defining a list of interfaces that dynamic proxies implement. In our case, we only have to configure <code>java.lang.reflect.TypeVariable</code> interface.</p></div><div class="listingblock"><div class="title">Listing 4. proxies.json</div><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  ["java.lang.reflect.TypeVariable"]
]</code></pre></div></div></div><div class="sect2"><h3 id="3-unsafe-memory-access-configuration">3. Unsafe memory access configuration</h3><div class="paragraph"><p>Using <code>sun.misc.Unsafe</code> in Substrate VM generates <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md#unsafe-memory-access">other limitations</a>. As Codrut Stancu explains in the <a target="_blank" rel="noopener" href="https://medium.com/graalvm/instant-netty-startup-using-graalvm-native-image-generation-ed6f14ff7692"><em>"Instant Netty Startup using GraalVM Native Image Generation"</em></a> article:</p></div><div class="quoteblock"><blockquote><div class="paragraph"><p>"Unsafe memory access through the <code>sun.misc.Unsafe</code> API is allowed in native executables, but field offset, array base offset, array index scale, and array index shift values need to be re-computed. These values are usually computed in the static initializer of a class and stored in static final fields. Static initializers are executed during build time, i.e., when the <code>native-image</code> tool runs. This means that the static fields store the field offsets computed by the JVM. However, Substrate VM uses a different object layout than the JVM, so using the values directly would access wrong memory locations. That leads to undefined behavior at run time. If you are lucky, your application crashes with a segmentation fault, if you are unlucky it just computes the wrong result.</p></div></blockquote></div><div class="paragraph"><p>In case of the simple "Hello World" Ratpack web application, there is one such class - <code>com.github.benmanes.caffeine.cache.UnsafeRefArrayAccess</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>. We can instruct Substrate VM to recompute <code>UnsafeRefArrayAccess.REF_ELEMENT_SHIFT</code> field by adding the following static class to our main application class.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.github.wololock;

import com.oracle.svm.core.annotate.Alias;
import com.oracle.svm.core.annotate.RecomputeFieldValue;
import com.oracle.svm.core.annotate.TargetClass;
import ratpack.server.RatpackServer;

import java.util.HashMap;
import java.util.Map;

import static ratpack.jackson.Jackson.json;

final class RatpackGraalDemoApp &#123;

    public static void main(String[] args) throws Exception &#123;
        final Map&lt;String, String&gt; message = new HashMap&lt;&gt;();
        message.put("message", "Hello, World!");

        RatpackServer.start(server -&gt;
                server.serverConfig(config -&gt; config.sysProps().development(false))
                        .handlers(chain -&gt; chain.get(ctx -&gt; ctx.render(json(message))))
        );
    &#125;

    @TargetClass(className = "com.github.benmanes.caffeine.cache.UnsafeRefArrayAccess")
    static final class Target_com_github_benmanes_caffeine_cache_UnsafeRefArrayAccess &#123;
        @Alias
        @RecomputeFieldValue(kind = RecomputeFieldValue.Kind.ArrayIndexShift, declClass = Object[].class)
        public static int REF_ELEMENT_SHIFT;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>In this case we are using <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/com.oracle.substratevm/svm">Substrate VM SDK</a> library which is added to our <code>build.gradle</code> file:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">buildscript &#123;
    repositories &#123;
        jcenter()
    &#125;
    dependencies &#123;
        classpath "io.ratpack:ratpack-gradle:1.7.5"
        classpath "com.github.jengelman.gradle.plugins:shadow:5.1.0"
    &#125;
&#125;

apply plugin: "io.ratpack.ratpack-java"
apply plugin: "com.github.johnrengelman.shadow"
apply plugin: "idea"

repositories &#123;
    jcenter()
&#125;

mainClassName = 'com.github.wololock.RatpackGraalDemoApp'

dependencies &#123;
    runtime 'org.slf4j:slf4j-simple:1.7.25'

    compile 'com.oracle.substratevm:svm:19.2.1' <i class="conum" data-value="1"></i><b>(1)</b>

    testCompile "org.spockframework:spock-core:1.0-groovy-2.4"
&#125;</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Substrate VM SDK dependency.</td></tr></table></div></div></div></div><div class="sect1"><h2 id="building-native-binary">Building native binary</h2><div class="sectionbody"><div class="paragraph"><p>We are finally ready to compile native binary. We use the <code>native-image</code> command with the following parameters:</p></div><div class="listingblock"><div class="title">Listing 5. build-native-image.sh</div><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">native-image --no-server \
    -jar build/libs/ratpack-graalvm-demo-all.jar \
    -H:Name=ratpack-graalvm-demo \
    -H:ReflectionConfigurationFiles=reflections.json \
    -H:DynamicProxyConfigurationFiles=proxies.json \
    --no-fallback \
    --enable-url-protocols=http \
    --report-unsupported-elements-at-runtime \
    --allow-incomplete-classpath \
    --initialize-at-run-time=io.netty.handler.codec.http.HttpObjectEncoder,io.netty.handler.ssl.ReferenceCountedOpenSslEngine,io.netty.handler.ssl.ReferenceCountedOpenSslClientContext,io.netty.handler.ssl.ReferenceCountedOpenSslServerContext,io.netty.handler.ssl.JdkNpnApplicationProtocolNegotiator,io.netty.handler.ssl.JettyNpnSslEngine,io.netty.handler.ssl.ConscryptAlpnSslEngine,io.netty.util.internal.logging.Log4JLogger,io.netty.internal.tcnative.CertificateVerifier,io.netty.internal.tcnative.SSL \
    --initialize-at-build-time \
    -Dratpack.epoll.disable=true <i class="conum" data-value="1"></i><b>(1)</b></code></pre></div></div><div class="paragraph"><p>As you can see in <em class="conum" data-value="1"></em> we disabled Epoll transport to use NIO instead. The reason for that is because <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md#java-native-interface-jni">JNI support is limited</a> and at least at the moment all tries to run Ratpack with Epoll transport on Linux ends with the following exception:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">[main] INFO ratpack.server.RatpackServer - Starting server...
Exception in thread "main" ratpack.api.UncheckedException: java.lang.reflect.InvocationTargetException
	at ratpack.util.Exceptions.uncheck(Exceptions.java:54)
	at ratpack.util.internal.TransportDetector$NativeTransportImpl.eventLoopGroup(TransportDetector.java:229)
	at ratpack.util.internal.TransportDetector$NativeTransport.eventLoopGroup(TransportDetector.java:133)
	at ratpack.util.internal.TransportDetector.eventLoopGroup(TransportDetector.java:65)
	at ratpack.exec.internal.DefaultExecController.&lt;init&gt;(DefaultExecController.java:61)
	at ratpack.server.internal.DefaultRatpackServer.start(DefaultRatpackServer.java:126)
	at ratpack.server.RatpackServer.start(RatpackServer.java:93)
	at com.github.wololock.RatpackGraalDemoApp.main(RatpackGraalDemoApp.java:12)
Caused by: java.lang.reflect.InvocationTargetException
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at ratpack.util.internal.TransportDetector$NativeTransportImpl.eventLoopGroup(TransportDetector.java:227)
	... 6 more
Caused by: java.lang.UnsatisfiedLinkError: io.netty.channel.epoll.Native.epollCreate()I [symbol: Java_io_netty_channel_epoll_Native_epollCreate or Java_io_netty_channel_epoll_Native_epollCreate__]
	at com.oracle.svm.jni.access.JNINativeLinkage.getOrFindEntryPoint(JNINativeLinkage.java:145)
	at com.oracle.svm.jni.JNIGeneratedMethodSupport.nativeCallAddress(JNIGeneratedMethodSupport.java:54)
	at io.netty.channel.epoll.Native.epollCreate(Native.java)
	at io.netty.channel.epoll.Native.newEpollCreate(Native.java:107)
	at io.netty.channel.epoll.EpollEventLoop.&lt;init&gt;(EpollEventLoop.java:100)
	at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:135)
	at io.netty.channel.epoll.EpollEventLoopGroup.newChild(EpollEventLoopGroup.java:35)
	at io.netty.util.concurrent.MultithreadEventExecutorGroup.&lt;init&gt;(MultithreadEventExecutorGroup.java:84)
	at io.netty.util.concurrent.MultithreadEventExecutorGroup.&lt;init&gt;(MultithreadEventExecutorGroup.java:58)
	at io.netty.util.concurrent.MultithreadEventExecutorGroup.&lt;init&gt;(MultithreadEventExecutorGroup.java:47)
	at io.netty.channel.MultithreadEventLoopGroup.&lt;init&gt;(MultithreadEventLoopGroup.java:59)
	at io.netty.channel.epoll.EpollEventLoopGroup.&lt;init&gt;(EpollEventLoopGroup.java:104)
	at io.netty.channel.epoll.EpollEventLoopGroup.&lt;init&gt;(EpollEventLoopGroup.java:91)
	at io.netty.channel.epoll.EpollEventLoopGroup.&lt;init&gt;(EpollEventLoopGroup.java:68)</code></pre></div></div><div class="paragraph"><p>I will be exploring Epoll support and will post an update when get the working example of Ratpack application with Epoll transport on GraalVM.</p></div></div></div><div class="sect1"><h2 id="running-the-application">Running the application</h2><div class="sectionbody"><div class="paragraph"><p>At this point, we have <code>ratpack-graalvm-demo</code> binary file compiled and ready to use.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ratpack-graalvm-demo [master] % ls -lah ratpack-graalvm-demo
-rwxrwxr-x. 1 wololock wololock 24M 02-15 04:25 ratpack-graalvm-demo</code></pre></div></div><div class="paragraph"><p>As you can see a single <code>ratpack-graalvm-demo</code> file is 24 MB size. Let&#8217;s run it and execute HTTP request to see if it works.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">ratpack-graalvm-demo [master] % ./ratpack-graalvm-demo
[main] INFO ratpack.server.RatpackServer - Starting server...
[main] INFO ratpack.server.RatpackServer - Building registry...
[main] INFO ratpack.server.RatpackServer - Ratpack started for http://localhost:5050</code></pre></div></div><div class="paragraph"><p>The first thing you will notice is that the server is ready almost instantly. Ratpack application run on a regular JVM starts quickly (in about 550-600 milliseconds), but this one starts in a blink of an eye.</p></div><div class="paragraph"><p>Let&#8217;s try to measure startup time of regular Java and GraalVM Ratpack application. I&#8217;m going to add <code>System.exit(0)</code> at the end of the <code>main</code> method, so the application shuts down right after it becomes ready to handle HTTP connections.</p></div><script id="asciicast-227675" src="https://asciinema.org/a/227675.js" async></script><div class="paragraph"><p>The difference is <strong>HUGE</strong>! Let&#8217;s compare best results - GraalVM&#8217;s best <strong>10</strong> milliseconds result versus Oracle JDK&#8217;s best <strong>581</strong> milliseconds result. It makes the difference.</p></div></div></div><div class="sect1"><h2 id="benchmark">Benchmark</h2><div class="sectionbody"><div class="paragraph"><p>Application startup time is one thing. It&#8217;s time to run a more critical comparison test. Let&#8217;s compare the throughput of both, GraalVM and Oracle JDK runtime environments.</p></div><div class="paragraph"><p>We will start with a small number of requests so that the Oracle JDK won’t have enough time to warm up properly. In this test, we use <a target="_blank" rel="noopener" href="https://httpd.apache.org/docs/2.4/programs/ab.html">Apache Bench</a> tool, and we execute 200 concurrent requests with a total of 1000 requests. Let’s start with GraalVM.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">~ % ab -c 200 -n 1000 http://localhost:5050/
This is ApacheBench, Version 2.3 &lt;$Revision: 1826891 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking localhost (be patient)
Completed 100 requests
Completed 200 requests
Completed 300 requests
Completed 400 requests
Completed 500 requests
Completed 600 requests
Completed 700 requests
Completed 800 requests
Completed 900 requests
Completed 1000 requests
Finished 1000 requests


Server Software:
Server Hostname:        localhost
Server Port:            5050

Document Path:          /
Document Length:        27 bytes

Concurrency Level:      200
Time taken for tests:   0.090 seconds
Complete requests:      1000
Failed requests:        0
Total transferred:      117000 bytes
HTML transferred:       27000 bytes
Requests per second:    11153.00 [#/sec] (mean)
Time per request:       17.932 [ms] (mean)
Time per request:       0.090 [ms] (mean, across all concurrent requests)
Transfer rate:          1274.32 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    4   1.2      4       6
Processing:     1    7   4.8      5      22
Waiting:        1    6   4.7      4      19
Total:          6   11   4.2      9      23

Percentage of the requests served within a certain time (ms)
  50%      9
  66%      9
  75%     10
  80%     12
  90%     20
  95%     22
  98%     22
  99%     22
 100%     23 (longest request)</code></pre></div></div><div class="paragraph"><p>That was fast. Now let&#8217;s see regular Oracle JDK in action.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">I start demo application with the following command <code>java -jar build/libs/ratpack-graalvm-demo-all.jar -Dratpack.epoll.disable=true</code></td></tr></table></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">ab -c 200 -n 1000 http://localhost:5050/
This is ApacheBench, Version 2.3 &lt;$Revision: 1826891 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking localhost (be patient)
Completed 100 requests
Completed 200 requests
Completed 300 requests
Completed 400 requests
Completed 500 requests
Completed 600 requests
Completed 700 requests
Completed 800 requests
Completed 900 requests
Completed 1000 requests
Finished 1000 requests


Server Software:
Server Hostname:        localhost
Server Port:            5050

Document Path:          /
Document Length:        27 bytes

Concurrency Level:      200
Time taken for tests:   0.335 seconds
Complete requests:      1000
Failed requests:        0
Total transferred:      117000 bytes
HTML transferred:       27000 bytes
Requests per second:    2985.77 [#/sec] (mean)
Time per request:       66.984 [ms] (mean)
Time per request:       0.335 [ms] (mean, across all concurrent requests)
Transfer rate:          341.15 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0    1   1.8      0       7
Processing:     5   29  13.3     25      98
Waiting:        5   29  13.3     25      94
Total:          5   30  13.7     25      98

Percentage of the requests served within a certain time (ms)
  50%     25
  66%     31
  75%     36
  80%     39
  90%     47
  95%     56
  98%     70
  99%     83
 100%     98 (longest request)</code></pre></div></div><div class="paragraph"><p>The difference between the cold Oracle JDK and GraalVM is enormous:</p></div><div class="ulist"><ul><li><p><strong>17.93</strong> ms vs. <strong>66.98</strong> ms mean time per request in GraalVM' favour.</p></li><li><p><strong>11153</strong> vs. <strong>2985</strong> requests per second in GraalVM&#8217;s favour.</p></li></ul></div><div class="paragraph"><p>However, let’s be fair - Oracle JDK shows its full potential when JIT jumps in and runs its optimizations. In the next round, we will let it warm up correctly and then we can compare the results. We will run 800 concurrent requests with a total of 500,000 requests, and we are going to do it twice - the first run is used to warm up the JVM so that we take only the second result into account. Let&#8217;s start with GraalVM.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">ab -c 800 -n 500000 http://localhost:5050/
This is ApacheBench, Version 2.3 &lt;$Revision: 1826891 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking localhost (be patient)
Completed 50000 requests
Completed 100000 requests
Completed 150000 requests
Completed 200000 requests
Completed 250000 requests
Completed 300000 requests
Completed 350000 requests
Completed 400000 requests
Completed 450000 requests
Completed 500000 requests
Finished 500000 requests


Server Software:
Server Hostname:        localhost
Server Port:            5050

Document Path:          /
Document Length:        27 bytes

Concurrency Level:      800
Time taken for tests:   40.725 seconds
Complete requests:      500000
Failed requests:        0
Total transferred:      58500000 bytes
HTML transferred:       13500000 bytes
Requests per second:    12277.48 [#/sec] (mean)
Time per request:       65.160 [ms] (mean)
Time per request:       0.081 [ms] (mean, across all concurrent requests)
Transfer rate:          1402.80 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0   37 110.8     25    3130
Processing:     3   28   9.4     27     117
Waiting:        0   18   8.3     17      90
Total:         18   65 112.0     55    3156

Percentage of the requests served within a certain time (ms)
  50%     55
  66%     61
  75%     63
  80%     64
  90%     68
  95%     72
  98%     84
  99%   1072
 100%   3156 (longest request)</code></pre></div></div><div class="paragraph"><p>Now let&#8217;s do the same with Oracle JDK.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">ab -c 800 -n 500000 http://localhost:5050/
This is ApacheBench, Version 2.3 &lt;$Revision: 1826891 $&gt;
Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking localhost (be patient)
Completed 50000 requests
Completed 100000 requests
Completed 150000 requests
Completed 200000 requests
Completed 250000 requests
Completed 300000 requests
Completed 350000 requests
Completed 400000 requests
Completed 450000 requests
Completed 500000 requests
Finished 500000 requests


Server Software:
Server Hostname:        localhost
Server Port:            5050

Document Path:          /
Document Length:        27 bytes

Concurrency Level:      800
Time taken for tests:   35.889 seconds
Complete requests:      500000
Failed requests:        0
Total transferred:      58500000 bytes
HTML transferred:       13500000 bytes
Requests per second:    13931.95 [#/sec] (mean)
Time per request:       57.422 [ms] (mean)
Time per request:       0.072 [ms] (mean, across all concurrent requests)
Transfer rate:          1591.83 [Kbytes/sec] received

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:        0   28   8.1     27    1034
Processing:     2   30   7.7     30     249
Waiting:        0   17   6.9     16     242
Total:          6   57   5.3     57    1065

Percentage of the requests served within a certain time (ms)
  50%     57
  66%     58
  75%     59
  80%     60
  90%     62
  95%     64
  98%     66
  99%     68
 100%   1065 (longest request)</code></pre></div></div><div class="paragraph"><p>It looks like if we give Oracle JDK enough time to warm up, it runs a little bit more efficient than the GraalVM application. Take a look at these two charts to see the main difference.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-fluid shadow d-inline-block"><div class="content"><a class="image" href="/images/ratpack-graalvm-rps-benchmark.png"><div class="img-lazyload-container" style="width:598px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/ratpack-graalvm-rps-benchmark.png" height="370" width="598" style="padding-top:61.87290969899666%"></div></a></div></div></div></div><div class="paragraph"><p>If we compare RPS between cold Oracle JDK and GraalVM, there is no doubt that GraalVM does better. However, if we only give a regular Oracle JDK a chance to warm up, it turns out that it can handle almost 1700 more requests. It&#8217;s a significant difference.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-fluid shadow d-inline-block"><div class="content"><a class="image" href="/images/ratpack-graalvm-latency-benchmark.png"><div class="img-lazyload-container" style="width:596px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/ratpack-graalvm-latency-benchmark.png" height="368" width="596" style="padding-top:61.74496644295302%"></div></a></div></div></div></div><div class="paragraph"><p>Latency benchmark also reveals interesting details. GraalVM wins when we compare it to cold Oracle JDK, and we let both applications handle reasonably small traffic (200 requests with a total of 1000). When we increase the number of concurrent requests to 800, and we need to handle the total of 500,000 requests, warmed up Oracle JDK works much better. While GraalVM slows down to the ~65ms per request when we increase the traffic, Oracle JDK speeds up to ~57ms per request.</p></div><div class="paragraph"><p>There are also two things worth mentioning. I&#8217;ve tried to execute more concurrent requests, but it turned out that GraalVM starts throwing <code>IOException</code> when I increased the number of concurrent requests to 1,000.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">[main] INFO ratpack.server.RatpackServer - Starting server...
[main] INFO ratpack.server.RatpackServer - Building registry...
[main] INFO ratpack.server.RatpackServer - Ratpack started for http://localhost:5050
[ratpack-compute-2-1] WARN io.netty.channel.DefaultChannelPipeline - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.
java.io.IOException: Accept failed
	at com.oracle.svm.core.posix.PosixJavaNIOSubstitutions$Util_sun_nio_ch_ServerSocketChannelImpl.accept0(PosixJavaNIOSubstitutions.java:1261)
	at sun.nio.ch.ServerSocketChannelImpl.accept0(ServerSocketChannelImpl.java:1188)
	at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:422)
	at sun.nio.ch.ServerSocketChannelImpl.accept(ServerSocketChannelImpl.java:250)
	at io.netty.util.internal.SocketUtils$5.run(SocketUtils.java:110)
	at io.netty.util.internal.SocketUtils$5.run(SocketUtils.java:107)
	at java.security.AccessController.doPrivileged(AccessController.java:82)
	at io.netty.util.internal.SocketUtils.accept(SocketUtils.java:107)
	at io.netty.channel.socket.nio.NioServerSocketChannel.doReadMessages(NioServerSocketChannel.java:143)
	at io.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:75)
	at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:656)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeysPlain(NioEventLoop.java:556)
	at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:510)
	at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:470)
	at io.netty.util.concurrent.SingleThreadEventExecutor$5.run(SingleThreadEventExecutor.java:909)
	at ratpack.exec.internal.DefaultExecController$ExecControllerBindingThreadFactory.lambda$newThread$0(DefaultExecController.java:137)
	at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)
	at java.lang.Thread.run(Thread.java:748)
	at com.oracle.svm.core.thread.JavaThreads.threadStartRoutine(JavaThreads.java:481)
	at com.oracle.svm.core.posix.thread.PosixJavaThreads.pthreadStartRoutine(PosixJavaThreads.java:193)</code></pre></div></div><div class="paragraph"><p>Oracle JDK at the same time was able to handle 1,000 concurrent requests without any issue.</p></div><div class="paragraph"><p>And the last thing - memory consumption. GraalVM does much better when it comes to memory consumption right after the startup - the demo application consumes around 30 MB after startup on GraalVM and about 90 MB when running on Oracle JDK. However, when the application starts handling firsts requests, memory consumptions jumps significantly - GraalVM consumes around 300 MB, while Oracle JDK consumes around 150 MB only.</p></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>I must admit that the final benchmark results surprised me a bit. This demo application is not a rock-solid proof - if we used much larger and much more complicated Ratpack application, we could get completely different results. It proved that in some use cases Ratpack application does not need GraalVM to run fast. GraalVM may offer much faster startup, but fine-tuned and adequately warmed up JDK may perform much better in terms of metrics like RPS or latency in milliseconds.</p></div><div class="paragraph"><p>Summary:</p></div><div class="ulist"><ul><li><p>GraalVM runs much faster compared to cold JDK. This is a good news for things like FaaS or running non-daemon like programs - you don&#8217;t have to wait until JIT does it job to optimize runtime environment.</p></li><li><p>GraalVM seems to allocate much more memory while running the demo program. It starts with much smaller memory footprint at the beginning, but when the benchmark is over, Oracle JDK consumed around 170 MB while GraalVM was consuming ~300 MB of the memory.</p></li></ul></div><div class="paragraph"><p>I hope you learned something new from this blog post. I’m pleased I have finally run the Ratpack example on GraalVM. It took me hours to make it running, and I almost gave up, but I couldn&#8217;t accept the failure. The final result makes me happy even more. It’s 06:03 AM. Time to go to sleep. See you soon!</p></div></div></div><div class="sect1"><h2 id="updates">Updates</h2><div class="sectionbody"><div class="paragraph"><p>This blog gets updated whenever new version of GraalVM or Groovy gets released. Below you can find a list of all updates.</p></div><div class="ulist"><ul><li><p><strong class="mark">2019-11-07</strong>: Updated blog post to <strong>GraalVM</strong> <code>19.2.1</code> and <strong>Ratpack</strong> <code>1.7.5</code></p></li></ul></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a target="_blank" rel="noopener" href="https://github.com/ben-manes/caffeine/blob/v2.6.2/caffeine/src/main/java/com/github/benmanes/caffeine/cache/MpscGrowableArrayQueue.java#L594" class="bare">https://github.com/ben-manes/caffeine/blob/v2.6.2/caffeine/src/main/java/com/github/benmanes/caffeine/cache/MpscGrowableArrayQueue.java#L594</a></div></div></div></article><section id="share"><div class="container pb-5"><div class="row justify-content-between align-items-center"><div class="col-lg"><p class="font-size-5 text-uppercase mb-0">Did you like this article?</p><h3 class="mb-lg-0 mt-0">Consider buying me a coffee</h3></div><div class="col-auto buttons"><div class="pt-lg-4"><a class="align-middle mr-2 gatr" href="/buy-me-a-coffee/" target="_blank"><img data-lazy="/images/buy-me-a-coffee.png" height="32"></a><iframe class="align-middle gatr" src="https://github.com/sponsors/wololock/button" title="Sponsor wololock" height="35" width="116" style="border:0"></iframe></div></div></div></div></section><section id="related" data-debug="Scrolled to related posts"><div class="featured-post py-5"><div class="container py-3"><div class="row"><div class="col-12"><div class="row"><div class="col-lg-8 order-0"><div class="pr-5"><p class="subtitle m-0 p-0"><a class="category" href="/groovy-cookbook/">Groovy Cookbook</a></p><h3 class="mt-0 mb-2">Continue reading: <a href="/graalvm-native-image-inside-docker-container-does-it-make-sense/">"GraalVM native image inside docker container - does it make sense?"</a></h3><div class="my-4"><div class="paragraph"><p>We have learned how to create <a target="_blank" rel="noopener" href="https://www.graalvm.org/">GraalVM</a> native image from standalone Groovy script <a href="/graalvm-groovy-grape-creating-native-image-of-standalone-script/" title="in the previous blog post">in the previous blog post</a>. Today we continue the experiments, and this time we are going to create a <a target="_blank" rel="noopener" href="https://www.docker.com/why-docker">Docker</a> image to see what are the benefits and drawbacks of this solution.</p></div><a href="/graalvm-native-image-inside-docker-container-does-it-make-sense/">Read more<i class="fas fa-arrow-right ml-2"></i></a></div><ul class="post-meta-extended"><li class="d-none d-lg-inline-block"><a href="/about"><img class="rounded-circle" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" height="52" width="52" style="margin-top:-24px"></a></li><li><div class="small">Author</div><div class="font-weight-bold"><a href="/about">Szymon Stepniak</a></div></li><li><div class="small">Published</div><div class="font-weight-bold"><time datetime="2019-01-19T12:19:22.000Z">Jan 19, 2019</time></div></li><li><div class="small">Reading time</div><div class="font-weight-bold">6 minutes</div></li><li><div class="small">Discussion</div><div class="font-weight-bold"><a href="https://e.printstacktrace.blog/graalvm-native-image-inside-docker-container-does-it-make-sense/#disqus_thread">0 Comments</a></div></li></ul></div></div><div class="col-lg-4 order-1 d-none d-lg-block"><a href="/graalvm-native-image-inside-docker-container-does-it-make-sense/"><img class="img-fluid rounded" data-lazy="/images/cards/32.png" style="margin-bottom:-300px"></a></div></div></div></div></div></div><div class="remaining"><div class="container py-5"><div class="row"><div class="col-md-4"><div class="card card-sm rounded border-0 card-post" data-read="6 min read"><div class="card-header p-0 position-relative rounded"><img class="card-img-top rounded" data-lazy="/images/cards/29.png"><div class="card-img-overlay d-flex align-items-end p-3 rounded"><h4 class="card-title">GraalVM and heap size of the native image - how to set it?</h4></div><div class="mask rounded"></div></div><div class="card-body small p-1"><a class="stretched-link" href="/graalvm-heap-size-of-native-image-how-to-set-it/"></a></div></div></div><div class="col-md-4"><div class="card card-sm rounded border-0 card-post" data-read="21 min read"><div class="card-header p-0 position-relative rounded"><img class="card-img-top rounded" data-lazy="/images/cards/29.png"><div class="card-img-overlay d-flex align-items-end p-3 rounded"><h4 class="card-title">GraalVM and Groovy - how to start?</h4></div><div class="mask rounded"></div></div><div class="card-body small p-1"><a class="stretched-link" href="/graalvm-and-groovy-how-to-start/"></a></div></div></div><div class="col-md-4"><div class="card card-sm rounded border-0 card-post" data-read="14 min read"><div class="card-header p-0 position-relative rounded"><img class="card-img-top rounded" data-lazy="/images/cards/8.png"><div class="card-img-overlay d-flex align-items-end p-3 rounded"><h4 class="card-title">Building stackoverflow-cli with Java 11, Micronaut, Picocli, and GraalVM</h4></div><div class="mask rounded"></div></div><div class="card-body small p-1"><a class="stretched-link" href="/building-stackoverflow-cli-with-java-11-micronaut-picocli-and-graalvm/"></a></div></div></div></div></div></div></section><section id="comments"><div class="container py-5" data-debug="Scrolled to comments"><h2 class="disqus-comment-count" data-disqus-url="https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/">0 Comments</h2><div class="row"><div class="col-12 col-lg-3 order-lg-1 order-0"><div class="sticky-top" style="top:40px"><a class="gatr" href="https://grammarly.go2cloud.org/aff_c?offer_id=182&amp;aff_id=89563" data-type="banner" data-name="grammarly-01" target="_blank"><img class="d-none img-fluid d-lg-inline-block" data-lazy="/images/yml/grammarly-tower.png"></a></div></div><div class="col-12 col-lg-9 order-0 order-lg-0 order-1"><div id="disqus_thread"></div></div></div></div><script>const loadDisqus=e=>{var s,r;t=document,(s=t.createElement("script")).src="https://"+e+".disqus.com/embed.js",s.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(s)},disqusObserver=new IntersectionObserver(e=>{e.forEach(e=>{var t,s,r;e.intersectionRatio>0&&(t="eprintstacktrace",s=document,(r=s.createElement("script")).src="https://"+t+".disqus.com/embed.js",r.setAttribute("data-timestamp",+new Date),(s.head||s.body).appendChild(r),disqusObserver.unobserve(e.target))})});disqusObserver.observe(document.getElementById("disqus_thread"))</script></section></main><footer id="footer" data-debug="Scrolled to footer"><div class="container py-3 pt-5"><div class="row"><div class="col-12 col-lg-3"><h5>Popular categories</h5><ul class="list-unstyled list-categories"><li class="mb-2"><a class="gatr" href="/groovy-cookbook/" data-type="footer-category" data-name="Groovy Cookbook">Groovy Cookbook<span class="count ml-2 text-muted small">30</span></a></li><li class="mb-2"><a class="gatr" href="/jenkins-pipeline-cookbook/" data-type="footer-category" data-name="Jenkins Pipeline Cookbook">Jenkins Pipeline Cookbook<span class="count ml-2 text-muted small">9</span></a></li><li class="mb-2"><a class="gatr" href="/programmers-bookshelf/" data-type="footer-category" data-name="Programmer's Bookshelf">Programmer's Bookshelf<span class="count ml-2 text-muted small">6</span></a></li><li class="mb-2"><a class="gatr" href="/micronaut-cookbook/" data-type="footer-category" data-name="Micronaut Cookbook">Micronaut Cookbook<span class="count ml-2 text-muted small">4</span></a></li><li class="mb-2"><a class="gatr" href="/ratpack-cookbook/" data-type="footer-category" data-name="Ratpack Cookbook">Ratpack Cookbook<span class="count ml-2 text-muted small">4</span></a></li><li class="mb-2"><a class="gatr" href="/learning-java/" data-type="footer-category" data-name="Learning Java">Learning Java<span class="count ml-2 text-muted small">4</span></a></li><li class="mb-2"><a class="gatr" href="/jq-cookbook/" data-type="footer-category" data-name="jq cookbook">jq cookbook<span class="count ml-2 text-muted small">3</span></a></li><li class="mb-2"><a class="gatr" href="/how-to/" data-type="footer-category" data-name="How to">How to<span class="count ml-2 text-muted small">3</span></a></li><li class="mb-2"><a class="gatr" href="/blog-reports/" data-type="footer-category" data-name="Blog Reports">Blog Reports<span class="count ml-2 text-muted small">2</span></a></li></ul></div><div class="col-12 col-lg-5 latest-posts"><h5 class="mb-4">Latest posts</h5><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/these-10-new-features-make-groovy-4-0-awesome/" data-type="latest-sidebar" data-name="These 10 New Features Make Groovy 4.0 AWESOME!"><img class="rounded" src="/images/icons/groovy-4.0.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/these-10-new-features-make-groovy-4-0-awesome/" data-type="latest-sidebar" data-name="These 10 New Features Make Groovy 4.0 AWESOME!">These 10 New Features Make Groovy 4.0 AWESOME!</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2022-04-14T12:38:23.000Z">April 14, 2022</time></li><li>8 min. read</li><li><a href="https://e.printstacktrace.blog/these-10-new-features-make-groovy-4-0-awesome/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/how-to-generate-random-password-in-groovy/" data-type="latest-sidebar" data-name="How to generate a random password in Groovy?"><img class="rounded" src="/images/icons/28.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/how-to-generate-random-password-in-groovy/" data-type="latest-sidebar" data-name="How to generate a random password in Groovy?">How to generate a random password in Groovy?</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2022-02-14T11:44:06.000Z">February 14, 2022</time></li><li>2 min. read</li><li><a href="https://e.printstacktrace.blog/how-to-generate-random-password-in-groovy/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/merging-json-files-recursively-in-the-command-line/" data-type="latest-sidebar" data-name="Merging JSON files recursively in the command-line"><img class="rounded" src="/images/icons/jq-merge-json.jpg" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/merging-json-files-recursively-in-the-command-line/" data-type="latest-sidebar" data-name="Merging JSON files recursively in the command-line">Merging JSON files recursively in the command-line</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-11-05T22:14:35.000Z">November 5, 2020</time></li><li>1 min. read</li><li><a href="https://e.printstacktrace.blog/merging-json-files-recursively-in-the-command-line/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/jenkins-declarative-pipeline-dynamic-agent/" data-type="latest-sidebar" data-name="Jenkins Declarative Pipeline with the dynamic agent - how to configure it?"><img class="rounded" src="/images/icons/50.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/jenkins-declarative-pipeline-dynamic-agent/" data-type="latest-sidebar" data-name="Jenkins Declarative Pipeline with the dynamic agent - how to configure it?">Jenkins Declarative Pipeline with the dynamic agent - how to configure it?</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-09-27T07:32:11.000Z">September 27, 2020</time></li><li>1 min. read</li><li><a href="https://e.printstacktrace.blog/jenkins-declarative-pipeline-dynamic-agent/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)"><img class="rounded" src="/images/icons/3.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)">Groovy Ecosystem Usage Report (2020)</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-09-13T05:40:19.000Z">September 13, 2020</time></li><li>4 min. read</li><li><a href="https://e.printstacktrace.blog/groovy-ecosystem-usage-report-2020/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/how-to-convert-json-to-csv-from-the-command-line/" data-type="latest-sidebar" data-name="How to convert JSON to CSV from the command-line?"><img class="rounded" src="/images/icons/4.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/how-to-convert-json-to-csv-from-the-command-line/" data-type="latest-sidebar" data-name="How to convert JSON to CSV from the command-line?">How to convert JSON to CSV from the command-line?</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-08-25T18:44:31.000Z">August 25, 2020</time></li><li>3 min. read</li><li><a href="https://e.printstacktrace.blog/how-to-convert-json-to-csv-from-the-command-line/#disqus_thread">0 Comments</a></li></ul></div></div></div></div><div class="col-12 col-lg-4"><h5>Popular tags</h5><div class="tags-cloud"><a href="/t/affiliate/" style="font-size:.8em;color:#6881a5">affiliate</a> <a href="/t/async/" style="font-size:.8em;color:#778196">async</a> <a href="/t/benchmark/" style="font-size:.8em;color:#6f819d">benchmark</a> <a href="/t/book/" style="font-size:.8em;color:#6081ac">book</a> <a href="/t/cicd/" style="font-size:.8em;color:#5082ba">cicd</a> <a href="/t/curl/" style="font-size:.8em;color:#6f819d">curl</a> <a href="/t/devops/" style="font-size:.8em;color:#5882b3">devops</a> <a href="/t/docker/" style="font-size:.8em;color:#6f819d">docker</a> <a href="/t/github/" style="font-size:.8em;color:#778196">github</a> <a href="/t/graalvm/" style="font-size:.8em;color:#5082ba">graalvm</a> <a href="/t/grails/" style="font-size:.8em;color:#778196">grails</a> <a href="/t/groovy/" style="font-size:.8em;color:#3982d0">groovy</a> <a href="/t/haskell/" style="font-size:.8em;color:#778196">haskell</a> <a href="/t/java/" style="font-size:.8em;color:#4182c9">java</a> <a href="/t/java-8/" style="font-size:.8em;color:#778196">java-8</a> <a href="/t/jenkins/" style="font-size:.8em;color:#4982c2">jenkins</a> <a href="/t/jenkins-pipeline/" style="font-size:.8em;color:#4982c2">jenkins-pipeline</a> <a href="/t/jmh/" style="font-size:.8em;color:#6881a5">jmh</a> <a href="/t/jq/" style="font-size:.8em;color:#6f819d">jq</a> <a href="/t/json/" style="font-size:.8em;color:#6f819d">json</a> <a href="/t/junit/" style="font-size:.8em;color:#778196">junit</a> <a href="/t/learning/" style="font-size:.8em;color:#6f819d">learning</a> <a href="/t/micronaut/" style="font-size:.8em;color:#6081ac">micronaut</a> <a href="/t/native-image/" style="font-size:.8em;color:#6881a5">native-image</a> <a href="/t/non-blocking/" style="font-size:.8em;color:#6f819d">non-blocking</a> <a href="/t/ratpack/" style="font-size:.8em;color:#5082ba">ratpack</a> <a href="/t/reactive-programming/" style="font-size:.8em;color:#778196">reactive-programming</a> <a href="/t/reading/" style="font-size:.8em;color:#778196">reading</a> <a href="/t/recursion/" style="font-size:.8em;color:#778196">recursion</a> <a href="/t/review/" style="font-size:.8em;color:#6081ac">review</a> <a href="/t/rxjava/" style="font-size:.8em;color:#778196">rxjava</a> <a href="/t/sdkman/" style="font-size:.8em;color:#6f819d">sdkman</a> <a href="/t/spock/" style="font-size:.8em;color:#6f819d">spock</a> <a href="/t/stackoverflow/" style="font-size:.8em;color:#778196">stackoverflow</a> <a href="/t/string/" style="font-size:.8em;color:#6f819d">string</a> <a href="/t/unit-test/" style="font-size:.8em;color:#6f819d">unit-test</a></div><div class="mt-5"><a class="gatr" href="https://click.linksynergy.com/deeplink?id=uow2LCEuhvQ&amp;mid=39197&amp;murl=https%3A%2F%2Fwww.udemy.com%2Ftopic%2Fdevops%2F" data-type="banner" data-name="udemy-devops-01" target="_blank"><img class="d-none img-fluid d-lg-inline-block d-md-inline-block" data-lazy="/images/yml/udemy-devops-01.png"></a></div></div></div></div><div class="border-top border-dark py-4 footer-bottom"><div class="container"><div class="justify-content-between d-flex"><div class="links"><ul><li><a class="gatr" href="/about/" data-type="footer-link" data-name="About">About</a></li><li><a class="gatr" href="/archives/" data-type="footer-link" data-name="Archives">Archives</a></li><li><a class="gatr" href="/resources/" data-type="footer-link" data-name="Resources">Resources</a></li><li><a class="gatr" href="/privacy-policy/" data-type="footer-link" data-name="Privacy Policy">Privacy Policy</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://kit.co/wololock" data-type="footer-link" data-name="My Kit">My Kit</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://feeds.feedburner.com/Eprintstacktracenet" data-type="footer-link" data-name="RSS">RSS</a></li></ul></div><div class="socials"><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://twitter.com/wololock"><i class="fa fa-twitter"></i></a></li><li><a target="_blank" rel="noopener" href="https://youtube.com/eprintstacktrace"><i class="fa fa-youtube"></i></a></li><li><a target="_blank" rel="noopener" href="https://github.com/wololock"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile"><i class="fa fa-stack-overflow"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/szymon-st%C4%99pniak-9a0b1630/"><i class="fa fa-linkedin"></i></a></li></ul></div></div></div></div></footer><script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/48c5da59c9.js" crossorigin="anonymous" async></script><script async id="cookiebanner" src="//cdnjs.cloudflare.com/ajax/libs/cookie-banner/1.2.2/cookiebanner.min.js" data-moreinfo="/privacy-policy/" data-message="This blog uses cookies to enhance your experience. By continuing to visit it you agree to its use of cookies." data-link="#5fc4ff" data-font-family="Lora,serif" data-font-size="16px" data-bg="#1d2b36"></script><script src="/js/main.js?v=12"></script><script src="/js/highlightjs/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script async id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><script>!function(e,a,t,n,c,i,g){e.GoogleAnalyticsObject=c,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=a.createElement(t),g=a.getElementsByTagName(t)[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",g.parentNode.insertBefore(i,g)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"),jQuery(document).on("mousedown",".gatr",(function(e){var a=jQuery(this),t=a.attr("data-type"),n=a.attr("data-name"),c=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event",t,c,n),!1}))</script><script>!function(){"use strict";function r(e){var t=e.getAttribute("data-original"),n=new Image;n.onload=function(){e.setAttribute("src",t),e.style.paddingTop=""},n.src=t}document.addEventListener("DOMContentLoaded",function(){var t,e,n,i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));i.length&&("undefined"!=typeof IntersectionObserver?(t=new IntersectionObserver(function(e,t){e.filter(function(e){return e.isIntersecting}).forEach(function(e){r(e.target),t.unobserve(e.target)})}),i.forEach(function(e){t.observe(e)})):(n=function(){clearTimeout(e),e=setTimeout(function(){return(i=i.filter(function(e){return!e.src})).length?void i.filter(function(e){e.getBoundingClientRect().top<window.innerHeight&&r(e)}):(window.removeEventListener("scroll",n),void window.removeEventListener("resize",n))},100)},window.addEventListener("scroll",n),window.addEventListener("resize",n),n()))},!1)}();</script></body></html>