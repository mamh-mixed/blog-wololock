<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="robots" content="all"><meta name="ir-site-verification-token" value="626123791"><title>GraalVM and Groovy - how to start?</title><meta name="keywords" content="java,groovy,graalvm,native-image"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//stackpath.bootstrapcdn.com"><link rel="shortcut icon" type="image/png" href="/favicon_new.png"><link rel="canonical" href="https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:wght@400;500;700|Poppins:300,400,400i,700|Montserrat:400,600,700|Roboto:300,400,400i,700|Lora:400,400i,700,700i&amp;display=swap"><link rel="stylesheet" href="//stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous"><link rel="stylesheet" href="/css/main.css?v=71"><link rel="stylesheet" href="/css/highlight.css?v=71"><meta name="description" content="GraalVM became one of the most popular topics in the JVM ecosystem. It promises the highest possible speed of running JVM-based programs (when compiled to native images), hand in hand with the smalle"><meta property="og:type" content="article"><meta property="og:title" content="GraalVM and Groovy - how to start?"><meta property="og:url" content="https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/"><meta property="og:site_name" content="e.printstacktrace.blog - I help you become a better software developer."><meta property="og:description" content="GraalVM became one of the most popular topics in the JVM ecosystem. It promises the highest possible speed of running JVM-based programs (when compiled to native images), hand in hand with the smalle"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://e.printstacktrace.blog/images/cards/29.png"><meta property="article:published_time" content="2018-10-03T21:28:49.000Z"><meta property="article:modified_time" content="2019-11-22T21:14:49.000Z"><meta property="article:author" content="Szymon Stepniak"><meta property="article:tag" content="java"><meta property="article:tag" content="groovy"><meta property="article:tag" content="graalvm"><meta property="article:tag" content="native-image"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://e.printstacktrace.blog/images/cards/29.png"><meta name="twitter:creator" content="@wololock"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":["Person","Organization"],"@id":"https://e.printstacktrace.blog/#/schema/person/wololock","name":"Szymon Stepniak","description":"I help you become a better software developer.","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/#avatar","inLanguage":"en-US","url":"https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200","caption":"Szymon Stepniak"},"logo":{"@id":"https://e.printstacktrace.blog/#avatar"},"sameAs":["https://twitter.com/wololock","https://github.com/wololock","https://stackoverflow.com/users/2194470/szymon-stepniak","https://www.youtube.com/c/eprintstacktrace"]},{"@type":"WebSite","@id":"https://e.printstacktrace.blog/#website","url":"https://e.printstacktrace.blog","name":"e.printstacktrace.blog - I help you become a better software developer.","description":"Blog about programming, created by Upwork's Top Rated freelancer, 10+ years experienced Java/Groovy developer. Contact me if you are looking for an experienced and high quality consultant."},{"@type":"WebPage","@id":"https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/#webpage","url":"https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/","name":"GraalVM and Groovy - how to start?","isPartOf":{"@id":"https://e.printstacktrace.blog/#website"},"datePublished":"2018-10-03T21:28:49.000Z","dateModified":"2019-11-22T21:14:49.000Z","description":"\nGraalVM became one of the most popular topics in the JVM ecosystem. It promises the\nhighest possible speed of running JVM-based programs (when compiled to native images), hand in hand\nwith the smaller memory footprint. It sounds interesting enough to give it a try. And today we are going\nto play around a little bit with running simple Groovy program after compiling to a standalone native image.\n","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/"]}]},{"@type":"Article","@id":"https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/#article","isPartOf":{"@id":"https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/#webpage"},"author":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"headline":"GraalVM and Groovy - how to start?","datePublished":"2018-10-03T21:28:49.000Z","dateModified":"2019-11-22T21:14:49.000Z","mainEntityOfPage":{"@id":"https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/#webpage"},"publisher":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"keywords":"java,groovy,graalvm,native-image","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/#primaryimage","url":"https://e.printstacktrace.blog/images/cards/29.png","inLanguage":"en-US","caption":"GraalVM and Groovy - how to start?"},"inLanguage":"en-US"},{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://e.printstacktrace.blog"},{"@type":"ListItem","position":2,"name":"Groovy Cookbook","item":"https://e.printstacktrace.blog/groovy-cookbook/"},{"@type":"ListItem","position":3,"name":"GraalVM and Groovy - how to start?"}]}]}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="e.printstacktrace.blog - I help you become a better software developer." type="application/atom+xml">
<style>.img-lazyload-container{overflow:hidden;max-width:100%}.img-lazyload-container img{max-width:100%;display:block;height:auto;transition:opacity .5s ease-in-out}.img-lazyload-container img:not([src]){height:0;opacity:0}</style></head><body><header class="fixed-top" id="header"><div class="container"><nav class="navbar navbar-light mx-0 px-0 justify-content-start"><a class="gatr" href="/" data-type="nav" data-name="Home">Home</a><a class="gatr" href="/about" data-type="nav" data-name="About">About</a><a class="gatr" href="/archives" data-type="nav" data-name="Archives">Archives</a><a class="gatr" href="/resources" data-type="nav" data-name="Tools &amp; Resources">Tools & Resources</a><a class="gatr" href="/support-me" data-type="nav" data-name="Support me">Support me</a></nav></div></header><main id="main"><section class="sidebar-enabled" id="content"><div class="container"><div class="row"><div class="col-lg-3 bg-primary sidebar pt-5 d-flex align-items-start flex-column order-1 pr-lg-0"><div class="mb-auto"><div class="text-center pt-lg-5 pl-3"><a href="/about"><img class="rounded-circle mb-4" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" height="96"></a><h5>Hi! 👋 I'm Szymon</h5><p class="small">I help you become a better software developer.</p></div><div class="my-4 pl-2 text-lg-right text-center"><ul class="social-media"><li><a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/wololock" data-type="social-media" data-name="Twitter" title="Twitter"><i class="fa fa-twitter"></i><span class="number">1.13k</span><span class="description">Followers</span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://www.youtube.com/eprintstacktrace" data-type="social-media" data-name="YouTube" title="YouTube"><i class="fa fa-youtube"></i><span class="number">2.06k</span><span class="description">Subscribers</span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock" data-type="social-media" data-name="Github" title="Github"><i class="fa fa-github"></i><span class="number">103</span><span class="description">Followers</span></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://stackoverflow.com/users/2194470/szymon-stepniak" data-type="social-media" data-name="StackOverflow" title="StackOverflow"><i class="fa fa-stack-overflow"></i><span class="number">29.6k</span><span class="description">Reputation</span></a></li></ul></div><div class="pl-4 mt-lg-5 pt-lg-2"><h4 class="h4 pt-4 mb-4 sans-serif">Latest posts from the <span class="h3 font-weight-bold">Groovy Cookbook</span></h4><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)"><img class="rounded" src="/images/icons/3.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)">Groovy Ecosystem Usage Report (2020)</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/how-to-merge-two-maps-in-groovy/" data-type="latest-sidebar" data-name="How to merge two maps in Groovy?"><img class="rounded" src="/images/icons/28.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/how-to-merge-two-maps-in-groovy/" data-type="latest-sidebar" data-name="How to merge two maps in Groovy?">How to merge two maps in Groovy?</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-dynamic-maps-generic-type-erasure-and-raw-types/" data-type="latest-sidebar" data-name="Groovy dynamic Maps, generic type erasure, and raw types - an interesting use case to learn from"><img class="rounded" src="/images/icons/15.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-dynamic-maps-generic-type-erasure-and-raw-types/" data-type="latest-sidebar" data-name="Groovy dynamic Maps, generic type erasure, and raw types - an interesting use case to learn from">Groovy dynamic Maps, generic type erasure, and raw types - an...</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-3-nullcheck-annotation-less-code-and-less-npe/" data-type="latest-sidebar" data-name="Groovy 3 @NullCheck annotation - less code and less NPE"><img class="rounded" src="/images/icons/6.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-3-nullcheck-annotation-less-code-and-less-npe/" data-type="latest-sidebar" data-name="Groovy 3 @NullCheck annotation - less code and less NPE">Groovy 3 @NullCheck annotation - less code and less NPE</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-3-string-gdk-improvements-takeright-takebetween-and-a-few-others/" data-type="latest-sidebar" data-name="Groovy 3 String GDK improvements - takeRight, takeBetween, and a few others"><img class="rounded" src="/images/icons/12.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-3-string-gdk-improvements-takeright-takebetween-and-a-few-others/" data-type="latest-sidebar" data-name="Groovy 3 String GDK improvements - takeRight, takeBetween, and a few others">Groovy 3 String GDK improvements - takeRight, takeBetween, an...</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/groovy-string-methods-that-will-make-your-life-groovier/" data-type="latest-sidebar" data-name="Three Groovy String methods that will make your life Groovier!"><img class="rounded" src="/images/icons/6.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/groovy-string-methods-that-will-make-your-life-groovier/" data-type="latest-sidebar" data-name="Three Groovy String methods that will make your life Groovier!">Three Groovy String methods that will make your life Groovier!</a></h5></div></div><div class="media align-items-center pb-1 mb-3"><a class="d-block gatr" href="/quicksort-in-groovy-can-it-be-as-fast-as-implemented-in-java/" data-type="latest-sidebar" data-name="Quicksort in Groovy - can it be as fast as implemented in Java?"><img class="rounded" src="/images/icons/41.png" width="64"></a><div class="media-body pl-2 ml-1"><h5 class="m-0 small" style="font-size:14px;font-weight:600;line-height:22px"><a class="sans-serif gatr" href="/quicksort-in-groovy-can-it-be-as-fast-as-implemented-in-java/" data-type="latest-sidebar" data-name="Quicksort in Groovy - can it be as fast as implemented in Java?">Quicksort in Groovy - can it be as fast as implemented in Java?</a></h5></div></div><div class="text-center"><a class="view-all" href="/groovy-cookbook/" data-type="latest-sidebar" data-name="More &amp;raquo;"><span class="d-block m-0">More</span><i class="fas fa-chevron-down d-block m-0"></i></a></div></div><div class="pl-4 mt-5"><h4 class="mb-3">Popular categories</h4><ul class="list-unstyled"><li class="my-1"><a class="gatr" href="/groovy-cookbook/" data-type="sidebar-category" data-name="Groovy Cookbook">Groovy Cookbook<span class="count ml-2 mark">28</span></a></li><li class="my-1"><a class="gatr" href="/jenkins-pipeline-cookbook/" data-type="sidebar-category" data-name="Jenkins Pipeline Cookbook">Jenkins Pipeline Cookbook<span class="count ml-2 mark">9</span></a></li><li class="my-1"><a class="gatr" href="/programmers-bookshelf/" data-type="sidebar-category" data-name="Programmer's Bookshelf">Programmer's Bookshelf<span class="count ml-2 mark">6</span></a></li><li class="my-1"><a class="gatr" href="/micronaut-cookbook/" data-type="sidebar-category" data-name="Micronaut Cookbook">Micronaut Cookbook<span class="count ml-2 mark">4</span></a></li><li class="my-1"><a class="gatr" href="/ratpack-cookbook/" data-type="sidebar-category" data-name="Ratpack Cookbook">Ratpack Cookbook<span class="count ml-2 mark">4</span></a></li><li class="my-1"><a class="gatr" href="/learning-java/" data-type="sidebar-category" data-name="Learning Java">Learning Java<span class="count ml-2 mark">4</span></a></li><li class="my-1"><a class="gatr" href="/jq-cookbook/" data-type="sidebar-category" data-name="jq cookbook">jq cookbook<span class="count ml-2 mark">3</span></a></li><li class="my-1"><a class="gatr" href="/how-to/" data-type="sidebar-category" data-name="How to">How to<span class="count ml-2 mark">3</span></a></li><li class="my-1"><a class="gatr" href="/blog-reports/" data-type="sidebar-category" data-name="Blog Reports">Blog Reports<span class="count ml-2 mark">2</span></a></li></ul></div><div class="text-center"><div class="d-none d-lg-inline-block mb-5 pt-5"><a class="gatr" href="https://e.printstacktrace.blog/vidiq" data-type="banner" data-name="vidiq-02" target="_blank"><img class="img-fluid" data-lazy="/images/yml/vidiq-02.png"></a></div><div class="d-inline-block d-lg-none py-3"><a class="gatr" href="https://www.jdoqocy.com/click-100191173-14085090" data-type="banner" data-name="domain10-01" target="_blank"><img class="img-fluid" data-lazy="/images/yml/domain10-01.png"></a></div></div></div><div class="spread-the-love pt-4 mt-lg-5"><div class="mb-lg-5 pb-5 pl-lg-4"><h3 class="mb-3">Don't miss anything - join my newsletter</h3><p class="text-justify">Additional materials and updates for subscribers. <b>No spam guaranteed</b>.<br>Unsubscribe at any time.</p><div id="ck-5bc70426c4-box"></div><script>function load_newsletter(e){var t=document.getElementById("ck-5bc70426c4-box");if(document.contains(t)){var n=t.parentElement;t.remove();var o=document.createElement("script");o.type="text/javascript",o.async=!0,o.src="https://tremendous-motivator-1432.ck.page/"+e+"/index.js",o.setAttribute("data-uid",e),n.appendChild(o),console.log("Convertkit "+e+" loaded.")}}window.addEventListener("scroll",function(e){var t=document.scrollingElement.scrollTop,n=document.getElementById("ck-5bc70426c4-box");document.contains(n)&&t>n.getBoundingClientRect().top- -500&&load_newsletter("5bc70426c4")})</script></div><div class="pl-lg-3 text-lg-left text-center"><p class="m-0 serif">Did you like this article?</p><h5 class="text-uppercase">Spread the <i class="fa fa-heart"></i>!</h5><ul class="mb-5"><li><a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?text=GraalVM and Groovy - how to start? https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/ via @wololock" data-type="share" data-name="Shared on Twitter"><i class="fa fa-twitter"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://www.linkedin.com/shareArticle?url=https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/" data-type="share" data-name="Shared on LinkedIn"><i class="fa fa-linkedin"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://www.facebook.com/sharer.php?u=https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/" data-type="share" data-name="Shared on Facebook"><i class="fa fa-facebook-square"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="http://www.reddit.com/submit?url=https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/&amp;title=GraalVM and Groovy - how to start?" data-type="share" data-name="Shared on Reddit"><i class="fa fa-reddit"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/button/?url=https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/&amp;media=https://e.printstacktrace.blog/images/cards/29.png&amp;description=GraalVM and Groovy - how to start?" data-type="share" data-name="Shared on Pinterest"><i class="fa fa-pinterest"></i></a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://ko-fi.com/eprintstacktrace" data-type="share" data-name="Clicked on Ko-Fi">☕️</a></li></ul></div></div></div><div class="col-lg-9 py-5 order-0"><div class="pr-lg-4 px-1 pt-lg-5"><nav aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a class="gatr" href="/" data-type="breadcrumb" data-name="/">e.printstacktrace.blog</a></li><li class="breadcrumb-item"><a class="gatr" href="/groovy-cookbook/" data-type="breadcrumb" data-name="Groovy Cookbook">Groovy Cookbook</a></li></ol></nav><article class="post-body"><h1>GraalVM and Groovy - how to start?</h1><div class="post-meta mb-4"><ul><li><time datetime="2018-10-03T21:28:49.000Z">October 3, 2018</time></li><li>21 min. read</li><li><a href="https://e.printstacktrace.blog/graalvm-and-groovy-how-to-start/#disqus_thread">0 Comments</a></li></ul></div><div class="content"><div class="paragraph"><p><a target="_blank" rel="noopener" href="https://www.graalvm.org/">GraalVM</a> became one of the most popular topics in the JVM ecosystem. It promises the highest possible speed of running JVM-based programs (when compiled to native images), hand in hand with the smaller memory footprint. It sounds interesting enough to give it a try. And today we are going to play around a little bit with running simple Groovy program after compiling to a standalone native image.</p></div><a id="more"></a><div class="sect1"><h2 id="introduction">Introduction</h2><div class="sectionbody"><div class="paragraph"><p>This blog post documents pretty simple use case of running Groovy code compiled to a GraalVM native image. It will give you a good understanding how to start and how to solve the problems you will most probably face when you start playing around with your own examples.</p></div></div></div><div class="sect1"><h2 id="prerequisites">Prerequisites</h2><div class="sectionbody"><div class="paragraph"><p>We will be using following tools:</p></div><div class="ulist"><ul><li><p><strong>GraalVM</strong> <code>19.2.1</code> <em>(updated: 2019-11-07T19:37:33+0100)</em></p></li><li><p><strong>Groovy</strong> <code>2.5.8</code></p></li></ul></div><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa icon-tip" title="Tip"></i></td><td class="content">The easiest way to install GraalVM and Groovy is to use <a target="_blank" rel="noopener" href="https://sdkman.io/">SDKMAN!</a> command line tool.</td></tr></table></div><div class="admonitionblock important"><table><tr><td class="icon"><i class="fa icon-important" title="Important"></i></td><td class="content"><div class="paragraph"><p>The <code>native-image</code> from <strong>GraalVM</strong> <code>19.3.0</code> does not compile this specific Groovy code and fails with the <code>undefined reference to `JVM_GetMethodTypeAnnotations'</code> and <code>undefined reference to `JVM_GetMethodParameters'</code>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">/opt/graalvm-ce-java8-19.3.0/jre/lib/libjava.a(Executable.o): In function `Java_java_lang_reflect_Executable_getTypeAnnotationBytes0':
/opt/jprt/T/P1/225159.buildslave/s/jdk/src/share/native/java/lang/reflect/Executable.c:39: undefined reference to `JVM_GetMethodTypeAnnotations'
/opt/graalvm-ce-java8-19.3.0/jre/lib/libjava.a(Executable.o): In function `Java_java_lang_reflect_Executable_getParameters0':
/opt/jprt/T/P1/225159.buildslave/s/jdk/src/share/native/java/lang/reflect/Executable.c:33: undefined reference to `JVM_GetMethodParameters'
collect2: error: ld returned 1 exit status</code></pre></div></div><div class="paragraph"><p>It is most probably related to the changes introduced in 19.3.0 to the <code>native-image</code> compiler<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>.</p></div><div class="paragraph"><p>The issue was reported here - <span class="icon"><i class="fa fa-github"></i></span> <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/issues/1875">oracle/graal/issues/1875</a></p></div></td></tr></table></div><div class="paragraph"><p>Let&#8217;s make sure we are using correct GraalVM Java distribution.</p></div><div class="listingblock"><div class="title">Listing 1. Checking Java version</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ java -version
openjdk version "1.8.0_232"
OpenJDK Runtime Environment (build 1.8.0_232-20191008104205.buildslave.jdk8u-src-tar--b07)
OpenJDK 64-Bit GraalVM CE 19.2.1 (build 25.232-b07-jvmci-19.2-b03, mixed mode)</code></pre></div></div><div class="paragraph"><p>Starting from 19.0.0 version, GraalVM does not contain <code>native-image</code> tool as a default part of the distribution, so we need to install it using GraalVM Component Updater.</p></div><div class="listingblock"><div class="title">Listing 2. Installing <code>native-image</code> using <code>gu</code> (a tool shipped with GraalVM distribution)</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ gu install native-image

Downloading: Component catalog from www.graalvm.org
Processing component archive: Native Image
Downloading: Component native-image: Native Image  from github.com
Installing new component: Native Image (org.graalvm.native-image, version 19.2.1)</code></pre></div></div><div class="paragraph"><p>Let&#8217;s check if we use a proper version of Groovy.</p></div><div class="listingblock"><div class="title">Listing 3. Checking Groovy version</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ groovy -version
Groovy Version: 2.5.8 JVM: 1.8.0_232 Vendor: Oracle Corporation OS: Linux</code></pre></div></div><div class="paragraph"><p>Let&#8217;s also check if <code>GROOVY_HOME</code> variable is set correctly. (If you installed Groovy using SDKMAN!, the environment variable should be set correctly.)</p></div><div class="listingblock"><div class="title">Listing 4. Checking if <code>GROOVY_HOME</code> environment variable is set</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ env | grep GROOVY_HOME
GROOVY_HOME=/home/wololock/.sdkman/candidates/groovy/current</code></pre></div></div><div class="paragraph"><p>We are all set and ready to code!</p></div></div></div><div class="sect1"><h2 id="an-example">An example</h2><div class="sectionbody"><div class="paragraph"><p>For the purpose of this experiment we are going to use a simple Groovy program that sums and multiplies numbers:</p></div><div class="listingblock"><div class="title">Listing 5. RandomNumber.groovy</div><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">class RandomNumber &#123;
    static void main(String[] args) &#123;
        def random = new Random().nextInt(1000)

        println "The random number is: $random"

        def sum = (0..random).sum &#123; int num -&gt; num * 2 &#125;

        println "The doubled sum of numbers between 0 and $random is $sum"
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>GraalVM prefers static compilation<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup>, thus we need to switch Groovy from dynamic to a static compilation. We can simply put <code>@groovy.transform.CompileStatic</code> annotation over the class definition in <code>RandomNumber.groovy</code> file, or we can create a compiler configuration file that adds this annotation to all classes.</p></div><div class="listingblock"><div class="title">Listing 6. Compiler configuration file <code>compiler.groovy</code></div><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">withConfig(configuration) &#123;
    ast(groovy.transform.CompileStatic)
&#125;</code></pre></div></div><div class="paragraph"><p>We are ready to compile our code with <code>groovyc</code> compiler:</p></div><div class="listingblock"><div class="title">Listing 7. Compiling Groovy code</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">groovyc --configscript compiler.groovy RandomNumber.groovy</code></pre></div></div><div class="paragraph"><p>The code compiled. We can now test if our Groovy script runs as a Java program.</p></div><div class="listingblock"><div class="title">Listing 8. Running Java program with GraalVM</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ java -cp ".:$GROOVY_HOME/lib/groovy-2.5.8.jar" RandomNumber
The random number is: 313
The doubled sum of numbers between 0 and 313 is 98282</code></pre></div></div><div class="paragraph"><p>It run smoothly! You have probably noticed a small lag - the result was not printed instantly to the console. We can run the program again, but this time with the <code>time</code> command added to measure execution time.</p></div><div class="listingblock"><div class="title">Listing 9. Measuring Java program execution time</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ time java -cp ".:$GROOVY_HOME/lib/groovy-2.5.8.jar" RandomNumber
The random number is: 859
The doubled sum of numbers between 0 and 859 is 738740

real	0m0,306s
user	0m0,692s
sys	0m0,073s</code></pre></div></div><div class="paragraph"><p>It took <strong>306 ms</strong> to complete. Is it slow or fast? It depends. If we compare it to the same program, but executed inside Groovy interpreter command line tool, the Java program is approximately <strong>2.5 times faster</strong>.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ time groovy RandomNumber.groovy
The random number is: 711
The doubled sum of numbers between 0 and 711 is 506232

real	0m0,885s
user	0m2,060s
sys	0m0,183s</code></pre></div></div><div class="paragraph"><p>Let&#8217;s see if GraalVM&#8217;s native image can do better than that.</p></div></div></div><div class="sect1"><h2 id="creating-native-image">Creating native image</h2><div class="sectionbody"><div class="paragraph"><p>One of the most interesting features of GraalVM is its <a target="_blank" rel="noopener" href="https://www.graalvm.org/docs/reference-manual/aot-compilation/">ability to create standalone native binary file</a> from given Java bytecode (either Java <code>.class</code> or <code>.jar</code> files).</p></div><div class="paragraph"><p>Running our example inside the JVM was nice, but GraalVM offers much more. We can create standalone native image that will consume much less memory and will execute in a blink of an eye. Let&#8217;s give it a try:</p></div><div class="listingblock"><div class="title">Listing 10. Building native image with GraalVM</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ native-image --allow-incomplete-classpath \ <i class="conum" data-value="1"></i><b>(1)</b>
    --report-unsupported-elements-at-runtime \ <i class="conum" data-value="2"></i><b>(2)</b>
    --initialize-at-build-time \ <i class="conum" data-value="3"></i><b>(3)</b>
    --initialize-at-run-time=org.codehaus.groovy.control.XStreamUtils,groovy.grape.GrapeIvy \ <i class="conum" data-value="4"></i><b>(4)</b>
    --no-fallback \ <i class="conum" data-value="5"></i><b>(5)</b>
    --no-server \ <i class="conum" data-value="6"></i><b>(6)</b>
    -cp ".:$GROOVY_HOME/lib/groovy-2.5.8.jar" \ <i class="conum" data-value="7"></i><b>(7)</b>
    RandomNumber <i class="conum" data-value="8"></i><b>(8)</b></code></pre></div></div><div class="paragraph"><p>As you can see there are many parameters passed to the <code>native-image</code> command. We use <em class="conum" data-value="1"></em> to allow image building with an incomplete classpath. If we didn&#8217;t allow that, native image compilation would fail with the error like the one below.</p></div><div class="listingblock"><div class="title">Listing 11. Compilation error thrown when <code>--allow-incomplete-classpath</code> parameter is missing</div><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">Error: com.oracle.graal.pointsto.constraints.UnresolvedElementException: Discovered unresolved method during parsing: org.codehaus.groovy.control.XStreamUtils.serialize(java.lang.String, java.lang.Object). To diagnose the issue you can use the --allow-incomplete-classpath option. The missing method is then reported at run time when it is accessed the first time.</code></pre></div></div><div class="paragraph"><p>The second parameter <em class="conum" data-value="2"></em> makes usages of unsupported methods and fields to be reported at a runtime (when they are accessed the first time) instead of the build time. It is also critical to our case. Without this parameter set, compilation fails with the following error.</p></div><div class="listingblock"><div class="title">Listing 12. Compilation error thrown when <code>--report-unsupported-elements-at-runtime</code> parameter is missing</div><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">Error: Unsupported features in 5 methods
Detailed message:
Error: com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported method java.lang.ClassLoader.defineClass(String, byte[], int, int) is reachable: The declaring class of this element has been substituted, but this element is not present in the substitution class
...
Error: com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported method java.lang.ClassLoader.defineClass(String, byte[], int, int, ProtectionDomain) is reachable: The declaring class of this element has been substituted, but this element is not present in the substitution class
...
Error: com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported method java.lang.ClassLoader.findLoadedClass(String) is reachable: The declaring class of this element has been substituted, but this element is not present in the substitution class
...
Error: com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported method java.lang.ClassLoader.findLoadedClass(String) is reachable: The declaring class of this element has been substituted, but this element is not present in the substitution class
...
Error: com.oracle.svm.hosted.substitute.DeletedElementException: Unsupported method java.lang.ClassLoader.loadClass(String, boolean) is reachable: The declaring class of this element has been substituted, but this element is not present in the substitution class
To diagnose the issue, you can add the option --report-unsupported-elements-at-runtime. The unsupported element is then reported at run time when it is accessed the first time.</code></pre></div></div><div class="paragraph"><p>Options <em class="conum" data-value="3"></em> and <em class="conum" data-value="4"></em> specify that all packages and classes are initialized during the native image generation, except for the two: <code>org.codehaus.groovy.control.XStreamUtils</code> and <code>groovy.grape.GrapeIvy</code>.</p></div><div class="paragraph"><p>With <code>--no-fallback</code> option <em class="conum" data-value="5"></em> we want to force the native image compiler that we expect the native image is either generated correctly, or the compilation fails. Without this option set, the compiler falls back to the regular JDK execution in case of an error faced during the compilation. When it happens, we see the following message in the console log.</p></div><div class="listingblock"><div class="title">Listing 13. Fallback strategy in case of an error during image compilation</div><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">Warning: Image 'randomnumber' is a fallback image that requires a JDK for execution (use --no-fallback to suppress fallback image generation).</code></pre></div></div><div class="paragraph"><p>The <code>--no-server</code> option <em class="conum" data-value="6"></em> informs the compiler that we don&#8217;t want to use image-build server. We also set <em class="conum" data-value="7"></em> the same classpath we set when running Groovy as a Java program. And the last line <em class="conum" data-value="8"></em> contains the name of the <code>RandomNumber.class</code> file.</p></div><div class="paragraph"><p>The compilation takes approximately 60 seconds and this is the output we should expect.</p></div><div class="listingblock"><div class="title">Listing 14. The expected native image compilation console output</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ native-image --allow-incomplete-classpath \
    --report-unsupported-elements-at-runtime \
    --initialize-at-build-time \
    --initialize-at-run-time=org.codehaus.groovy.control.XStreamUtils,groovy.grape.GrapeIvy \
    --no-fallback \
    --no-server \
    -cp ".:$GROOVY_HOME/lib/groovy-2.5.8.jar" \
    RandomNumber
[randomnumber:30836]    classlist:   2,543.84 ms
[randomnumber:30836]        (cap):     842.60 ms
[randomnumber:30836]        setup:   2,037.49 ms
[randomnumber:30836]   (typeflow):  10,398.18 ms
[randomnumber:30836]    (objects):  12,716.21 ms
[randomnumber:30836]   (features):     502.37 ms
[randomnumber:30836]     analysis:  24,049.68 ms
[randomnumber:30836]     (clinit):     309.26 ms
[randomnumber:30836]     universe:     952.52 ms
[randomnumber:30836]      (parse):   2,359.79 ms
[randomnumber:30836]     (inline):   3,216.99 ms
[randomnumber:30836]    (compile):  17,702.26 ms
[randomnumber:30836]      compile:  24,547.04 ms
[randomnumber:30836]        image:   2,308.60 ms
[randomnumber:30836]        write:     352.50 ms
[randomnumber:30836]      [total]:  56,941.42 ms</code></pre></div></div></div></div><div class="sect1"><h2 id="running-standalone-native-image">Running standalone native image</h2><div class="sectionbody"><div class="paragraph"><p>The compilation succeeds and we can see <code>randomnumber</code> executable file in the current folder.</p></div><div class="listingblock"><div class="title">Listing 15. The current folder with <code>randomnumber</code> executable file</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ ls -lah randomnumber
-rwxrwxr-x 1 wololock wololock 21M 05-11 13:13 randomnumber</code></pre></div></div><div class="paragraph"><p>Let&#8217;s run it and see the result.</p></div><div class="listingblock"><div class="title">Listing 16. Running executable file for the first time</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ ./randomnumber
The random number is: 397
Exception in thread "main" groovy.lang.MissingMethodException: No signature of method: RandomNumber$_main_closure1.doCall() is applicable for argument types: (Integer) values: [0]
Possible solutions: findAll(), findAll(), isCase(java.lang.Object), isCase(java.lang.Object)
	at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:255)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1041)
	at groovy.lang.Closure.call(Closure.java:405)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6648)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6548)
	at RandomNumber.main(RandomNumber.groovy:7)</code></pre></div></div><div class="paragraph"><p>Something is broken. The first line <code>The random number is: 397</code> gets printed correctly, but it fails when trying to invoke <code>RandomNumber$_main_closure1.doCall(int)</code>. How is that?</p></div><div class="paragraph"><p>This method represents the closure we pass to the <code>(0..random).sum()</code> method. The problem is that the process of the <code>doCall(int)</code> method lookup uses reflection. And even though the native image supports runtime reflection<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>, in some cases it is not able do determine it correctly, thus it requires additional configuration provided by the user.</p></div></div></div><div class="sect1"><h2 id="reflection-configuration">Reflection configuration</h2><div class="sectionbody"><div class="paragraph"><p>The manual reflection configuration for GraalVM native image is fairly simple<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup>. All we have to do is to create a JSON configuration file and add <code>-H:ReflectionConfigurationFiles=&#8230;&#8203;</code> to the command line. We can either configure class that will be used reflectively using helper options like <code>allDeclaredMethods</code>, or we can manually provide a list of methods (and their parameters) we expect to get invoked using reflection. To keep this example simple, we will use the first approach.</p></div><div class="listingblock"><div class="title">Listing 17. Our exemplary <code>reflections.json</code> file</div><div class="content"><pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">[
  &#123;
    "name": "RandomNumber$_main_closure1",
    "allDeclaredConstructors": true,
    "allPublicConstructors": true,
    "allDeclaredMethods": true,
    "allPublicMethods": true
  &#125;
]</code></pre></div></div><div class="paragraph"><p>Let&#8217;s recompile the native image using reflection configuration.</p></div><div class="listingblock"><div class="title">Listing 18. Recompiling native image using reflection configuration</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ native-image --allow-incomplete-classpath \
    --report-unsupported-elements-at-runtime \
    --initialize-at-build-time \
    --initialize-at-run-time=org.codehaus.groovy.control.XStreamUtils,groovy.grape.GrapeIvy \
    --no-fallback \
    --no-server \
    -cp ".:$GROOVY_HOME/lib/groovy-2.5.7.jar" \
    <strong>-H:ReflectionConfigurationFiles=reflections.json</strong> \
    RandomNumber
[randomnumber:14904]    classlist:   2,465.48 ms
[randomnumber:14904]        (cap):     847.33 ms
[randomnumber:14904]        setup:   1,956.50 ms
[randomnumber:14904]   (typeflow):  10,908.61 ms
[randomnumber:14904]    (objects):  14,070.69 ms
[randomnumber:14904]   (features):     389.80 ms
[randomnumber:14904]     analysis:  26,006.96 ms
[randomnumber:14904]     (clinit):     368.34 ms
[randomnumber:14904]     universe:   1,018.86 ms
[randomnumber:14904]      (parse):   2,536.26 ms
[randomnumber:14904]     (inline):   3,122.56 ms
[randomnumber:14904]    (compile):  18,851.47 ms
[randomnumber:14904]      compile:  25,996.75 ms
[randomnumber:14904]        image:   2,547.31 ms
[randomnumber:14904]        write:     375.97 ms
[randomnumber:14904]      [total]:  60,535.87 ms</code></pre></div></div><div class="paragraph"><p>We can run the program again to see if it works.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ ./randomnumber
The random number is: 869
java.lang.ClassNotFoundException: org.codehaus.groovy.runtime.dgm$521
	at com.oracle.svm.core.hub.ClassForNameSupport.forName(ClassForNameSupport.java:51)
	at java.lang.ClassLoader.loadClass(Target_java_lang_ClassLoader.java:131)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.createProxy(GeneratedMetaMethod.java:101)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.proxy(GeneratedMetaMethod.java:93)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.isValidMethod(GeneratedMetaMethod.java:78)
	at groovy.lang.MetaClassImpl.chooseMethodInternal(MetaClassImpl.java:3226)
	at groovy.lang.MetaClassImpl.chooseMethod(MetaClassImpl.java:3188)
	at groovy.lang.MetaClassImpl.getNormalMethodWithCaching(MetaClassImpl.java:1399)
	at groovy.lang.MetaClassImpl.getMethodWithCaching(MetaClassImpl.java:1314)
	at groovy.lang.MetaClassImpl.getMetaMethod(MetaClassImpl.java:1229)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1082)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1041)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6655)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6548)
	at RandomNumber.main(RandomNumber.groovy:7)
Exception in thread "main" groovy.lang.GroovyRuntimeException: Failed to create DGM method proxy : java.lang.ClassNotFoundException: org.codehaus.groovy.runtime.dgm$521
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.createProxy(GeneratedMetaMethod.java:106)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.proxy(GeneratedMetaMethod.java:93)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.isValidMethod(GeneratedMetaMethod.java:78)
	at groovy.lang.MetaClassImpl.chooseMethodInternal(MetaClassImpl.java:3226)
	at groovy.lang.MetaClassImpl.chooseMethod(MetaClassImpl.java:3188)
	at groovy.lang.MetaClassImpl.getNormalMethodWithCaching(MetaClassImpl.java:1399)
	at groovy.lang.MetaClassImpl.getMethodWithCaching(MetaClassImpl.java:1314)
	at groovy.lang.MetaClassImpl.getMetaMethod(MetaClassImpl.java:1229)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1082)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1041)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6655)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6548)
	at RandomNumber.main(RandomNumber.groovy:7)
Caused by: java.lang.ClassNotFoundException: org.codehaus.groovy.runtime.dgm$521
	at com.oracle.svm.core.hub.ClassForNameSupport.forName(ClassForNameSupport.java:51)
	at java.lang.ClassLoader.loadClass(Target_java_lang_ClassLoader.java:131)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.createProxy(GeneratedMetaMethod.java:101)
	... 12 more</code></pre></div></div><div class="paragraph"><p>Failed again. This time it couldn&#8217;t find a class <code>org.codehaus.groovy.runtime.dgm$521</code>. This is one of the classes that represent Groovy dynamic methods - methods that extend e.g. JDK classes with the new methods. This class is also accessed through reflection, let&#8217;s add to our <code>reflection.json</code> configuration file.</p></div><div class="listingblock"><div class="title">Listing 19. Updated <code>reflections.json</code> file</div><div class="content"><pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">[
  &#123;
    "name": "RandomNumber$_main_closure1",
    "allDeclaredConstructors": true,
    "allPublicConstructors": true,
    "allDeclaredMethods": true,
    "allPublicMethods": true
  &#125;,
  <strong>&#123;
    "name": "org.codehaus.groovy.runtime.dgm$521",
    "allDeclaredConstructors": true,
    "allPublicConstructors": true,
    "allDeclaredMethods": true,
    "allPublicMethods": true
  &#125;</strong>
]</code></pre></div></div><div class="paragraph"><p>Let&#8217;s recompile the native image using the same command as before. When the compilation is done, let&#8217;s see if it works.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ ./randomnumber
The random number is: 853
java.lang.ClassNotFoundException: org.codehaus.groovy.runtime.dgm$1180
	at com.oracle.svm.core.hub.ClassForNameSupport.forName(ClassForNameSupport.java:51)
	at java.lang.ClassLoader.loadClass(Target_java_lang_ClassLoader.java:131)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.createProxy(GeneratedMetaMethod.java:101)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.proxy(GeneratedMetaMethod.java:93)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.isValidMethod(GeneratedMetaMethod.java:78)
	at groovy.lang.MetaClassImpl.chooseMethodInternal(MetaClassImpl.java:3226)
	at groovy.lang.MetaClassImpl.chooseMethod(MetaClassImpl.java:3188)
	at groovy.lang.MetaClassImpl.getNormalMethodWithCaching(MetaClassImpl.java:1399)
	at groovy.lang.MetaClassImpl.getMethodWithCaching(MetaClassImpl.java:1314)
	at groovy.lang.MetaClassImpl.getMetaMethod(MetaClassImpl.java:1229)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1082)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1041)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6655)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6548)
	at RandomNumber.main(RandomNumber.groovy:7)
Exception in thread "main" groovy.lang.GroovyRuntimeException: Failed to create DGM method proxy : java.lang.ClassNotFoundException: org.codehaus.groovy.runtime.dgm$1180
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.createProxy(GeneratedMetaMethod.java:106)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.proxy(GeneratedMetaMethod.java:93)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.isValidMethod(GeneratedMetaMethod.java:78)
	at groovy.lang.MetaClassImpl.chooseMethodInternal(MetaClassImpl.java:3226)
	at groovy.lang.MetaClassImpl.chooseMethod(MetaClassImpl.java:3188)
	at groovy.lang.MetaClassImpl.getNormalMethodWithCaching(MetaClassImpl.java:1399)
	at groovy.lang.MetaClassImpl.getMethodWithCaching(MetaClassImpl.java:1314)
	at groovy.lang.MetaClassImpl.getMetaMethod(MetaClassImpl.java:1229)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1082)
	at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1041)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6655)
	at org.codehaus.groovy.runtime.DefaultGroovyMethods.sum(DefaultGroovyMethods.java:6548)
	at RandomNumber.main(RandomNumber.groovy:7)
Caused by: java.lang.ClassNotFoundException: org.codehaus.groovy.runtime.dgm$1180
	at com.oracle.svm.core.hub.ClassForNameSupport.forName(ClassForNameSupport.java:51)
	at java.lang.ClassLoader.loadClass(Target_java_lang_ClassLoader.java:131)
	at org.codehaus.groovy.reflection.GeneratedMetaMethod$Proxy.createProxy(GeneratedMetaMethod.java:101)
	... 12 more</code></pre></div></div><div class="paragraph"><p>Failed again. This time the class <code>org.codehaus.groovy.runtime.dgm$1180</code> cannot be found. Let&#8217;s add it to the <code>reflections.json</code> configuration file.</p></div><div class="listingblock"><div class="title">Listing 20. Another update to <code>reflections.json</code> file</div><div class="content"><pre class="highlightjs highlight"><code data-lang="json" class="language-json hljs">[
  &#123;
    "name": "RandomNumber$_main_closure1",
    "allDeclaredConstructors": true,
    "allPublicConstructors": true,
    "allDeclaredMethods": true,
    "allPublicMethods": true
  &#125;,
  &#123;
    "name": "org.codehaus.groovy.runtime.dgm$521",
    "allDeclaredConstructors": true,
    "allPublicConstructors": true,
    "allDeclaredMethods": true,
    "allPublicMethods": true
  &#125;,
  <strong>&#123;
    "name": "org.codehaus.groovy.runtime.dgm$1180",
    "allDeclaredConstructors": true,
    "allPublicConstructors": true,
    "allDeclaredMethods": true,
    "allPublicMethods": true
  &#125;</strong>
]</code></pre></div></div><div class="paragraph"><p>After updating the configuration file, let&#8217;s recompile the image using the same command as before. When it&#8217;s done, it&#8217;s time to run the program.</p></div><div class="listingblock"><div class="title">Listing 21. Working native image</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ ./randomnumber
The random number is: 859
The doubled sum of numbers between 0 and 859 is 738740</code></pre></div></div><div class="paragraph"><p><strong>It worked!</strong> You also noticed that the reaction time is much better compared to the previous attempts (running Groovy code as a Java program). Let&#8217;s measure native image execution time.</p></div><div class="listingblock"><div class="title">Listing 22. The native image execution time</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">time ./randomnumber
The random number is: 580
The doubled sum of numbers between 0 and 580 is 336980

real	0m0,008s
user	0m0,005s
sys	0m0,003s</code></pre></div></div><div class="paragraph"><p>This is really nice - <strong>8 ms</strong>. And here is how does it look like compared to the previous results.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/graalvm-groovy-execution-time.png"><div class="img-lazyload-container" style="width:977px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/graalvm-groovy-execution-time.png" height="368" width="977" style="padding-top:37.66632548618219%"></div></a></div></div></div></div><div class="paragraph"><p>As you can see, GraalVM&#8217;s native image outperforms the two previous attempts.</p></div></div></div><div class="sect1"><h2 id="automated-reflection-configuration">Automated reflection configuration</h2><div class="sectionbody"><div class="paragraph"><p>I guess we both agree, that this manual reflection configuration was pretty annoying. We added a class to a configuration, then we recompiled the native image just to get another exception with a different missing class. In case of a such simple program we had to add three classes to the reflection configuration. We can imagine how ineffective would it be in case of a much more complex example.</p></div><div class="paragraph"><p>Luckily, there is a solution to this problem. GraalVM&#8217;s JDK is distributed with <code>native-image-agent</code> - a Java agent that can be used to run our program with GraalVM&#8217;s JDK that introspects the code usage. It can detect all reflection for us (and not only that).</p></div><div class="paragraph"><p>Let&#8217;s give it a try. Firstly, we need to run our compiled Groovy code as a Java program with the <code>native-image-agent</code> enabled.</p></div><div class="listingblock"><div class="title">Listing 23. Running as a Java program with the agent enabled</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ java -agentlib:native-image-agent=config-output-dir=conf/ \<i class="conum" data-value="1"></i><b>(1)</b>
    -cp ".:$GROOVY_HOME/lib/groovy-2.5.8.jar" RandomNumber</code></pre></div></div><div class="paragraph"><p>The program executes like it did before, but know it created 4 configuration files in the folder we specified with <em class="conum" data-value="1"></em> parameter (in this case I used <code>conf/</code> folder). Here are the files that got created.</p></div><div class="listingblock"><div class="title">Listing 24. Automatically generated configuration files for the native image builder</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ tree conf
<strong>conf</strong>
├── jni-config.json
├── proxy-config.json
├── reflect-config.json
└── resource-config.json

0 directories, 4 files</code></pre></div></div><div class="paragraph"><p>If you open <code>conf/reflect-config.json</code> file you will see that it contains tons of classes configured for the reflective access. (In my case this file is 579 lines long.)</p></div><div class="paragraph"><p>The last thing we have to do is to remove <code>-H:ReflectionConfigurationFiles</code> parameters and use the <code>-H:ConfigurationFileDirectories</code> parameter instead. It loads not only reflection configuration files, but also remaining three configurations for proxies, JNI, and resources.</p></div><div class="listingblock"><div class="title">Listing 25. Using automatically generated reflection configuration file</div><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ native-image --allow-incomplete-classpath \
    --report-unsupported-elements-at-runtime \
    --initialize-at-build-time \
    --initialize-at-run-time=org.codehaus.groovy.control.XStreamUtils,groovy.grape.GrapeIvy \
    --no-fallback \
    --no-server \
    -cp ".:$GROOVY_HOME/lib/groovy-2.5.7.jar" \
    <strong>-H:ConfigurationFileDirectories=conf/</strong> \
    RandomNumber</code></pre></div></div><div class="paragraph"><p>It compiles in 70 seconds.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[randomnumber:6854]    classlist:   2,495.24 ms
[randomnumber:6854]        (cap):     924.98 ms
[randomnumber:6854]        setup:   2,170.19 ms
[randomnumber:6854]   (typeflow):  12,968.96 ms
[randomnumber:6854]    (objects):  17,112.64 ms
[randomnumber:6854]   (features):     568.95 ms
[randomnumber:6854]     analysis:  31,241.39 ms
[randomnumber:6854]     (clinit):     447.44 ms
[randomnumber:6854]     universe:   1,339.22 ms
[randomnumber:6854]      (parse):   2,724.16 ms
[randomnumber:6854]     (inline):   4,752.75 ms
[randomnumber:6854]    (compile):  20,960.41 ms
[randomnumber:6854]      compile:  29,926.05 ms
[randomnumber:6854]        image:   2,818.74 ms
[randomnumber:6854]        write:     373.36 ms
[randomnumber:6854]      [total]:  70,552.29 ms</code></pre></div></div><div class="paragraph"><p>And see if it works with those automatically generated configuration files.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ ./randomnumber
The random number is: 347
The doubled sum of numbers between 0 and 347 is 120756</code></pre></div></div><div class="paragraph"><p>Cowabunga! No problems this time! <span class="icon"><i class="fa fa-smile-o"></i></span></p></div></div></div><div class="sect1"><h2 id="limitations">Limitations</h2><div class="sectionbody"><div class="paragraph"><p>Even though we compiled the native image successfully, we need to be aware of a few significant limitations. Groovy is not a first class citizen for GraalVM&#8217;s ahead-of-time compilation by design, and that is why you can&#8217;t expect that your Groovy program will compile to the native image successfully. Below is the list of the major limitations that cannot be avoided.</p></div><div class="ulist"><ul><li><p>GraalVM&#8217;s SubstrateVM does not support <strong>dynamic class loading</strong>, <strong>dynamic class generation</strong>, and <strong>bytecode InvokeDynamic</strong>. This limitation makes dynamic Groovy scripts and classes almost 99% incompatible with building native images. That is why we had to turn on static compilation in the example described above.</p></li></ul></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Here you can read more about <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md">SubstrateVM limitations</a>.</td></tr></table></div><div class="ulist"><ul><li><p>Metaprogramming features don&#8217;t work in the native image.</p></li><li><p>Coercing closures to other specific types (e.g. functional interfaces used with Java 8 Stream API) does not work.</p></li></ul></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>I hope you have learned something interesting from this blog post. If you are interested in learning more about Groovy and GraalVM, checkout my other blog posts you can find in the section below.</p></div><div class="paragraph"><p>You can also check my <span class="icon"><i class="fa fa-github"></i></span> <a target="_blank" rel="noopener" href="https://github.com/wololock/graalvm-groovy-examples">wololock/graalvm-groovy-examples</a> GitHub repository, where I collect some of the demos and examples I create during my experiments. Feel free to test it, experiment on your side and contribute to the project. GraalVM is fascinating and quite challenging piece of technology. The more we experiment with it and learn how to use it most effectively, the more we can help other people adopting it.</p></div><div class="paragraph"><p></p><div class="youtube-row py-5"><div class="row"><div class="col-12 col-lg-5 text-lg-left text-center mb-lg-0 mb-4"><a class="thumb gatr d-inline-block" target="_blank" rel="noopener" href="https://youtu.be/BjO_vBzaB4c" data-time="10:14" data-type="youtube" data-name="Groovy + GraalVM native-image = instant startup time!"><img class="img-fluid shadow" data-lazy="https://i3.ytimg.com/vi/BjO_vBzaB4c/mqdefault.jpg"></a></div><div class="col-12 col-lg-7"><h5 class="m-0 p-0 mb-3 text-lg-left text-center"><a class="gatr" target="_blank" rel="noopener" href="https://youtu.be/BjO_vBzaB4c" data-type="youtube" data-name="Groovy + GraalVM native-image = instant startup time!">Groovy + GraalVM native-image = instant startup time!</a></h5><p class="sans-serif small text-lg-left text-justify">This is a short version of my &quot;Groovy and GraalVM&quot; talk presented at GR8Conf EU 2019 in Copenhagen, Denmark. I use slides prepared in AsciiDoc and compiled to reveal.js with AsciiDoctorJ Gradle plugin. I hope you enjoy it! <a class="gatr font-weight-bold" target="_blank" rel="noopener" href="https://youtu.be/BjO_vBzaB4c" data-type="youtube" data-name="Groovy + GraalVM native-image = instant startup time!">Watch&nbsp;now&nbsp;&raquo;</a></p></div></div></div><p></p></div></div></div><div class="sect1"><h2 id="useful-resources">Useful resources</h2><div class="sectionbody"><div class="paragraph"><p>Here you can find a list of blog posts I found useful when I was working on this article.</p></div><div class="ulist"><ul><li><p><a target="_blank" rel="noopener" href="https://github.com/wololock/groovy-and-graalvm"><em>Source code from my "GraalVM adn Groovy" presentation from GR8Conf EU 2019</em></a></p></li><li><p><a target="_blank" rel="noopener" href="https://github.com/graemerocher/micronaut-graal-experiments"><em>Micronaut Graal Experiments</em></a> by <a target="_blank" rel="noopener" href="https://twitter.com/graemerocher">Graeme Rocher</a></p></li><li><p><a target="_blank" rel="noopener" href="https://medium.com/graalvm/instant-netty-startup-using-graalvm-native-image-generation-ed6f14ff7692"><em>Instant Netty Startup using GraalVM Native Image Generation</em></a> by <a target="_blank" rel="noopener" href="https://twitter.com/cstancu">Codruț Stancu</a></p></li><li><p><a target="_blank" rel="noopener" href="https://blog.frankel.ch/first-impressions-graalvm/"><em>My first impressions about Graal VM</em></a> by <a target="_blank" rel="noopener" href="https://twitter.com/nicolas_frankel">Nicolas Frankel</a></p></li><li><p><a target="_blank" rel="noopener" href="https://melix.github.io/blog/2019/03/simple-http-server-graal.html"><em>A simple native HTTP server with GraalVM</em></a> by <a target="_blank" rel="noopener" href="https://twitter.com/CedricChampeau">Cédric Champeau</a></p></li></ul></div></div></div><div class="sect1"><h2 id="updates">Updates</h2><div class="sectionbody"><div class="paragraph"><p>This blog gets updated whenever new version of GraalVM or Groovy gets released. Below you can find a list of all updates.</p></div><div class="ulist"><ul><li><p><strong class="mark">2019-11-22</strong>: Added information about problems with <strong>GraalVM</strong> <code>19.3.0</code> native image compiler.</p></li><li><p><strong class="mark">2019-11-07</strong>: Updated blog post to <strong>GraalVM</strong> <code>19.2.1</code> and <strong>Groovy</strong> <code>2.5.8</code>.</p></li><li><p><strong class="mark">2019-05-11</strong>: Updated blog post to <strong>GraalVM</strong> <code>19.0.0</code>.</p></li></ul></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a target="_blank" rel="noopener" href="https://www.graalvm.org/docs/release-notes/19_3/#native-image" class="bare">https://www.graalvm.org/docs/release-notes/19_3/#native-image</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. As explained by Condrut Stancu in the following Github issue comment <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/issues/346#issuecomment-383015796" class="bare">https://github.com/oracle/graal/issues/346#issuecomment-383015796</a></div><div class="footnote" id="_footnotedef_3"><a href="#_footnoteref_3">3</a>. You can read more about it here <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md#reflection" class="bare">https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md#reflection</a></div><div class="footnote" id="_footnotedef_4"><a href="#_footnoteref_4">4</a>. The manual reflection configuration is described here <a target="_blank" rel="noopener" href="https://github.com/oracle/graal/blob/master/substratevm/REFLECTION.md#manual-configuration" class="bare">https://github.com/oracle/graal/blob/master/substratevm/REFLECTION.md#manual-configuration</a></div></div></div><ul class="tags-list mt-4"><li><a href="/t/java/">java</a></li><li><a href="/t/groovy/">groovy</a></li><li><a href="/t/graalvm/">graalvm</a></li><li><a href="/t/native-image/">native-image</a></li></ul></article></div></div></div></div></section><section class="bg-dark posts-layout-01" id="related" data-debug="Scrolled to related posts"><div class="container py-5"><div class="row py-lg-5"><div class="col-12 col-lg-7 d-flex align-items-start mb-lg-0 mb-4"><div class="px-3 px-lg-0 pr-lg-5"><article><a href="/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/"><img class="mb-4 shadow" data-lazy="/images/cards/24.png" width="100%"></a><p class="subtitle m-0"><a href="/groovy-cookbook/">Groovy Cookbook</a></p><h3 class="m-0 serif"><a href="/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/">How to avoid "No tests were found" when using JUnit 5 with Groovy?</a></h3><div class="post-meta mb-4"><ul><li><time datetime="2018-10-24T07:00:48.000Z">October 24, 2018</time></li><li>21 min. read</li><li><a href="https://e.printstacktrace.blog/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/#disqus_thread">0 Comments</a></li></ul></div><p class="small">In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy.</p></article></div></div><div class="col-12 col-lg-5"><div class="px-3 px-lg-0"><article class="tile"><div class="row mb-4"><div class="col-9"><p class="subtitle m-0"><a href="/groovy-cookbook/">Groovy Cookbook</a></p><h4 class="m-0 serif"><a href="/graalvm-native-image-inside-docker-container-does-it-make-sense/">GraalVM native image inside docker container - does it make sense?</a></h4><div class="post-meta mb-4"><ul><li><time datetime="2019-01-19T12:19:22.000Z">January 19, 2019</time></li><li>21 min. read</li><li><a href="https://e.printstacktrace.blog/graalvm-native-image-inside-docker-container-does-it-make-sense/#disqus_thread">0 Comments</a></li></ul></div><p class="small">We have learned how to create GraalVM native image from standalone Groovy script in the previous...</p></div><div class="col-3"><a href="/graalvm-native-image-inside-docker-container-does-it-make-sense/"><img class="img-fluid rounded shadow-sm mt-3 mb-lg-0" data-lazy="/images/icons/24.png"></a></div></div></article><article class="tile"><div class="row mb-4"><div class="col-9"><p class="subtitle m-0"><a href="/ratpack-cookbook/">Ratpack Cookbook</a></p><h4 class="m-0 serif"><a href="/ratpack-graalvm-how-to-start/">Ratpack on GraalVM - how to start?</a></h4><div class="post-meta mb-4"><ul><li><time datetime="2019-02-15T02:10:39.000Z">February 15, 2019</time></li><li>21 min. read</li><li><a href="https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#disqus_thread">0 Comments</a></li></ul></div><p class="small">The journey inside the exciting world of GraalVM continues. Today I would like to share with you...</p></div><div class="col-3"><a href="/ratpack-graalvm-how-to-start/"><img class="img-fluid rounded shadow-sm mt-3 mb-lg-0" data-lazy="/images/icons/40.png"></a></div></div></article><article class="tile"><div class="row mb-4"><div class="col-9"><p class="subtitle m-0"><a href="/micronaut-cookbook/">Micronaut Cookbook</a></p><h4 class="m-0 serif"><a href="/building-stackoverflow-cli-with-java-11-micronaut-picocli-and-graalvm/">Building stackoverflow-cli with Java 11, Micronaut, Picocli, and GraalVM</a></h4><div class="post-meta mb-4"><ul><li><time datetime="2020-07-08T12:17:41.000Z">July 8, 2020</time></li><li>21 min. read</li><li><a href="https://e.printstacktrace.blog/building-stackoverflow-cli-with-java-11-micronaut-picocli-and-graalvm/#disqus_thread">0 Comments</a></li></ul></div><p class="small">In this blog post, I show you how to build stackoverflow-cli - a command-line application that a...</p></div><div class="col-3"><a href="/building-stackoverflow-cli-with-java-11-micronaut-picocli-and-graalvm/"><img class="img-fluid rounded shadow-sm mt-3 mb-lg-0" data-lazy="/images/icons/8.png"></a></div></div></article><a class="gatr" href="https://click.linksynergy.com/fs-bin/click?id=uow2LCEuhvQ&amp;offerid=572706.11&amp;type=3&amp;subid=0" data-type="banner" data-name="nordvpn-03" target="_blank"><img class="img-fluid" data-lazy="/images/yml/nord-vpn-03.png"></a></div></div></div></div></section><section class="sidebar-enabled" id="comments" data-debug="Scrolled to comments"><div class="container"><div class="row"><div class="col-12 col-lg-3 sidebar order-lg-1 order-0"><div class="py-lg-5 py-3 position-sticky text-center" style="top:20px"><div class="d-inline-block d-lg-none"><a class="gatr" href="https://www.jdoqocy.com/click-100191173-10952823" data-type="banner" data-name="grammarly-02" target="_blank"><img class="img-fluid" data-lazy="/images/yml/grammarly-02.png"></a></div><div class="d-none d-lg-inline-block"><a class="gatr" href="https://www.jdoqocy.com/click-100191173-10952823" data-type="banner" data-name="grammarly-01" target="_blank"><img class="img-fluid" data-lazy="/images/yml/grammarly-tower.png"></a></div></div></div><div class="col-12 col-lg-9 order-0 order-lg-0 order-1"><div class="pr-lg-5 py-5"><p class="m-0 serif small text-muted">Any thoughts or ideas?</p><h2 class="mb-4">Let's talk in the comment's section 💬</h2><div class="disqus-comments"><div class="tip mb-5">Want to put a code sample in the comment? Read the <a target="_blank" rel="noopener" href="https://help.disqus.com/en/articles/1717236-syntax-highlighting"><b>Syntax highlighting</b></a> guide for more information.</div><div class="comments"><div id="disqus_thread"><div id="disqus_empty" style="display:none">Empty</div></div></div></div><script>function load_disqus(e){var t=document.getElementById("disqus_empty");if(document.contains(t)){var d=document.getElementById("disqus_thread"),n=document.createElement("script"),s=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0];d&&t&&(t.remove(),n.type="text/javascript",n.async=!0,n.src="//"+e+".disqus.com/embed.js",s.appendChild(n))}}window.addEventListener("scroll",function(e){document.scrollingElement.scrollTop>document.getElementById("disqus_thread").offsetTop-500&&load_disqus("eprintstacktrace")},!1)</script></div></div></div></div></section></main><footer class="bg-dark" id="footer" data-debug="Scrolled to footer"><div class="container py-5"><div class="px-lg-0 px-3"><div class="row py-lg-3"><div class="col-12 col-md-6"><h5 class="mb-4">Latest blog posts</h5><ul class="list-unstyled mb-5"><li><a href="/merging-json-files-recursively-in-the-command-line/">Merging JSON files recursively in the command-line</a></li><li><a href="/jenkins-declarative-pipeline-dynamic-agent/">Jenkins Declarative Pipeline with the dynamic agent - how to configure it?</a></li><li><a href="/groovy-ecosystem-usage-report-2020/">Groovy Ecosystem Usage Report (2020)</a></li><li><a href="/how-to-convert-json-to-csv-from-the-command-line/">How to convert JSON to CSV from the command-line?</a></li><li><a href="/5-common-jenkins-pipeline-mistakes/">5 Common Jenkins Pipeline Mistakes</a></li><li><a href="/how-to-merge-two-maps-in-groovy/">How to merge two maps in Groovy?</a></li><li><a href="/building-stackoverflow-cli-with-java-11-micronaut-picocli-and-graalvm/">Building stackoverflow-cli with Java 11, Micronaut, Picocli, and GraalVM</a></li><li><a href="/how-to-catch-curl-response-in-jenkins-pipeline/">How to catch curl response in Jenkins Pipeline?</a></li><li><a href="/atomic-habits-book-review/">Atomic Habits - book review</a></li><li><a href="/parsing-json-in-command-line-with-jq-basic-filters-and-functions-part-1/">Parsing JSON in command-line with jq: basic filters and functions (part 1)</a></li></ul></div><div class="col-12 col-md-6"><h5 class="mb-4">Trending videos</h5><div class="youtube-row mb-4"><div class="row"><div class="col-12 col-lg-6 text-lg-left text-center mb-lg-0 mb-4"><a class="d-inline-block thumb gatr" target="_blank" rel="noopener" href="https://youtu.be/RPdugI8eZgo" data-type="youtube" data-name="Using GraalVM native-image with a Groovy script - from 2.1s to 0.013s startup time 🚀" data-time="15:51"><img class="img-fluid shadow" data-lazy="https://i3.ytimg.com/vi/RPdugI8eZgo/mqdefault.jpg"></a></div><div class="col-12 col-lg-6"><h6 class="m-0 p-0 mb-3 sans-serif text-lg-left text-center px-lg-0 px-4"><a class="gatr" target="_blank" rel="noopener" href="https://youtu.be/RPdugI8eZgo" data-type="youtube" data-name="Using GraalVM native-image with a Groovy script - from 2.1s to 0.013s startup time 🚀">Using GraalVM native-image with a Groovy script - from 2.1s to 0.013s startup time 🚀</a></h6><p class="sans-serif small text-justify">GraalVM native-image compiler uses ahead-of-time compilation to produce a highly optimized standalone executable file that ca...</p></div></div></div><div class="youtube-row mb-4"><div class="row"><div class="col-12 col-lg-6 text-lg-left text-center mb-lg-0 mb-4"><a class="d-inline-block thumb gatr" target="_blank" rel="noopener" href="https://youtu.be/Ei_Nk14vruE" data-type="youtube" data-name="Jenkins Declarative Pipeline vs Scripted Pipeline - 4 key differences | #jenkinspipeline" data-time="13:45"><img class="img-fluid shadow" data-lazy="https://i3.ytimg.com/vi/Ei_Nk14vruE/mqdefault.jpg"></a></div><div class="col-12 col-lg-6"><h6 class="m-0 p-0 mb-3 sans-serif text-lg-left text-center px-lg-0 px-4"><a class="gatr" target="_blank" rel="noopener" href="https://youtu.be/Ei_Nk14vruE" data-type="youtube" data-name="Jenkins Declarative Pipeline vs Scripted Pipeline - 4 key differences | #jenkinspipeline">Jenkins Declarative Pipeline vs Scripted Pipeline - 4 key differences | #jenkinspipeline</a></h6><p class="sans-serif small text-justify">Jenkins Pipeline as a code is a new standard for defining continuous integration and delivery pipelines in Jenkins. The scrip...</p></div></div></div></div></div><div class="row text-lg-left text-center"><div class="col-12 col-md-3 mb-lg-0 mb-4"><h5 class="mb-4">Useful links</h5><ul class="list-unstyled"><li><a class="gatr" href="/" data-type="footer-useful-links" data-name="Start here">Start here</a></li><li><a class="gatr" href="/about" data-type="footer-useful-links" data-name="About">About</a></li><li><a class="gatr" href="/archives" data-type="footer-useful-links" data-name="Archives">Archives</a></li><li><a class="gatr" href="/resources" data-type="footer-useful-links" data-name="Resources">Resources</a></li><li><a class="gatr" href="/privacy-policy" data-type="footer-useful-links" data-name="Privacy Policy">Privacy Policy</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://teespring.com/stores/eprintstacktrace" data-type="footer-useful-links" data-name="Merchandise">Merchandise</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://kit.co/wololock" data-type="footer-useful-links" data-name="My Kit">My Kit</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://feeds.feedburner.com/Eprintstacktracenet" data-type="footer-useful-links" data-name="RSS">RSS</a></li><li><a class="gatr" href="/support-me" data-type="footer-useful-links" data-name="Support me">Support the blog <em class="fas fa-heart color-red ml-2"></em></a></li></ul></div><div class="col-12 col-md-3 mb-lg-0 mb-4"><h5 class="mb-4">Popular categories</h5><ul class="list-unstyled"><li><a class="gatr" href="/groovy-cookbook/" data-type="footer-category" data-name="Groovy Cookbook">Groovy Cookbook<span class="count ml-2 text-muted">28</span></a></li><li><a class="gatr" href="/jenkins-pipeline-cookbook/" data-type="footer-category" data-name="Jenkins Pipeline Cookbook">Jenkins Pipeline Cookbook<span class="count ml-2 text-muted">9</span></a></li><li><a class="gatr" href="/programmers-bookshelf/" data-type="footer-category" data-name="Programmer's Bookshelf">Programmer's Bookshelf<span class="count ml-2 text-muted">6</span></a></li><li><a class="gatr" href="/micronaut-cookbook/" data-type="footer-category" data-name="Micronaut Cookbook">Micronaut Cookbook<span class="count ml-2 text-muted">4</span></a></li><li><a class="gatr" href="/ratpack-cookbook/" data-type="footer-category" data-name="Ratpack Cookbook">Ratpack Cookbook<span class="count ml-2 text-muted">4</span></a></li><li><a class="gatr" href="/learning-java/" data-type="footer-category" data-name="Learning Java">Learning Java<span class="count ml-2 text-muted">4</span></a></li><li><a class="gatr" href="/jq-cookbook/" data-type="footer-category" data-name="jq cookbook">jq cookbook<span class="count ml-2 text-muted">3</span></a></li><li><a class="gatr" href="/how-to/" data-type="footer-category" data-name="How to">How to<span class="count ml-2 text-muted">3</span></a></li><li><a class="gatr" href="/blog-reports/" data-type="footer-category" data-name="Blog Reports">Blog Reports<span class="count ml-2 text-muted">2</span></a></li></ul></div><div class="col-12 col-md-6"><h5 class="mb-4">Popular tags</h5><section class="tagcloud"><a href="/t/affiliate/" style="font-size:1.8em;color:#7b828b">affiliate</a> <a href="/t/async/" style="font-size:1.4em;color:#696f76">async</a> <a href="/t/benchmark/" style="font-size:1.6em;color:#727880">benchmark</a> <a href="/t/blogging/" style="font-size:1.2em;color:#60666b">blogging</a> <a href="/t/book/" style="font-size:2em;color:#848b95">book</a> <a href="/t/career/" style="font-size:1.2em;color:#60666b">career</a> <a href="/t/cicd/" style="font-size:2.4em;color:#969daa">cicd</a> <a href="/t/continuous-integration/" style="font-size:1.4em;color:#696f76">continuous-integration</a> <a href="/t/curl/" style="font-size:1.6em;color:#727880">curl</a> <a href="/t/devops/" style="font-size:2.2em;color:#8d94a0">devops</a> <a href="/t/docker/" style="font-size:1.6em;color:#727880">docker</a> <a href="/t/git/" style="font-size:1.2em;color:#60666b">git</a> <a href="/t/github/" style="font-size:1.4em;color:#696f76">github</a> <a href="/t/graalvm/" style="font-size:2.4em;color:#969daa">graalvm</a> <a href="/t/gradle/" style="font-size:1.2em;color:#60666b">gradle</a> <a href="/t/grails/" style="font-size:1.4em;color:#696f76">grails</a> <a href="/t/groovy/" style="font-size:3em;color:#b1b9ca">groovy</a> <a href="/t/haskell/" style="font-size:1.4em;color:#696f76">haskell</a> <a href="/t/hexo/" style="font-size:1.2em;color:#60666b">hexo</a> <a href="/t/java/" style="font-size:2.8em;color:#a8b0bf">java</a> <a href="/t/java-8/" style="font-size:1.4em;color:#696f76">java-8</a> <a href="/t/jenkins/" style="font-size:2.6em;color:#9fa7b5">jenkins</a> <a href="/t/jenkins-pipeline/" style="font-size:2.6em;color:#9fa7b5">jenkins-pipeline</a> <a href="/t/jenkinsfile/" style="font-size:1.4em;color:#696f76">jenkinsfile</a> <a href="/t/jmh/" style="font-size:1.8em;color:#7b828b">jmh</a> <a href="/t/jq/" style="font-size:1.6em;color:#727880">jq</a> <a href="/t/json/" style="font-size:1.6em;color:#727880">json</a> <a href="/t/junit/" style="font-size:1.4em;color:#696f76">junit</a> <a href="/t/learning/" style="font-size:1.6em;color:#727880">learning</a> <a href="/t/maven/" style="font-size:1.4em;color:#696f76">maven</a> <a href="/t/metaprogramming/" style="font-size:1.2em;color:#60666b">metaprogramming</a> <a href="/t/micronaut/" style="font-size:2em;color:#848b95">micronaut</a> <a href="/t/native-image/" style="font-size:1.8em;color:#7b828b">native-image</a> <a href="/t/non-blocking/" style="font-size:1.6em;color:#727880">non-blocking</a> <a href="/t/progress/" style="font-size:1.2em;color:#60666b">progress</a> <a href="/t/ratpack/" style="font-size:2.4em;color:#969daa">ratpack</a> <a href="/t/reactive-programming/" style="font-size:1.4em;color:#696f76">reactive-programming</a> <a href="/t/reading/" style="font-size:1.4em;color:#696f76">reading</a> <a href="/t/recursion/" style="font-size:1.4em;color:#696f76">recursion</a> <a href="/t/review/" style="font-size:2em;color:#848b95">review</a> <a href="/t/rxjava/" style="font-size:1.4em;color:#696f76">rxjava</a> <a href="/t/sdkman/" style="font-size:1.6em;color:#727880">sdkman</a> <a href="/t/session/" style="font-size:1.2em;color:#60666b">session</a> <a href="/t/split/" style="font-size:1.2em;color:#60666b">split</a> <a href="/t/spock/" style="font-size:1.6em;color:#727880">spock</a> <a href="/t/stackoverflow/" style="font-size:1.4em;color:#696f76">stackoverflow</a> <a href="/t/string/" style="font-size:1.4em;color:#696f76">string</a> <a href="/t/tail-call/" style="font-size:1.2em;color:#60666b">tail-call</a> <a href="/t/tail-recursion/" style="font-size:1.2em;color:#60666b">tail-recursion</a> <a href="/t/unit-test/" style="font-size:1.6em;color:#727880">unit-test</a></section></div></div></div></div><section class="bottom"><div class="container"><ul class="text-center py-1 m-0"><li class="d-inline-block">Designed by <a class="gatr" target="_blank" rel="noopener" href="https://twitter.com/wololock" data-type="footer" data-name="designed">@wololock</a></li><li class="d-inline-block">Created with <a class="gatr" target="_blank" rel="noopener" href="https://hexo.io" data-type="footer" data-name="hexo">Hexo</a></li><li class="d-inline-block">Hosted on <a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock/wololock.github.io" data-type="footer" data-name="github">GitHub</a></li><li class="d-inline-block">Deployed with <a class="gatr" target="_blank" rel="noopener" href="https://circleci.com/gh/wololock/wololock.github.io" data-type="footer" data-name="circleci">Circle CI</a></li><li class="d-inline-block">License <a class="gatr" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" data-type="footer" data-name="license">CC BY-NC-SA 4.0</a></li><li class="d-inline-block"><a class="gatr" target="_blank" rel="noopener" href="https://github.com/wololock/wololock.github.io/commits/develop" data-type="footer" data-name="last-commit"><img data-lazy="https://badgen.net/github/last-commit/wololock/wololock.github.io?color=blue&amp;scale=0.8"></a></li></ul></div></section></footer><script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/48c5da59c9.js" crossorigin="anonymous" async></script><script async id="cookiebanner" src="//cdnjs.cloudflare.com/ajax/libs/cookie-banner/1.2.2/cookiebanner.min.js" data-moreinfo="/privacy-policy/" data-message="This blog uses cookies to enhance your experience. By continuing to visit it you agree to its use of cookies." data-link="#5fc4ff" data-font-family="Lora,serif" data-font-size="16px" data-bg="#1d2b36"></script><script src="/js/main.js?v=11"></script><script src="/js/highlightjs/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script async id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><script>!function(e,t,a,c,n,i,r){e.GoogleAnalyticsObject=n,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=t.createElement(a),r=t.getElementsByTagName(a)[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(i,r)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"),jQuery(document).on("mousedown","a.gatr",function(e){var t=jQuery(this),a=t.attr("data-type"),c=t.attr("data-name"),n=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event",a,n,c),!0}),jQuery(document).on("mousedown","#related a",function(e){var t=jQuery(this),a=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event","related",a,t.attr("href")),!0}),jQuery(document).on("mousedown","#footer a",function(e){var t=jQuery(this),a=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event","footer",a,t.attr("href")),!0})</script><script>!function(){"use strict";function r(e){var t=e.getAttribute("data-original"),n=new Image;n.onload=function(){e.setAttribute("src",t),e.style.paddingTop=""},n.src=t}document.addEventListener("DOMContentLoaded",function(){var t,e,n,i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));i.length&&("undefined"!=typeof IntersectionObserver?(t=new IntersectionObserver(function(e,t){e.filter(function(e){return e.isIntersecting}).forEach(function(e){r(e.target),t.unobserve(e.target)})}),i.forEach(function(e){t.observe(e)})):(n=function(){clearTimeout(e),e=setTimeout(function(){return(i=i.filter(function(e){return!e.src})).length?void i.filter(function(e){e.getBoundingClientRect().top<window.innerHeight&&r(e)}):(window.removeEventListener("scroll",n),void window.removeEventListener("resize",n))},100)},window.addEventListener("scroll",n),window.addEventListener("resize",n),n()))},!1)}();</script></body></html>