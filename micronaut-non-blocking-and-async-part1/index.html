<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="Szymon Stepniak"><meta name="robots" content="index, follow"><title>Non-blocking and async Micronaut - quick start (part 1)</title><meta name="description" content="Micronaut framework inventors says it is designed for building modern microservice applications. It supports reactive and non-blocking HTTP requests processing..."><meta name="keywords" content="java,netty,micronaut,non-blocking,async,reactive-programming,rxjava"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//stackpath.bootstrapcdn.com"><link rel="dns-prefetch" href="//disqus.com"><link rel="dns-prefetch" href="//c.disquscdn.com"><link href="//fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;700&amp;display=swap" rel="stylesheet"><link href="//fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&amp;display=swap" rel="stylesheet"><link href="//fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet"><link href="//fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"><link rel="shortcut icon" type="image/png" href="/favicon_new.png"><link rel="stylesheet" href="/css/highlightjs.css"><link rel="stylesheet" href="/css/main.css?v=51"><link rel="canonical" href="https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part1/"><meta name="description" content="Micronaut framework inventors says it is designed for building modern microservice applications. It supports reactive and non-blocking HTTP requests processing thanks to a powerful network application"><meta property="og:type" content="article"><meta property="og:title" content="Non-blocking and async Micronaut - quick start (part 1)"><meta property="og:url" content="https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part1/"><meta property="og:site_name" content="Szymon Stepniak - Freelance Groovy Developer &amp; DevOps"><meta property="og:description" content="Micronaut framework inventors says it is designed for building modern microservice applications. It supports reactive and non-blocking HTTP requests processing thanks to a powerful network application"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://e.printstacktrace.blog/images/og/micronaut-nonblocking-part1.jpg"><meta property="article:published_time" content="2018-10-25T00:33:37.000Z"><meta property="article:modified_time" content="2019-11-19T11:21:07.000Z"><meta property="article:author" content="Szymon Stepniak"><meta property="article:tag" content="java"><meta property="article:tag" content="netty"><meta property="article:tag" content="micronaut"><meta property="article:tag" content="non-blocking"><meta property="article:tag" content="async"><meta property="article:tag" content="reactive-programming"><meta property="article:tag" content="rxjava"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://e.printstacktrace.blog/images/og/micronaut-nonblocking-part1.jpg"><meta name="twitter:creator" content="@wololock"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part1/"},"headline":"Non-blocking and async Micronaut - quick start (part 1)","image":{"@type":"ImageObject","url":"https://e.printstacktrace.blog/images/og/micronaut-nonblocking-part1.jpg"},"datePublished":"2018-10-25T00:33:37.000Z","dateModified":"2019-11-19T11:21:07.000Z","author":{"@type":"Person","name":"Szymon Stepniak"},"publisher":{"@type":"Organization","name":"Szymon Stepniak - Freelance Groovy Developer & DevOps","logo":{"@type":"ImageObject","url":"https://e.printstacktrace.blog/images/site-logo.jpg","height":60,"width":600}},"description":"Micronaut framework inventors says it is designed for building modern microservice applications. It supports reactive and non-blocking HTTP requests processing thanks to a powerful network application framework - Netty. In this blog post I will give you a quick and practical introduction to a asynchronous HTTP requests processing using a simple demo application. No more talking, it&#8217;s time to make our hands dirty with some Micronaut application code! ","keywords":"java,netty,micronaut,non-blocking,async,reactive-programming,rxjava"}</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Szymon Stepniak - Freelance Groovy Developer & DevOps" type="application/atom+xml">
<style>.img-lazyload-container{overflow:hidden;max-width:100%}.img-lazyload-container img{max-width:100%;display:block;height:auto;transition:opacity .5s ease-in-out}.img-lazyload-container img:not([src]){height:0;opacity:0}</style></head><body class="layout-post"><header class="fixed-top" id="header"><div class="container-fluid px-md-auto px-0"><nav class="navbar navbar-expand-lg"><h3 class="logo mr-auto position-relative">e.printstacktrace.blog<a class="stretched-link" href="/"></a></h3><span class="badge badge-info badge-pill h5 ml-2">NEW!</span><button class="navbar-toggler" data-toggle="collapse" data-target="#mainNav" aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="mainNav"><ul class="navbar-nav ml-lg-auto text-center text-md-left d-block d-lg-flex"><li class="nav-item"><a class="nav-link" href="/">Start here</a></li><li class="nav-item"><a class="nav-link" href="/about">About</a></li><li class="nav-item"><a class="nav-link" href="/support-me">Support me</a></li><li class="nav-item"><a class="nav-link" href="/archives">Archives</a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link" href="https://twitter.com/wololock" target="_blank" rel="noopener"><em class="fa fa-twitter"></em></a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link" href="https://github.com/wololock" target="_blank" rel="noopener"><em class="fa fa-github"></em></a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link" href="https://stackoverflow.com/users/2194470/szymon-stepniak" target="_blank" rel="noopener"><em class="fa fa-stack-overflow"></em></a></li><li class="nav-item d-inline-block d-lg-block mx-2 mx-lg-0"><a class="nav-link" href="https://youtube.com/c/eprintstacktrace" target="_blank" rel="noopener"><em class="fa fa-youtube"></em></a></li></ul></div></nav></div></header><main id="page-post" role="main" itemscope itemtype="http://schema.org/Article"><header class="jumbotron text-center pb-5" style="background-image:url(/img/micronaut-bg.jpg)"><div class="mask"></div><div class="container pt-5 pb-1"><a class="category mark" href="/micronaut-cookbook/">Micronaut Cookbook</a><h1 class="mt-2 mt-md-0" itemprop="name">Non-blocking and async Micronaut - quick start (part 1)</h1><section class="post-meta"><ul><li><time datetime="2018-10-25T00:33:37.000Z" itemprop="datePublished">Oct 25, 2018</time></li><li>15 min. read</li><li><a href="https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part1/#disqus_thread">0 Comments</a></li></ul></section></div></header><article class="post-content" role="article" itemprop="articleBody"><div class="container"><div class="row"><div class="col-12 offset-0 col-md-10 offset-md-1 pt-4 pt-md-5"><div class="paragraph"><p><a href="https://micronaut.io/" target="_blank" rel="noopener">Micronaut</a> framework inventors says it is designed for building modern microservice applications. It supports reactive and non-blocking HTTP requests processing thanks to a powerful network application framework - <a href="https://netty.io/" target="_blank" rel="noopener">Netty</a>. In this blog post I will give you a quick and practical introduction to a asynchronous HTTP requests processing using a simple demo application. No more talking, it&#8217;s time to make our hands dirty with some Micronaut application code! <span class="icon"><i class="fa fa-smile-o"></i></span></p></div><a id="more"></a><div class="admonitionblock warning"><table><tr><td class="icon"><i class="fa icon-warning" title="Warning"></i></td><td class="content">This is not a introduction to Micronaut. If you are not familiar with the framework, consider reading official <a href="https://docs.micronaut.io/latest/guide/index.html" target="_blank" rel="noopener">User Guide</a> first.</td></tr></table></div><div class="sect1"><h2 id="introduction">Introduction</h2><div class="sectionbody"><div class="paragraph"><p>In this article, we are going to build a demo application that mimics communication between two remote services, that for simplicity are part of the same application:</p></div><div class="ulist"><ul><li><p><strong>product-service</strong> exposes a single endpoint <code>(GET) /product/{id}</code> which returns specific product information. We will simulate high latency (fixed on different products) - the idea is that this service might communicate with <code>n</code> different remote services to collect final product information.</p></li><li><p><strong>recommendations-service</strong> exposes a single endpoint <code>(GET) /recommendations</code> which returns fixed number of recommendations. We won&#8217;t focus on building solid recommendations system - this service is just a mock that communicates over HTTP with <strong>product-service</strong> to get the information about products it&#8217;s going to recommend to the user. A single HTTP request to recommendations-service endpoint will cause 4 additional non-blocking requests to product-service endpoint.</p></li></ul></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">This example was inspired by demo I made for my <a href="https://github.com/wololock/ratpack-quickstart-demo" target="_blank" rel="noopener"><em>"Ratpack - practical quickstart"</em></a> presentation.</td></tr></table></div><div class="paragraph"><p>Micronaut is shipped with a handy command line tool <code>mn</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">$ mn --version
<span class="color-purple">|</span> Micronaut Version: 1.2.6
<span class="color-purple">|</span> JVM Version: 1.8.0_201

$ mn --help
Resolving dependencies..
<strong class="underline">Usage:</strong> <strong>mn</strong> &#91;<span class="color-yellow">-hnvVx</span>&#93; [COMMAND]
Micronaut CLI command line interface for generating projects and services.
Commonly used commands are:
  <strong>create-app</strong> <span class="color-yellow">NAME</span>
  <strong>create-cli-app</strong> <span class="color-yellow">NAME</span>
  <strong>create-federation</strong> <span class="color-yellow">NAME --services SERVICE_NAME[,SERVICE_NAME]...</span>
  <strong>create-function</strong> <span class="color-yellow">NAME</span>

<strong class="underline">Options:</strong>
  <span class="color-yellow">-h, --help</span>           Show this help message and exit.
  <span class="color-yellow">-n, --plain-output</span>   Use plain text instead of ANSI colors and styles.
  <span class="color-yellow">-v, --verbose</span>        Create verbose output.
  <span class="color-yellow">-V, --version</span>        Print version information and exit.
  <span class="color-yellow">-x, --stacktrace</span>     Show full stack trace when exceptions occur.

<strong class="underline">Commands:</strong>
  <strong>create-app</strong>         Creates an application
  <strong>create-cli-app</strong>     Creates a command line application
  <strong>create-federation</strong>  Creates a federation of services
  <strong>create-function</strong>    Creates a serverless function application
  <strong>create-profile</strong>     Creates a profile
  <strong>help</strong>               Prints help information for a specific command
  <strong>list-profiles</strong>      Lists the available profiles
  <strong>profile-info</strong>       Display information about a given profile</code></pre></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You can install Micronaut CLI using <a href="https://sdkman.io/sdks#micronaut" target="_blank" rel="noopener">SDKMAN!</a> - <code>sdk install micronaut</code></td></tr></table></div><div class="paragraph"><p>Now we are able to create Micronaut application skeleton:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">$ mn create-app micronaut-nonblocking-async-demo --lang=java --features=spock
<span class="color-purple">|</span> Generating Java project...
<span class="color-purple">|</span> Application created at /tmp/micronaut-nonblocking-async-demo</code></pre></div></div><div class="paragraph"><p>It creates a new application using Gradle build tool (switching to Maven is possible if needed). We want to use Java (<code>--lang=java</code>) and Spock testing framework (<code>--features=spock</code>) instead of JUnit. After applying a few small changes our final <code>build.gradle</code> file looks like this:</p></div><div class="listingblock"><div class="title">Listing 1. build.gradle</div><div class="content"><pre class="highlightjs highlight"><code data-lang="groovy" class="language-groovy hljs">plugins {
    id "com.github.johnrengelman.shadow" version "5.0.0"
    id "application"
    id "net.ltgt.apt-eclipse" version "0.21"
    id "groovy"
    id "jacoco"
}

version "0.2.0"
group "micronaut.nonblocking.async.demo"

repositories {
    mavenCentral()
    maven { url "https://jcenter.bintray.com" }
}

configurations {
    // for dependencies that are needed for development only
    developmentOnly
}

dependencies {
    annotationProcessor platform("io.micronaut:micronaut-bom:$micronautVersion")
    annotationProcessor "io.micronaut:micronaut-inject-java"
    annotationProcessor "io.micronaut:micronaut-validation"
    implementation platform("io.micronaut:micronaut-bom:$micronautVersion")
    implementation "io.micronaut:micronaut-http-client"
    implementation "io.micronaut:micronaut-inject"
    implementation "io.micronaut:micronaut-validation"
    implementation "io.micronaut:micronaut-runtime"
    implementation "io.micronaut:micronaut-http-server-netty"
    runtimeOnly "ch.qos.logback:logback-classic:1.2.3"
    testAnnotationProcessor platform("io.micronaut:micronaut-bom:$micronautVersion")
    testAnnotationProcessor "io.micronaut:micronaut-inject-java"
    testImplementation platform("io.micronaut:micronaut-bom:$micronautVersion")
    testImplementation "org.junit.jupiter:junit-jupiter-api"
    testImplementation "io.micronaut.test:micronaut-test-junit5"
    testImplementation("org.spockframework:spock-core") {
        exclude group: "org.codehaus.groovy", module: "groovy-all"
    }
    testImplementation "io.micronaut:micronaut-inject-groovy"
    testImplementation "io.micronaut.test:micronaut-test-spock"
    testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine"
    testRuntimeOnly "org.junit.vintage:junit-vintage-engine:5.5.0"
}

test.classpath += configurations.developmentOnly

mainClassName = "micronaut.nonblocking.async.demo.Application"
// use JUnit 5 platform
test {
    useJUnitPlatform()
}

shadowJar {
    mergeServiceFiles()
}

run.classpath += configurations.developmentOnly
run.jvmArgs('-noverify', '-XX:TieredStopAtLevel=1', '-Dcom.sun.management.jmxremote')
tasks.withType(JavaCompile){
    options.encoding = "UTF-8"
    options.compilerArgs.add('-parameters')
}</code></pre></div></div></div></div><div class="sect1"><h2 id="implementing-product-service">Implementing product-service</h2><div class="sectionbody"><div class="paragraph"><p>We start with writing some product-service code. For simplicity we will put both services to a single app - this is OK for this demo, but in real-life you would keep these two services as separate applications. Here is a list of files we are going to create:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">products
├── ProductClient.java
├── ProductController.java
├── Product.java
└── ProductService.java</code></pre></div></div><div class="ulist"><ul><li><p><code>Product</code> class is defined by 3 simple properties: <code>id</code>, <code>name</code> and <code>price</code>. <a href="https://github.com/wololock/micronaut-nonblocking-async-demo/blob/master/src/main/java/com/github/wololock/micronaut/products/Product.java" target="_blank" rel="noopener">Nothing fancy</a>.</p></li><li><p><code>ProductService</code> stores 4 exemplary products in memory and simulates high latency when retrieving products by id.</p></li><li><p><code>ProductController</code> exposes a public API endpoint.</p></li><li><p><code>ProductClient</code> is Micronaut&#8217;s special interface that generates an HTTP client we can use to communicate with the API from other services (from recommendations-service for instance).</p></li></ul></div><div class="paragraph"><p>Here is what implementation of <code>ProductService</code> looks like:</p></div><div class="listingblock"><div class="title">Listing 2. src/main/java/com/github/wololock/micronaut/products/ProductService.java</div><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.github.wololock.micronaut.products;

import io.reactivex.Maybe;
import io.reactivex.schedulers.Schedulers;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.inject.Singleton;
import java.math.BigDecimal;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.function.Supplier;

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
final class ProductService {

    private static final Logger log = LoggerFactory.getLogger(ProductService.class);

    private static final Map&lt;String, Supplier&lt;Product&gt;&gt; products = new ConcurrentHashMap&lt;&gt;();

    static {
        products.put("PROD-001", createProduct("PROD-001", "Micronaut in Action", 29.99, 120));
        products.put("PROD-002", createProduct("PROD-002", "Netty in Action", 31.22, 190));
        products.put("PROD-003", createProduct("PROD-003", "Effective Java, 3rd edition", 31.22, 600));
        products.put("PROD-004", createProduct("PROD-004", "Clean Code", 31.22, 1200));
    }

    public Maybe&lt;Product&gt; findProductById(final String id) { <i class="conum" data-value="2"></i><b>(2)</b>
        return Maybe.just(id)
                .subscribeOn(Schedulers.io()) <i class="conum" data-value="3"></i><b>(3)</b>
                .map(it -&gt; products.getOrDefault(it, () -&gt; null).get());
    }

    private static Supplier&lt;Product&gt; createProduct(final String id, final String name, final Double price, final int latency) {
        return () -&gt; {
            simulateLatency(latency); <i class="conum" data-value="4"></i><b>(4)</b>
            log.debug("Product with id {} ready to return...", id);
            return new Product(id, name, BigDecimal.valueOf(price));
        };
    }

    private static void simulateLatency(final int millis) {
        try {
            Thread.sleep(millis);
        } catch (InterruptedException ignored) {}
    }
}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>@javax.inject.Singleton</code> annotation instructs Micronaut that this class represents a bean to inject.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td><code>Maybe&lt;Product&gt;</code> return type means that this method returns a single <code>Product</code>, or no value, or throws exception.</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Calling <code>subscribeOn(Schedulers.io())</code> moves calculation to a scheduler responsible for running IO-bound work.</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>We simulate latency with <code>Thread.sleep(millis)</code> before returning a <code>Product</code> object from a supplier.</td></tr></table></div><div class="paragraph"><p>The most important and the most interesting part is implemented in <code>ProductService</code> class. Firstly, we store a few products in memory as <code>Supplier&lt;Product&gt;</code> to simulate latency inside supplier&#8217;s body. Secondly, we return <code>Maybe&lt;Product&gt;</code> type to inform that <code>Product</code> may or not be returned, which is expected if we call the method with <code>id</code> that does not map to any existing product.</p></div><div class="paragraph"><p>Take a look how the <code>findProductById</code> method is implemented. We start with creating <code>Maybe&lt;String&gt;</code> object using <code>id</code> received from the method call. Then we switch to <code>Schedulers.io()</code> scheduler to move execution of this blocking operation to a thread-pool that is designed to execute such operations. And finally we map <code>id</code> to a product associated with it and we return <code>Maybe&lt;Product&gt;</code> type. For this demo purpose we also log some debug information - it will be useful when we execute a few parallel requests to see how it works.</p></div><div class="paragraph"><p>Now it is time to implement <code>ProductController</code> - our public API endpoint:</p></div><div class="listingblock"><div class="title">Listing 3. src/main/java/com/github/wololock/micronaut/products/ProductController.java</div><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.github.wololock.micronaut.products;

import io.micronaut.http.annotation.Controller;
import io.micronaut.http.annotation.Get;
import io.reactivex.Maybe;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

@Controller("/product") <i class="conum" data-value="1"></i><b>(1)</b>
final class ProductController {

    private static final Logger log = LoggerFactory.getLogger(ProductController.class);

    private final ProductService productService;

    public ProductController(ProductService productService) { <i class="conum" data-value="2"></i><b>(2)</b>
        this.productService = productService;
    }

    @Get("/{id}") <i class="conum" data-value="3"></i><b>(3)</b>
    public Maybe&lt;Product&gt; getProduct(String id) { <i class="conum" data-value="4"></i><b>(4)</b>
        log.debug("ProductController.getProduct({}) executed...", id);

        return productService.findProductById(id).onErrorComplete(); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>@Controller("/products")</code> annotation registers HTTP handler class.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Constructor injection does not require any annotation.</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td><code>@Get("/{id}")</code> defines GET mapping and path token <code>id</code>.</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td><code>Maybe&lt;Product&gt;</code> return type instructs event-loop that we are going to execute this request in a non-blocking manner.</td></tr><tr><td><i class="conum" data-value="5"></i><b>5</b></td><td>Calling <code>onErrorComplete()</code> ensures that in case of <code>null</code> product HTTP server will produce <code>404 Not Found</code> response.</td></tr></table></div><div class="paragraph"><p>And the last, but not least - <code>ProductClient</code> interface:</p></div><div class="listingblock"><div class="title">Listing 4. src/main/java/com/github/wololock/micronaut/products/ProductClient.java</div><div class="content"><pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.github.wololock.micronaut.products;

import io.micronaut.http.annotation.Get;
import io.micronaut.http.client.annotation.Client;
import io.reactivex.Maybe;

@Client("/product")
public interface ProductClient {

    @Get("/{id}")
    Maybe&lt;Product&gt; getProduct(final String id);
}</code></pre></div></div><div class="paragraph"><p>Micronaut will generate and compile HTTP client that implements this interface - no runtime proxy that slows down our applications. Brilliant!</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Source code can be found here: <span class="icon"><i class="fa fa-github"></i></span> <a href="https://github.com/wololock/micronaut-nonblocking-async-demo" target="_blank" rel="noopener">wololock/micronaut-nonblocking-async-demo</a></td></tr></table></div></div></div><div class="sect1"><h2 id="running-product-service">Running product-service</h2><div class="sectionbody"><div class="paragraph"><p>Now it is time to run our service and see it in action:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ gradle run</code></pre></div></div><div class="paragraph"><p>After about a second we will information that our server application is running:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">01:31:27.475 [main] INFO  - Startup completed in 636ms. Server Running: http://localhost:8080</code></pre></div></div><div class="paragraph"><p>Let&#8217;s execute two requests. I will use <a href="https://httpie.org/" target="_blank" rel="noopener">HTTPie</a> in below examples:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs"><strong>$ http localhost:8080/product/PROD-001</strong>

HTTP/1.1 200 OK
Date: Thu, 25 Oct 2018 01:34:15 GMT
connection: keep-alive
content-length: 60
content-type: application/json

{
    "id": "PROD-001",
    "name": "Micronaut in Action",
    "price": 29.99
}</code></pre></div></div><div class="paragraph"><p>Product with id <code>PROD-001</code> returned successfully. Now let&#8217;s take a look what does the response for non-existing product looks like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="http" class="language-http hljs"><strong>$ http localhost:8080/product/PROD-008</strong>

HTTP/1.1 404 Not Found
Date: Thu, 25 Oct 2018 01:35:11 GMT
connection: close
content-length: 93
content-type: application/json

{
    "_links": {
        "self": {
            "href": "/product/PROD-008",
            "templated": false
        }
    },
    "message": "Page Not Found"
}</code></pre></div></div></div></div><div class="sect1"><h2 id="executing-multiple-parallel-requests">Executing multiple parallel requests</h2><div class="sectionbody"><div class="paragraph"><p>Above examples shown that application works as expected. But does it process requests in a&nbsp;non-blocking manner? Let&#8217;s test it out. Firstly, we will update <code>application.yml</code> and set a single event-loop to process all incoming requests:</p></div><div class="listingblock"><div class="title">Listing 5. src/main/resources/application.yml</div><div class="content"><pre class="highlightjs highlight"><code data-lang="yml" class="language-yml hljs">micronaut:
    application:
        name: micronaut-nonblocking-async-demo

    server:
        maxRequestSize: 1MB
        host: localhost
        netty:
           maxHeaderSize: 500KB
           worker:
              threads: 1
           parent:
              threads: 1
           childOptions:
              autoRead: true</code></pre></div></div><div class="paragraph"><p>Following configuration means that there is only one event-loop (a single thread) that is responsible for handling incoming HTTP requests. The whole idea here is to keep this event-loop ready to process requests and delegate all blocking operations to a separate thread-pool where they can block for some amount of time.</p></div><div class="paragraph"><p>We will use <a href="https://github.com/JoeDog/siege" target="_blank" rel="noopener">siege</a> - an http load tester and benchmarking command line tool that allows us executing multiple concurrent requests. We will execute 20 multiple HTTP requests to see how our application reacts to 20 concurrent requests with just a single thread dedicated to handling requests:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ siege -c 20 -r 1 http://localhost:8080/product/PROD-003

** SIEGE 4.0.4
** Preparing 20 concurrent users for battle.
The server is now under siege...
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.61 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003
HTTP/1.1 200     0.62 secs:      68 bytes ==&gt; GET  /product/PROD-003

Transactions:		          20 hits
Availability:		      100.00 %
Elapsed time:		        0.62 secs
Data transferred:	        0.00 MB
Response time:		        0.62 secs
Transaction rate:	       32.26 trans/sec
Throughput:		        0.00 MB/sec
Concurrency:		       19.87
Successful transactions:          20
Failed transactions:	           0
Longest transaction:	        0.62
Shortest transaction:	        0.61</code></pre></div></div><div class="paragraph"><p>Our application handled 20 concurrent requests with a single computation thread. <code>PROD-003</code> has <code>600ms</code> latency, so all responses returned approximately at the same time. And here is what console log looks like after handling these 20 requests:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">01:51:46.623 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.630 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.630 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.630 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.631 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.631 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.631 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.631 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.632 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.632 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.632 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.632 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.632 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.633 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.633 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.633 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.633 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.633 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.634 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:46.634 [nioEventLoopGroup-1-2     ] DEBUG - ProductController.getProduct(PROD-003) executed...
01:51:47.231 [RxCachedThreadScheduler-1 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.231 [RxCachedThreadScheduler-2 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.231 [RxCachedThreadScheduler-4 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.231 [RxCachedThreadScheduler-5 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.231 [RxCachedThreadScheduler-3 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.231 [RxCachedThreadScheduler-6 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.231 [RxCachedThreadScheduler-7 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.232 [RxCachedThreadScheduler-8 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.232 [RxCachedThreadScheduler-9 ] DEBUG - Product with id PROD-003 ready to return...
01:51:47.232 [RxCachedThreadScheduler-10] DEBUG - Product with id PROD-003 ready to return...
01:51:47.232 [RxCachedThreadScheduler-11] DEBUG - Product with id PROD-003 ready to return...
01:51:47.233 [RxCachedThreadScheduler-12] DEBUG - Product with id PROD-003 ready to return...
01:51:47.233 [RxCachedThreadScheduler-13] DEBUG - Product with id PROD-003 ready to return...
01:51:47.233 [RxCachedThreadScheduler-14] DEBUG - Product with id PROD-003 ready to return...
01:51:47.233 [RxCachedThreadScheduler-15] DEBUG - Product with id PROD-003 ready to return...
01:51:47.233 [RxCachedThreadScheduler-16] DEBUG - Product with id PROD-003 ready to return...
01:51:47.234 [RxCachedThreadScheduler-17] DEBUG - Product with id PROD-003 ready to return...
01:51:47.234 [RxCachedThreadScheduler-18] DEBUG - Product with id PROD-003 ready to return...
01:51:47.234 [RxCachedThreadScheduler-19] DEBUG - Product with id PROD-003 ready to return...
01:51:47.234 [RxCachedThreadScheduler-20] DEBUG - Product with id PROD-003 ready to return...</code></pre></div></div><div class="paragraph"><p>This log shows clearly what is the biggest benefit of non-blocking HTTP requests processing. We use a single event-loop running in <code>nioEventLoopGroup-1-2</code> thread. It receives HTTP request and instead of blocking for 600 milliseconds (latency of <code>PROD-003</code> product) it delegates operation to IO thread pool and is ready to handle next request. The default IO thread pool uses cached thread pool, so in this case it spawns 20 threads to handle the operation and they will wait 60 seconds to handle another job.</p></div></div></div><div class="sect1"><h2 id="conclusion">Conclusion</h2><div class="sectionbody"><div class="paragraph"><p>Part 1 ends here. You have seen Micronaut&#8217;s non-blocking processing in action, and what is even more important - now you know that switching from blocking model to a non-blocking one does not require a huge mind shift. In the part 2 we will implement recommendations-service side and integrate it with product-service endpoint using Micronaut&#8217;s reactive HTTP client.</p></div><div class="paragraph"><p>I hope you have learned something interesting today. If you are interested in Micronaut, please leave a comment below and let me know what kind of topics interest you the most. Stay tuned, and until the next time!</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">Continue reading here - <a href="https://e.printstacktrace.blog/2018/10/micronaut-non-blocking-and-async-part-2/">Non-blocking and async Micronaut — quick start (part 2)</a></td></tr></table></div><h2 id="thank-you" class="discrete">Thank you!</h2><div class="paragraph"><p>If you read up to this point - leave me a comment below so that I can <strong>thank you</strong> in person for such an engagement. You can share this blog post on <span class="icon color-twitter"><i class="fa fa-twitter"></i></span> <a href="https://twitter.com/intent/tweet?text=%22Non-blocking%20and%20async%20Micronaut%20-%20quick%20start%20(part%201)%22%20https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part1/%20via%20@wololock" target="_blank" rel="noopener">Twitter</a> or <span class="icon color-linkedin"><i class="fa fa-linkedin-square"></i></span> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part1/&title=Non-blocking%20and%20async%20Micronaut%20-%20quick%20start%20(part%201)" target="_blank" rel="noopener">LinkedIn</a> to help me reach a broader audience. If you appreciate my work on this blog, consider <a href="https://e.printstacktrace.blog/support-me" class="ga-track">supporting</a> my efforts and joining me on that journey. Thank you so much, and I will see you next time! <span class="icon color-orange"><i class="fa fa-smile-wink"></i></span></p></div></div></div></div><div class="col-12 offset-0 col-md-10 offset-md-1"><div class="post-tags"><ul><li class="text"><em class="far fa-calendar-alt mr-1"></em>Published: Oct 25, 2018 in <a class="mark" href="/micronaut-cookbook/">Micronaut Cookbook</a></li></ul><ul class="mt-2"><li class="text"><em class="fas fa-tags"></em></li><li><a href="/t/async/">async</a></li><li><a href="/t/java/">java</a></li><li><a href="/t/micronaut/">micronaut</a></li><li><a href="/t/netty/">netty</a></li><li><a href="/t/non-blocking/">non-blocking</a></li><li><a href="/t/reactive-programming/">reactive-programming</a></li><li><a href="/t/rxjava/">rxjava</a></li></ul></div></div></div></div><footer class="post-footer"><div class="container"><div class="row"><div class="col-12 offset-0 col-md-10 offset-md-1"><div class="about-author"><div class="row"><div class="col-md-2 col-6 offset-md-0 offset-3 text-center mt-4"><img class="rounded-circle img-fluid" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200"></div><div class="col-md-10 col-12 text-md-left text-center mt-md-4 mt-1"><h4 class="text-md-left text-center" itemprop="creator"><a href="/about">Szymon Stepniak</a></h4><p class="bio"><span>Groovista, Upwork's Top Rated freelancer, Toruń Java User Group founder, open&nbsp;source contributor, Stack Overflow addict, bedroom guitar player. I walk through e.printStackTrace() so you don't have to.</span><span class="ml-2"><a href="/about">More about me &raquo;</a></span></p><ul class="social-links text-md-left text-center"><li><a href="https://twitter.com/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-twitter"></span></a></li><li><a href="https://github.com/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-github"></span></a></li><li><a href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-stack-overflow"></span></a></li><li><a href="https://www.youtube.com/c/eprintstacktrace" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-youtube"></span></a></li></ul></div></div></div></div></div></div></footer></article></main><section class="related-posts bg-light-blue"><div class="container"><h3 class="color-light-purple">Related posts</h3><div class="card-deck pt-2"><article class="card shadow-sm" itemscope itemtype="http://schema.org/Article"><div class="card-header" itemprop="image" style="background-image:url(/images/cards/micronaut.jpg)"><div class="mask"></div><h3 class="h5 text-left font-weight-bold text-white" itemprop="name"><div><a class="category">Micronaut Cookbook</a></div><div class="title">Non-blocking and async Micronaut - quick start (part 2)</div></h3></div><div class="card-body"><section class="post-meta"><ul><li><time datetime="2018-10-26T11:40:42.000Z" itemprop="datePublished">Oct 26, 2018</time></li><li>7 min. read</li><li><a href="https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part-2/#disqus_thread">0 Comments</a></li></ul></section><p class="card-text pt-3" itemprop="description">Welcome to the part 2 of "Non-blocking and async Micronaut" article. In the previous part we have explained the idea behind this demo and we have implemented product-service - a simple endpoint that returns information about some products. Today we will focus on implementing recommendations-ser ...</p></div><a class="stretched-link" href="/micronaut-non-blocking-and-async-part-2/" itemprop="url"></a></article><article class="card shadow-sm" itemscope itemtype="http://schema.org/Article"><div class="card-header" itemprop="image" style="background-image:url(/images/cards/micronaut.jpg)"><div class="mask"></div><h3 class="h5 text-left font-weight-bold text-white" itemprop="name"><div><a class="category">Micronaut Cookbook</a></div><div class="title">Non-blocking and async Micronaut - quick start (part 3)</div></h3></div><div class="card-body"><section class="post-meta"><ul><li><time datetime="2018-10-30T09:53:18.000Z" itemprop="datePublished">Oct 30, 2018</time></li><li>8 min. read</li><li><a href="https://e.printstacktrace.blog/micronaut-non-blocking-and-async-part-3/#disqus_thread">0 Comments</a></li></ul></section><p class="card-text pt-3" itemprop="description">Welcome to the part 3 of "Non-blocking and async Micronaut" article. In the previous post we have created connection between two services using HTTP protocol and we have run some experiments with handling 10,000 requests. Today we are going to extend this example by setting some timeouts to see ...</p></div><a class="stretched-link" href="/micronaut-non-blocking-and-async-part-3/" itemprop="url"></a></article><article class="card shadow-sm" itemscope itemtype="http://schema.org/Article"><div class="card-header" itemprop="image" style="background-image:url(/images/og/ratpack-graalvm-how-to-start.jpg)"><div class="mask"></div><h3 class="h5 text-left font-weight-bold text-white" itemprop="name"><div><a class="category">Ratpack Cookbook</a></div><div class="title">Ratpack on GraalVM - how to start?</div></h3></div><div class="card-body"><section class="post-meta"><ul><li><time datetime="2019-02-15T02:10:39.000Z" itemprop="datePublished">Feb 15, 2019</time></li><li>19 min. read</li><li><a href="https://e.printstacktrace.blog/ratpack-graalvm-how-to-start/#disqus_thread">0 Comments</a></li></ul></section><p class="card-text pt-3" itemprop="description">The journey inside the exciting world of GraalVM continues. Today I would like to share with you results of running Ratpack on GraalVM experiment. You are going to learn how to build a native binary of a simple "Hello, World!" Ratpack application. In the end we are going to run some benchmarks ...</p></div><a class="stretched-link" href="/ratpack-graalvm-how-to-start/" itemprop="url"></a></article></div></div><div class="col-12 text-center mt-5 serif"><h5 class="h3"><span class="small d-block mb-2">More posts from</span><span class="font-weight-bold mark">Micronaut Cookbook</span></h5><div><em class="fas fa-angle-down"></em></div><a class="stretched-link" href="/micronaut-cookbook/"></a></div></section><div class="container py-5"><div class="disqus-comments"><div class="alert alert-info small"><em class="fa fa-info-circle"></em> Want to paste code in the comment and make the formatting look good? Read this - <a href="https://help.disqus.com/en/articles/1717236-syntax-highlighting" target="_blank" rel="noopener"><b>Syntax highlighting</b></a>.</div><div class="comments"><div id="disqus_thread"><div id="disqus_empty" style="display:none">Empty</div></div></div></div><script>function load_disqus(e){var t=document.getElementById("disqus_empty");if(document.contains(t)){var d=document.getElementById("disqus_thread"),n=document.createElement("script"),s=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0];d&&t&&(t.remove(),n.type="text/javascript",n.async=!0,n.src="//"+e+".disqus.com/embed.js",s.appendChild(n))}}window.addEventListener("scroll",function(e){document.scrollingElement.scrollTop>document.getElementById("disqus_thread").offsetTop-500&&load_disqus("eprintstacktrace")},!1)</script></div><footer class="page-footer"><section class="links"><div class="container"><div class="row"><div class="col-12 col-md-4"><h5 class="text-md-left text-center">Useful links</h5><ul class="text-md-left text-center mb-md-0 mb-5"><li><a href="/">Start here</a></li><li><a href="/about">About</a></li><li><a href="/archives">Archives</a></li><li><a href="/privacy-policy">Privacy Policy</a></li><li><a class="gatr" href="https://kit.co/wololock" target="_blank" rel="noopener" data-type="affiliate" data-name="My Kit">My Kit</a></li><li><a href="https://feeds.feedburner.com/Eprintstacktracenet" target="_blank" rel="noopener">RSS</a></li><li><a href="/support-me">Support me <em class="fas fa-heart color-red ml-2"></em></a></li></ul></div><div class="col-12 col-md-4"><h5 class="text-md-left text-center">Popular categories</h5><ul class="text-md-left text-center mb-md-0 mb-5"><li><a href="/groovy-cookbook/">Groovy Cookbook<span class="count ml-2">26</span></a></li><li><a href="/jenkins-pipeline-cookbook/">Jenkins Pipeline Cookbook<span class="count ml-2">6</span></a></li><li><a href="/programmers-bookshelf/">Programmer's Bookshelf<span class="count ml-2">6</span></a></li><li><a href="/learning-java/">Learning Java<span class="count ml-2">4</span></a></li><li><a href="/ratpack-cookbook/">Ratpack Cookbook<span class="count ml-2">4</span></a></li><li><a href="/how-to/">How to<span class="count ml-2">3</span></a></li><li><a href="/micronaut-cookbook/">Micronaut Cookbook<span class="count ml-2">3</span></a></li></ul></div><div class="col-12 col-md-4 text-center"><a class="gatr" href="https://www.jdoqocy.com/click-100154593-12490428" target="_blank" rel="noopener" data-type="banner" data-name="Grammarly Footer Default"><img class="img-fluid" src="/images/yml/grammarly-square-2.png"></a></div></div></div></section><section class="bottom"><div class="container"><ul class="text-center py-2"><li class="d-inline-block mb-md-0 mb-2">Designed by <a href="https://twitter.com/wololock" target="_blank" rel="noopener">@wololock</a></li><li class="d-inline-block mb-md-0 mb-2">Created with <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a></li><li class="d-inline-block mb-md-0 mb-2">Hosted on <a href="https://github.com/wololock/wololock.github.io" target="_blank" rel="noopener">GitHub</a></li><li class="d-inline-block mb-md-0 mb-2">Deployed with <a href="https://circleci.com/gh/wololock/wololock.github.io" target="_blank" rel="noopener">Circle CI</a></li><li class="d-inline-block mb-md-0 mb-2">License <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></li><li class="d-inline-block mb-md-0 mb-2"><a href="https://github.com/wololock/wololock.github.io/commits/develop" target="_blank" rel="noopener"><img src="https://badgen.net/github/last-commit/wololock/wololock.github.io?color=blue&amp;scale=0.8"></a></li></ul></div></section></footer><script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script async src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script><script async src="https://kit.fontawesome.com/25fc8ffdd1.js" crossorigin="anonymous"></script><script async id="cookiebanner" src="//cdnjs.cloudflare.com/ajax/libs/cookie-banner/1.2.2/cookiebanner.min.js" data-moreinfo="/privacy-policy/" data-message="This blog uses cookies to enhance your experience. By continuing to visit it you agree to its use of cookies." data-link="#ffad33" data-font-family="Lora,serif" data-font-size="15px" data-bg="#444"></script><script src="/js/highlight.pack.js?v=10.0.3"></script><script>hljs.initHighlightingOnLoad()</script><script async src="/js/main.js?v=6"></script><script async id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><script>!function(a,e,t,n,c,g,r){a.GoogleAnalyticsObject=c,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=1*new Date,g=e.createElement(t),r=e.getElementsByTagName(t)[0],g.async=1,g.src="//www.google-analytics.com/analytics.js",r.parentNode.insertBefore(g,r)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"),jQuery("a.gatr").click(function(){var a=jQuery(this),e=a.attr("data-type"),t=a.attr("data-name");return ga("send","event",e,"click",t),!0})</script><script>!function(){"use strict";function r(e){var t=e.getAttribute("data-original"),n=new Image;n.onload=function(){e.setAttribute("src",t),e.style.paddingTop=""},n.src=t}document.addEventListener("DOMContentLoaded",function(){var t,e,n,i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));i.length&&("undefined"!=typeof IntersectionObserver?(t=new IntersectionObserver(function(e,t){e.filter(function(e){return e.isIntersecting}).forEach(function(e){r(e.target),t.unobserve(e.target)})}),i.forEach(function(e){t.observe(e)})):(n=function(){clearTimeout(e),e=setTimeout(function(){if(!(i=i.filter(function(e){return!e.src})).length)return window.removeEventListener("scroll",n),void window.removeEventListener("resize",n);i.filter(function(e){e.getBoundingClientRect().top<window.innerHeight&&r(e)})},100)},window.addEventListener("scroll",n),window.addEventListener("resize",n),n()))},!1)}();</script></body></html>