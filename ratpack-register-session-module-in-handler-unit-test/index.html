<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="author" content="Szymon Stepniak"><meta name="robots" content="index, follow"><meta name="keywords" content="groovy,ratpack,spock,unit-test,session,guice"><title>Ratpack: register SessionModule in handler unit test</title><meta name="description" content="Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object to use it with GroovyRequestFixture. Today instead of mocking we will register Session"><meta property="og:type" content="article"><meta property="og:title" content="Ratpack: register SessionModule in handler unit test"><meta property="og:url" content="https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/"><meta property="og:site_name" content="Szymon Stepniak - I want to help you to become a better software developer"><meta property="og:description" content="Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object to use it with GroovyRequestFixture. Today instead of mocking we will register Session"><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2018-06-26T20:55:38.000Z"><meta property="article:modified_time" content="2018-06-26T20:55:38.000Z"><meta property="article:author" content="Szymon Stepniak"><meta property="article:tag" content="groovy"><meta property="article:tag" content="ratpack"><meta property="article:tag" content="spock"><meta property="article:tag" content="unit-test"><meta property="article:tag" content="session"><meta property="article:tag" content="guice"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@wololock"><link rel="dns-prefetch" href="//fonts.googleapis.com"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//cdn.jsdelivr.net"><link rel="canonical" href="https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/"><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,700;1,400;1,700&amp;family=Lora:ital,wght@0,400;0,700;1,400;1,700&amp;family=Montserrat:wght@300;400;700&amp;family=DM+Mono:wght@400;500&amp;family=Poppins:wght@500;700;800&amp;family=Roboto:wght@400;700&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous"><link rel="stylesheet" href="/css/main.css?v=73"><link rel="stylesheet" href="/css/highlight.css?v=73"><link rel="shortcut icon" type="image/png" href="/favicon_new.png"><script type="application/ld+json">{"@context":"https://schema.org","@graph":[{"@type":["Person","Organization"],"@id":"https://e.printstacktrace.blog/#/schema/person/wololock","name":"Szymon Stepniak","description":"I want to help you to become a better software developer.","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/#avatar","inLanguage":"en-US","url":"https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200","caption":"Szymon Stepniak"},"logo":{"@id":"https://e.printstacktrace.blog/#avatar"},"sameAs":["https://twitter.com/wololock","https://github.com/wololock","https://stackoverflow.com/users/2194470/szymon-stepniak","https://www.youtube.com/c/eprintstacktrace"]},{"@type":"WebSite","@id":"https://e.printstacktrace.blog/#website","url":"https://e.printstacktrace.blog","name":"Szymon Stepniak - I want to help you to become a better software developer","description":"Blog about programming, created by Upwork's Top Rated freelancer, 10+ years experienced Java/Groovy developer. Contact me if you are looking for an experienced and high quality consultant."},{"@type":"WebPage","@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#webpage","url":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/","name":"Ratpack: register SessionModule in handler unit test","isPartOf":{"@id":"https://e.printstacktrace.blog/#website"},"datePublished":"2018-06-26T20:55:38.000Z","dateModified":"2018-06-26T20:55:38.000Z","description":"\nUnit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object\nto use it with GroovyRequestFixture. Today instead of mocking\nwe will register SessionModule and then we will use a real session object.\n","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/"]}]},{"@type":"Article","@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#article","isPartOf":{"@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#webpage"},"author":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"headline":"Ratpack: register SessionModule in handler unit test","datePublished":"2018-06-26T20:55:38.000Z","dateModified":"2018-06-26T20:55:38.000Z","mainEntityOfPage":{"@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#webpage"},"publisher":{"@id":"https://e.printstacktrace.blog/#/schema/person/wololock"},"keywords":"groovy,ratpack,spock,unit-test,session,guice","image":{"@type":"ImageObject","@id":"https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#primaryimage","url":"https://e.printstacktrace.blog/images/cards/25.png","inLanguage":"en-US","caption":"Ratpack: register SessionModule in handler unit test"},"inLanguage":"en-US"},{"@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://e.printstacktrace.blog"},{"@type":"ListItem","position":2,"name":"Ratpack Cookbook","item":"https://e.printstacktrace.blog/ratpack-cookbook/"},{"@type":"ListItem","position":3,"name":"Ratpack: register SessionModule in handler unit test"}]}]}</script><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Szymon Stepniak - I want to help you to become a better software developer" type="application/atom+xml">
<style>.img-lazyload-container{overflow:hidden;max-width:100%}.img-lazyload-container img{max-width:100%;display:block;height:auto;transition:opacity .5s ease-in-out}.img-lazyload-container img:not([src]){height:0;opacity:0}</style></head><body><header class="fixed-top" id="header"><div class="container"><nav class="navbar navbar-expand-lg px-0 py-lg-0 navbar-dark"><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarLinks" aria-controls="navbarLinks"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarLinks"><ul class="navbar-nav ml-auto"><li class="nav-item"><a class="nav-link gatr" href="/" data-type="nav" data-name="Home">Home</a></li><li class="nav-item"><a class="nav-link gatr" href="/about/" data-type="nav" data-name="About Me">About Me</a></li><li class="nav-item"><a class="nav-link gatr" href="/youtube/" target="_blank" data-type="nav" data-name="Videos">Videos</a></li><li class="nav-item"><a class="nav-link gatr" href="/archives/" data-type="nav" data-name="Archives">Archives</a></li><li class="nav-item"><a class="nav-link gatr" href="/resources/" data-type="nav" data-name="Resources">Resources</a></li><li class="nav-item"><a class="nav-link gatr" href="/upwork/" target="_blank" data-type="nav" data-name="Hire me">Hire me</a></li></ul></div></nav></div></header><div id="pageprogress"><div class="bar"></div></div><main id="main"><article class="post"><div class="jumbotron pt-lg-5 pb-1"><div class="container pt-lg-5"><div class="row py-5"><div class="order-0 col-lg-12"><div class="pr-lg-5"><p class="subtitle m-0 p-0"><a class="category" href="/ratpack-cookbook/">Ratpack Cookbook</a></p><h1 class="mt-0 mb-2">Ratpack: register SessionModule in handler unit test</h1><div class="lead my-4"><div class="paragraph"><p>Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to <a href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/" title="mock Session object">mock Session object</a> to use it with <a target="_blank" rel="noopener" href="https://ratpack.io/manual/1.5.4/api/ratpack/groovy/test/handling/GroovyRequestFixture.html"><code>GroovyRequestFixture</code></a>. Today instead of mocking we will register <code>SessionModule</code> and then we will use a real session object.</p></div></div><ul class="post-meta-extended"><li class="d-none d-lg-inline-block"><a href="/about"><img class="rounded-circle" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" height="52" width="52" style="margin-top:-24px"></a></li><li><div class="small">Author</div><div class="font-weight-bold"><a href="/about">Szymon Stepniak</a></div></li><li><div class="small">Published</div><div class="font-weight-bold"><time datetime="2018-06-26T20:55:38.000Z">Jun 26, 2018</time></div></li><li><div class="small">Reading time</div><div class="font-weight-bold">7 minutes</div></li><li><div class="small">Discussion</div><div class="font-weight-bold"><a href="https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/#disqus_thread">0 Comments</a></div></li></ul></div></div></div></div></div><div class="container py-5"><a id="more"></a><div class="paragraph"><p>Let&#8217;s say we have a handler that uses a session object and we want to unit test this handler using <code>GroovyRequestFixture</code> to avoid booting up the application. Our handler under test class looks like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">class HandlerUnderTest implements Handler &#123;

    @Override
    void handle(Context ctx) throws Exception &#123;
        ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
            o.orElse(null)
        &#125;.flatMap &#123; value -&gt;
            Promise.value(value)
        &#125;.then &#123; foo -&gt;
            ctx.render(json([foo: foo]))
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>Nothing fancy - we retrieve value with key <code>foo</code> from session object and we return a simple JSON object like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">&#123;"foo": "here is foo value"&#125;</code></pre></div></div><div class="paragraph"><p><code>GroovyRequestFixture</code> class has a method called <code>handle(chainAction, closure)</code> that expects two parameters:</p></div><div class="ulist"><ul><li><p><code>Action&lt;? super Chain&gt; chainAction</code>, a handler chain builder class that allows us to create a chain containing our handler under test class,</p></li><li><p><code>Closure&lt;?&gt; closure</code>, a closure with request fixture specification.</p></li></ul></div><div class="paragraph"><p>Let&#8217;s begin with defining <code>GroovyChainAction</code> object that implements <code>Action&lt;Chain&gt;</code> that we can use later on.</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import ratpack.exec.Promise
import ratpack.groovy.handling.GroovyChainAction
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.session.Session
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            get(new HandlerUnderTest())
        &#125;
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>The definition of <code>handlerChainAction</code> object says that there is a handler for <code>GET</code> request sent without any path and this handler is our <code>HandlerUnderTest</code>. No single test case so far, let&#8217;s add one:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import ratpack.exec.Promise
import ratpack.groovy.handling.GroovyChainAction
import ratpack.groovy.test.handling.GroovyRequestFixture
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.http.Status
import ratpack.jackson.internal.DefaultJsonRender
import ratpack.session.Session
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            get(new HandlerUnderTest())
        &#125;
    &#125;

    def "should retrieve value for foo key from Session"() &#123;
        given:
        def result = GroovyRequestFixture.handle(handlerChainAction) &#123;
            method 'GET'
        &#125;

        expect:
        result.status == Status.OK

        and:
        result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>Now our specification class contains first test case scenario - in this test we expect that calling <code>GET</code> request on predefined <code>handlerChainAction</code> returns a map object like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">[foo: 'Foo value is 42']</code></pre></div></div><div class="paragraph"><p>Let&#8217;s see what happens if we run this test:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">ratpack.test.handling.UnexpectedHandlerException: ratpack.registry.NotInRegistryException: No object for type 'ratpack.session.Session' in registry

    at ratpack.test.handling.internal.DefaultHandlingResult.rendered(DefaultHandlingResult.java:263)
    at RetrieveFooValueFromSessionSpec.should retrieve value for foo key from Session(RetrieveFooValueFromSessionSpec.groovy:34)
Caused by: ratpack.registry.NotInRegistryException: No object for type 'ratpack.session.Session' in registry
    at ratpack.registry.Registry.get(Registry.java:136)
    at ratpack.handling.internal.DefaultContext.get(DefaultContext.java:375)
    at ratpack.registry.Registry.get(Registry.java:120)
    at RetrieveFooValueFromSessionSpec$HandlerUnderTest.handle(RetrieveFooValueFromSessionSpec.groovy:41)
    at ratpack.handling.internal.DefaultContext.next(DefaultContext.java:157)
    ....</code></pre></div></div><div class="paragraph"><p>This exception is pretty straightforward - there is no session object available in the registry. In this test specification we want to avoid mocking session object and use the real one provided with <code>SessionModule</code> instead. To make it happened we need to register <code>SessionModule</code> using Guice registry. Luckily <code>GroovyChainAction</code> class has a method called <code>register(Registry registry)</code> that allows us to override existing registry. Here we will use <code>Guice.registry(Action&lt;? super BindingsSpec&gt; bindings)</code> method that returns <code>Function&lt;Registry, Registry&gt;</code>:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">static final Function&lt;Registry, Registry&gt; guiceRegistry = Guice.registry &#123; bindings -&gt;
    bindings.module(new SessionModule())
&#125;</code></pre></div></div><div class="paragraph"><p>This <code>guiceRegistry</code> function will return a Guice registry with <code>SessionModule</code> bind correctly. The next step is to call this <code>GroovyChainAction.register(guiceRegistry.apply(registry))</code> method inside <code>execute()</code> method we override for this test. The updated specification class looks like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import ratpack.exec.Promise
import ratpack.func.Function
import ratpack.groovy.handling.GroovyChainAction
import ratpack.groovy.test.handling.GroovyRequestFixture
import ratpack.guice.Guice
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.http.Status
import ratpack.jackson.internal.DefaultJsonRender
import ratpack.registry.Registry
import ratpack.session.Session
import ratpack.session.SessionModule
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    static final Function&lt;Registry, Registry&gt; guiceRegistry = Guice.registry &#123; bindings -&gt;
        bindings.module(new SessionModule())
    &#125;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            register(guiceRegistry.apply(registry))

            get(new HandlerUnderTest())
        &#125;
    &#125;

    def "should retrieve value for foo key from Session"() &#123;
        given:
        def result = GroovyRequestFixture.handle(handlerChainAction) &#123;
            method 'GET'
        &#125;

        expect:
        result.status == Status.OK

        and:
        result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>Let&#8217;s run the test and see what happens:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-console hljs" data-lang="console">Condition not satisfied:

result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
|      |                           |      |
|      |                           |      false
|      |                           [foo:null]
|      ratpack.jackson.internal.DefaultJsonRender@9f6e406
ratpack.test.handling.internal.DefaultHandlingResult@400d912a

Expected :foo: Foo value is 42

Actual   :foo: null</code></pre></div></div><div class="paragraph"><p>Great! <code>SessionModule</code> gets bind correctly, there is no <code>No object for type 'ratpack.session.Session' in registry</code> exception anymore. To finalize this specification we need to satisfy the expectation. For purpose of this test we will add <code>all()</code> handler to the <code>GroovyChainAction</code> and in this handler we will initialize value in session for key <code>foo</code>.</p></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content"><h4>The <code>all()</code> handler</h4><div class="paragraph"><p>This handler is useful in some scenarios - when it&#8217;s added at the top of the chain it inspects every incoming request. It&#8217;s important to remember that if we want to keep chain continuing we have to call <code>next()</code> method that instructs Ratpack that this handler does not terminate request processing and it has to continue. Otherwise request handling ends up inside <code>all()</code> handler.</p></div></td></tr></table></div><div class="paragraph"><p>The simplest <code>all()</code> handler that sets value for session key`foo` may look like this:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">all &#123; Session session -&gt;
    session.set('foo', 'Foo value is 42').then &#123;
        next()
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>It&#8217;s important to call <code>next()</code> inside <code>then()</code> operation to let Ratpack&#8217;s execution model does its job. Otherwise the next handler may start processing before session object stores value for <code>foo</code> key.</p></div><div class="paragraph"><p>And here is what the full working specification looks like:</p></div><div class="listingblock"><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">import ratpack.exec.Promise
import ratpack.func.Function
import ratpack.groovy.handling.GroovyChainAction
import ratpack.groovy.test.handling.GroovyRequestFixture
import ratpack.guice.Guice
import ratpack.handling.Context
import ratpack.handling.Handler
import ratpack.http.Status
import ratpack.jackson.internal.DefaultJsonRender
import ratpack.registry.Registry
import ratpack.session.Session
import ratpack.session.SessionModule
import spock.lang.Specification
import spock.lang.Subject

import static ratpack.jackson.Jackson.json

class RetrieveFooValueFromSessionSpec extends Specification &#123;

    static final Function&lt;Registry, Registry&gt; guiceRegistry = Guice.registry &#123; bindings -&gt;
        bindings.module(new SessionModule())
    &#125;

    @Subject
    final GroovyChainAction handlerChainAction = new GroovyChainAction() &#123;
        @Override
        void execute() throws Exception &#123;
            register(guiceRegistry.apply(registry))

            all &#123; Session session -&gt;
                session.set('foo', 'Foo value is 42').then &#123;
                    next()
                &#125;
            &#125;

            get(new HandlerUnderTest())
        &#125;
    &#125;

    def "should retrieve value for foo key from Session"() &#123;
        given:
        def result = GroovyRequestFixture.handle(handlerChainAction) &#123;
            method 'GET'
        &#125;

        expect:
        result.status == Status.OK

        and:
        result.rendered(DefaultJsonRender).object == [foo: 'Foo value is 42']
    &#125;

    static class HandlerUnderTest implements Handler &#123;

        @Override
        void handle(Context ctx) throws Exception &#123;
            ctx.get(Session).get('foo').map &#123; Optional&lt;String&gt; o -&gt;
                o.orElse(null)
            &#125;.flatMap &#123; value -&gt;
                Promise.value(value)
            &#125;.then &#123; foo -&gt;
                ctx.render(json([foo: foo]))
            &#125;
        &#125;
    &#125;
&#125;</code></pre></div></div><div class="paragraph"><p>This final specification passes as we expect:</p></div><div class="paragraph"><p></p><div class="img-lazyload-container" style="width:1265px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/ratpack-session-test-passed.png" height="205" width="1265" style="padding-top:16.205533596837945%"></div><p></p></div></div></article><section id="share"><div class="container pb-5"><div class="row justify-content-between align-items-center"><div class="col-lg"><p class="font-size-5 text-uppercase mb-0">Did you like this article?</p><h3 class="mb-lg-0 mt-0">Consider buying me a coffee</h3></div><div class="col-auto buttons"><div class="pt-lg-4"><a class="align-middle mr-2 gatr" href="/buy-me-a-coffee/" target="_blank"><img data-lazy="/images/buy-me-a-coffee.png" height="32"></a><iframe class="align-middle gatr" src="https://github.com/sponsors/wololock/button" title="Sponsor wololock" height="35" width="116" style="border:0"></iframe></div></div></div></div></section><section id="related" data-debug="Scrolled to related posts"><div class="featured-post py-5"><div class="container py-3"><div class="row"><div class="col-12"><div class="row"><div class="col-lg-8 order-0"><div class="pr-5"><p class="subtitle m-0 p-0"><a class="category" href="/ratpack-cookbook/">Ratpack Cookbook</a></p><h3 class="mt-0 mb-2">Continue reading: <a href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/">"Ratpack: mocking Session object in GroovyRequestFixture test"</a></h3><div class="my-4"><div class="paragraph"><p><a target="_blank" rel="noopener" href="https://ratpack.io">Ratpack</a> allows you unit test handlers using <a target="_blank" rel="noopener" href="https://ratpack.io/manual/1.5.4/api/ratpack/groovy/test/handling/GroovyRequestFixture.html"><code>GroovyRequestFixture</code></a> class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the handler does what you expect. However, if you retrieve objects from Raptack&#8217;s registry you will run into a problem - registry in this case is empty.</p></div><a href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/">Read more<i class="fas fa-arrow-right ml-2"></i></a></div><ul class="post-meta-extended"><li class="d-none d-lg-inline-block"><a href="/about"><img class="rounded-circle" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200" height="52" width="52" style="margin-top:-24px"></a></li><li><div class="small">Author</div><div class="font-weight-bold"><a href="/about">Szymon Stepniak</a></div></li><li><div class="small">Published</div><div class="font-weight-bold"><time datetime="2018-06-24T09:59:57.000Z">Jun 24, 2018</time></div></li><li><div class="small">Reading time</div><div class="font-weight-bold">2 minutes</div></li><li><div class="small">Discussion</div><div class="font-weight-bold"><a href="https://e.printstacktrace.blog/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/#disqus_thread">0 Comments</a></div></li></ul></div></div><div class="col-lg-4 order-1 d-none d-lg-block"><a href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/"><img class="img-fluid rounded" data-lazy="/images/cards/25.png" style="margin-bottom:-300px"></a></div></div></div></div></div></div><div class="remaining"><div class="container py-5"><div class="row"><div class="col-md-4"><div class="card card-sm rounded border-0 card-post" data-read="5 min read"><div class="card-header p-0 position-relative rounded"><img class="card-img-top rounded" data-lazy="/images/cards/35.png"><div class="card-img-overlay d-flex align-items-end p-3 rounded"><h4 class="card-title">Spock random order of tests - how to?</h4></div><div class="mask rounded"></div></div><div class="card-body small p-1"><a class="stretched-link" href="/spock-random-order-of-tests-how-to/"></a></div></div></div><div class="col-md-4"><div class="card card-sm rounded border-0 card-post" data-read="2 min read"><div class="card-header p-0 position-relative rounded"><img class="card-img-top rounded" data-lazy="/images/cards/24.png"><div class="card-img-overlay d-flex align-items-end p-3 rounded"><h4 class="card-title">How to avoid &quot;No tests were found&quot; when using JUnit 5 with Groovy?</h4></div><div class="mask rounded"></div></div><div class="card-body small p-1"><a class="stretched-link" href="/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/"></a></div></div></div><div class="col-md-4"><div class="card card-sm rounded border-0 card-post" data-read="7 min read"><div class="card-header p-0 position-relative rounded"><img class="card-img-top rounded" data-lazy="/images/cards/24.png"><div class="card-img-overlay d-flex align-items-end p-3 rounded"><h4 class="card-title">Spock assertion inside if-statement doesn't work - why?</h4></div><div class="mask rounded"></div></div><div class="card-body small p-1"><a class="stretched-link" href="/spock-assertion-inside-if-statement-doesnt-work-why/"></a></div></div></div></div></div></div></section><section id="comments"><div class="container py-5" data-debug="Scrolled to comments"><h2 class="disqus-comment-count" data-disqus-url="https://e.printstacktrace.blog/ratpack-register-session-module-in-handler-unit-test/">0 Comments</h2><div class="row"><div class="col-12 col-lg-3 order-lg-1 order-0"><div class="sticky-top" style="top:40px"><a class="gatr" href="https://grammarly.go2cloud.org/aff_c?offer_id=182&amp;aff_id=89563" data-type="banner" data-name="grammarly-01" target="_blank"><img class="d-none img-fluid d-lg-inline-block" data-lazy="/images/yml/grammarly-tower.png"></a></div></div><div class="col-12 col-lg-9 order-0 order-lg-0 order-1"><div id="disqus_thread"></div></div></div></div><script>const loadDisqus=e=>{var s,r;t=document,(s=t.createElement("script")).src="https://"+e+".disqus.com/embed.js",s.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(s)},disqusObserver=new IntersectionObserver(e=>{e.forEach(e=>{var t,s,r;e.intersectionRatio>0&&(t="eprintstacktrace",s=document,(r=s.createElement("script")).src="https://"+t+".disqus.com/embed.js",r.setAttribute("data-timestamp",+new Date),(s.head||s.body).appendChild(r),disqusObserver.unobserve(e.target))})});disqusObserver.observe(document.getElementById("disqus_thread"))</script></section></main><footer id="footer" data-debug="Scrolled to footer"><div class="container py-3 pt-5"><div class="row"><div class="col-12 col-lg-3"><h5>Popular categories</h5><ul class="list-unstyled list-categories"><li class="mb-2"><a class="gatr" href="/groovy-cookbook/" data-type="footer-category" data-name="Groovy Cookbook">Groovy Cookbook<span class="count ml-2 text-muted small">28</span></a></li><li class="mb-2"><a class="gatr" href="/jenkins-pipeline-cookbook/" data-type="footer-category" data-name="Jenkins Pipeline Cookbook">Jenkins Pipeline Cookbook<span class="count ml-2 text-muted small">9</span></a></li><li class="mb-2"><a class="gatr" href="/programmers-bookshelf/" data-type="footer-category" data-name="Programmer's Bookshelf">Programmer's Bookshelf<span class="count ml-2 text-muted small">6</span></a></li><li class="mb-2"><a class="gatr" href="/micronaut-cookbook/" data-type="footer-category" data-name="Micronaut Cookbook">Micronaut Cookbook<span class="count ml-2 text-muted small">4</span></a></li><li class="mb-2"><a class="gatr" href="/ratpack-cookbook/" data-type="footer-category" data-name="Ratpack Cookbook">Ratpack Cookbook<span class="count ml-2 text-muted small">4</span></a></li><li class="mb-2"><a class="gatr" href="/learning-java/" data-type="footer-category" data-name="Learning Java">Learning Java<span class="count ml-2 text-muted small">4</span></a></li><li class="mb-2"><a class="gatr" href="/jq-cookbook/" data-type="footer-category" data-name="jq cookbook">jq cookbook<span class="count ml-2 text-muted small">3</span></a></li><li class="mb-2"><a class="gatr" href="/how-to/" data-type="footer-category" data-name="How to">How to<span class="count ml-2 text-muted small">3</span></a></li><li class="mb-2"><a class="gatr" href="/blog-reports/" data-type="footer-category" data-name="Blog Reports">Blog Reports<span class="count ml-2 text-muted small">2</span></a></li></ul></div><div class="col-12 col-lg-5 latest-posts"><h5 class="mb-4">Latest posts</h5><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/merging-json-files-recursively-in-the-command-line/" data-type="latest-sidebar" data-name="Merging JSON files recursively in the command-line"><img class="rounded" src="/images/icons/jq-merge-json.jpg" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/merging-json-files-recursively-in-the-command-line/" data-type="latest-sidebar" data-name="Merging JSON files recursively in the command-line">Merging JSON files recursively in the command-line</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-11-05T22:14:35.000Z">November 5, 2020</time></li><li>1 min. read</li><li><a href="https://e.printstacktrace.blog/merging-json-files-recursively-in-the-command-line/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/jenkins-declarative-pipeline-dynamic-agent/" data-type="latest-sidebar" data-name="Jenkins Declarative Pipeline with the dynamic agent - how to configure it?"><img class="rounded" src="/images/icons/50.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/jenkins-declarative-pipeline-dynamic-agent/" data-type="latest-sidebar" data-name="Jenkins Declarative Pipeline with the dynamic agent - how to configure it?">Jenkins Declarative Pipeline with the dynamic agent - how to configure it?</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-09-27T07:32:11.000Z">September 27, 2020</time></li><li>1 min. read</li><li><a href="https://e.printstacktrace.blog/jenkins-declarative-pipeline-dynamic-agent/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)"><img class="rounded" src="/images/icons/3.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/groovy-ecosystem-usage-report-2020/" data-type="latest-sidebar" data-name="Groovy Ecosystem Usage Report (2020)">Groovy Ecosystem Usage Report (2020)</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-09-13T05:40:19.000Z">September 13, 2020</time></li><li>4 min. read</li><li><a href="https://e.printstacktrace.blog/groovy-ecosystem-usage-report-2020/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/how-to-convert-json-to-csv-from-the-command-line/" data-type="latest-sidebar" data-name="How to convert JSON to CSV from the command-line?"><img class="rounded" src="/images/icons/4.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/how-to-convert-json-to-csv-from-the-command-line/" data-type="latest-sidebar" data-name="How to convert JSON to CSV from the command-line?">How to convert JSON to CSV from the command-line?</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-08-25T18:44:31.000Z">August 25, 2020</time></li><li>3 min. read</li><li><a href="https://e.printstacktrace.blog/how-to-convert-json-to-csv-from-the-command-line/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/5-common-jenkins-pipeline-mistakes/" data-type="latest-sidebar" data-name="5 Common Jenkins Pipeline Mistakes"><img class="rounded" src="/images/icons/1.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/5-common-jenkins-pipeline-mistakes/" data-type="latest-sidebar" data-name="5 Common Jenkins Pipeline Mistakes">5 Common Jenkins Pipeline Mistakes</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-08-24T10:53:13.000Z">August 24, 2020</time></li><li>1 min. read</li><li><a href="https://e.printstacktrace.blog/5-common-jenkins-pipeline-mistakes/#disqus_thread">0 Comments</a></li></ul></div></div></div><div class="media align-items-center pb-1 mb-2"><a class="d-block gatr" href="/how-to-merge-two-maps-in-groovy/" data-type="latest-sidebar" data-name="How to merge two maps in Groovy?"><img class="rounded" src="/images/icons/28.png" width="64"></a><div class="media-body pl-2 ml-1"><a class="gatr small font-weight-bold" href="/how-to-merge-two-maps-in-groovy/" data-type="latest-sidebar" data-name="How to merge two maps in Groovy?">How to merge two maps in Groovy?</a><div class="text-muted"><ul class="post-meta"><li><time datetime="2020-07-17T18:11:17.000Z">July 17, 2020</time></li><li>6 min. read</li><li><a href="https://e.printstacktrace.blog/how-to-merge-two-maps-in-groovy/#disqus_thread">0 Comments</a></li></ul></div></div></div></div><div class="col-12 col-lg-4"><h5>Popular tags</h5><div class="tags-cloud"><a href="/t/affiliate/" style="font-size:.8em;color:#6881a5">affiliate</a> <a href="/t/async/" style="font-size:.8em;color:#778196">async</a> <a href="/t/benchmark/" style="font-size:.8em;color:#6f819d">benchmark</a> <a href="/t/book/" style="font-size:.8em;color:#6081ac">book</a> <a href="/t/cicd/" style="font-size:.8em;color:#5082ba">cicd</a> <a href="/t/curl/" style="font-size:.8em;color:#6f819d">curl</a> <a href="/t/devops/" style="font-size:.8em;color:#5882b3">devops</a> <a href="/t/docker/" style="font-size:.8em;color:#6f819d">docker</a> <a href="/t/github/" style="font-size:.8em;color:#778196">github</a> <a href="/t/graalvm/" style="font-size:.8em;color:#5082ba">graalvm</a> <a href="/t/grails/" style="font-size:.8em;color:#778196">grails</a> <a href="/t/groovy/" style="font-size:.8em;color:#3982d0">groovy</a> <a href="/t/haskell/" style="font-size:.8em;color:#778196">haskell</a> <a href="/t/java/" style="font-size:.8em;color:#4182c9">java</a> <a href="/t/java-8/" style="font-size:.8em;color:#778196">java-8</a> <a href="/t/jenkins/" style="font-size:.8em;color:#4982c2">jenkins</a> <a href="/t/jenkins-pipeline/" style="font-size:.8em;color:#4982c2">jenkins-pipeline</a> <a href="/t/jmh/" style="font-size:.8em;color:#6881a5">jmh</a> <a href="/t/jq/" style="font-size:.8em;color:#6f819d">jq</a> <a href="/t/json/" style="font-size:.8em;color:#6f819d">json</a> <a href="/t/junit/" style="font-size:.8em;color:#778196">junit</a> <a href="/t/learning/" style="font-size:.8em;color:#6f819d">learning</a> <a href="/t/micronaut/" style="font-size:.8em;color:#6081ac">micronaut</a> <a href="/t/native-image/" style="font-size:.8em;color:#6881a5">native-image</a> <a href="/t/non-blocking/" style="font-size:.8em;color:#6f819d">non-blocking</a> <a href="/t/ratpack/" style="font-size:.8em;color:#5082ba">ratpack</a> <a href="/t/reactive-programming/" style="font-size:.8em;color:#778196">reactive-programming</a> <a href="/t/reading/" style="font-size:.8em;color:#778196">reading</a> <a href="/t/recursion/" style="font-size:.8em;color:#778196">recursion</a> <a href="/t/review/" style="font-size:.8em;color:#6081ac">review</a> <a href="/t/rxjava/" style="font-size:.8em;color:#778196">rxjava</a> <a href="/t/sdkman/" style="font-size:.8em;color:#6f819d">sdkman</a> <a href="/t/spock/" style="font-size:.8em;color:#6f819d">spock</a> <a href="/t/stackoverflow/" style="font-size:.8em;color:#778196">stackoverflow</a> <a href="/t/string/" style="font-size:.8em;color:#778196">string</a> <a href="/t/unit-test/" style="font-size:.8em;color:#6f819d">unit-test</a></div><div class="mt-5"><a class="gatr" href="https://www.bluehost.com/track/szymonstepniak/" data-type="banner" data-name="bluehost-02" target="_blank"><img class="d-none img-fluid d-lg-inline-block d-md-inline-block" data-lazy="/images/yml/bluehost-01.png"></a></div></div></div></div><div class="border-top border-dark py-4 footer-bottom"><div class="container"><div class="justify-content-between d-flex"><div class="links"><ul><li><a class="gatr" href="/about/" data-type="footer-link" data-name="About">About</a></li><li><a class="gatr" href="/archives/" data-type="footer-link" data-name="Archives">Archives</a></li><li><a class="gatr" href="/resources/" data-type="footer-link" data-name="Resources">Resources</a></li><li><a class="gatr" href="/privacy-policy/" data-type="footer-link" data-name="Privacy Policy">Privacy Policy</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://kit.co/wololock" data-type="footer-link" data-name="My Kit">My Kit</a></li><li><a class="gatr" target="_blank" rel="noopener" href="https://feeds.feedburner.com/Eprintstacktracenet" data-type="footer-link" data-name="RSS">RSS</a></li></ul></div><div class="socials"><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://twitter.com/wololock"><i class="fa fa-twitter"></i></a></li><li><a target="_blank" rel="noopener" href="https://youtube.com/eprintstacktrace"><i class="fa fa-youtube"></i></a></li><li><a target="_blank" rel="noopener" href="https://github.com/wololock"><i class="fa fa-github"></i></a></li><li><a target="_blank" rel="noopener" href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile"><i class="fa fa-stack-overflow"></i></a></li><li><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/szymon-st%C4%99pniak-9a0b1630/"><i class="fa fa-linkedin"></i></a></li></ul></div></div></div></div></footer><script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script><script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/48c5da59c9.js" crossorigin="anonymous" async></script><script async id="cookiebanner" src="//cdnjs.cloudflare.com/ajax/libs/cookie-banner/1.2.2/cookiebanner.min.js" data-moreinfo="/privacy-policy/" data-message="This blog uses cookies to enhance your experience. By continuing to visit it you agree to its use of cookies." data-link="#5fc4ff" data-font-family="Lora,serif" data-font-size="16px" data-bg="#1d2b36"></script><script src="/js/main.js?v=12"></script><script src="/js/highlightjs/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad()</script><script async id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><script>!function(e,a,t,n,c,i,g){e.GoogleAnalyticsObject=c,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=a.createElement(t),g=a.getElementsByTagName(t)[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",g.parentNode.insertBefore(i,g)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"),jQuery(document).on("mousedown",".gatr",(function(e){var a=jQuery(this),t=a.attr("data-type"),n=a.attr("data-name"),c=1===e.which?"click":2===e.which?"middle-click":"right-click";return ga("send","event",t,c,n),!1}))</script><script>!function(){"use strict";function r(e){var t=e.getAttribute("data-original"),n=new Image;n.onload=function(){e.setAttribute("src",t),e.style.paddingTop=""},n.src=t}document.addEventListener("DOMContentLoaded",function(){var t,e,n,i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));i.length&&("undefined"!=typeof IntersectionObserver?(t=new IntersectionObserver(function(e,t){e.filter(function(e){return e.isIntersecting}).forEach(function(e){r(e.target),t.unobserve(e.target)})}),i.forEach(function(e){t.observe(e)})):(n=function(){clearTimeout(e),e=setTimeout(function(){return(i=i.filter(function(e){return!e.src})).length?void i.filter(function(e){e.getBoundingClientRect().top<window.innerHeight&&r(e)}):(window.removeEventListener("scroll",n),void window.removeEventListener("resize",n))},100)},window.addEventListener("scroll",n),window.addEventListener("resize",n),n()))},!1)}();</script></body></html>