<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="author" content="Szymon Stepniak"><meta name="robots" content="all"><title>Spock random order of tests - how to?</title><meta name="description" content="Spock Framework executes test methods (features) in a single class (specification) in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolation in mind. However, in some cases, we would like to ..."><meta name="keywords" content="groovy,junit,unit-test,spock,random"><link rel="shortcut icon" type="image/png" href="/favicon_new.png"><link rel="dns-prefetch" href="//cdnjs.cloudflare.com"><link rel="dns-prefetch" href="//maxcdn.bootstrapcdn.com"><link rel="dns-prefetch" href="//disqus.com"><link rel="dns-prefetch" href="//c.disquscdn.com"><link rel="canonical" href="https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/"><link rel="alternate" type="application/rss+xml" title="e.printStackTrace(); // Blog" href="/atom.xml"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/androidstudio.min.css"><link rel="stylesheet" href="/css/main.css?v=47"><link rel="stylesheet" href="/css/conum.css?v=47"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic&amp;display=swap"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800&amp;display=swap"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro&amp;display=swap"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Droid+Sans+Mono:400,700&amp;display=swap"><meta name="description" content="Spock Framework executes test methods (features) in a single class (specification) in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolatio"><meta property="og:type" content="article"><meta property="og:title" content="Spock random order of tests - how to?"><meta property="og:url" content="https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/"><meta property="og:site_name" content="e.printStackTrace(); &#x2F;&#x2F; Blog"><meta property="og:description" content="Spock Framework executes test methods (features) in a single class (specification) in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolatio"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://e.printstacktrace.blog/images/og/spock-random-tests.jpg"><meta property="article:published_time" content="2019-04-06T08:52:11.000Z"><meta property="article:modified_time" content="2019-04-09T06:58:20.000Z"><meta property="article:author" content="Szymon Stepniak"><meta property="article:tag" content="groovy"><meta property="article:tag" content="junit"><meta property="article:tag" content="unit-test"><meta property="article:tag" content="spock"><meta property="article:tag" content="random"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://e.printstacktrace.blog/images/og/spock-random-tests.jpg"><meta name="twitter:creator" content="@wololock"><script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/"},"headline":"Spock random order of tests - how to?","image":{"@type":"ImageObject","url":"https://e.printstacktrace.blog/images/og/spock-random-tests.jpg"},"datePublished":"2019-04-06T08:52:11.000Z","dateModified":"2019-04-09T06:58:20.000Z","author":{"@type":"Person","name":"Szymon Stepniak"},"publisher":{"@type":"Organization","name":"e.printStackTrace(); // Blog","logo":{"@type":"ImageObject","url":"https://e.printstacktrace.blog/images/site-logo.jpg","height":60,"width":600}},"description":"Spock Framework executes test methods (features) in a single class (specification) in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolation in mind. However, in some cases, we would like to randomize test methods execution. Today we are going to learn how to do it.","keywords":"groovy,junit,unit-test,spock,random"}</script><meta name="generator" content="Hexo 4.2.0"><style>.img-lazyload-container{overflow:hidden;max-width:100%}.img-lazyload-container img{max-width:100%;display:block;height:auto;transition:opacity .5s ease-in-out}.img-lazyload-container img:not([src]){height:0;opacity:0}</style></head><body class="layout-post"><nav class="navbar navbar-default navbar-fixed-top navbar-custom"><div class="container-fluid"><div class="navbar-header"><button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#main-navbar"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><span>e.printStackTrace(); // Blog</span></a></div><div class="collapse navbar-collapse" id="main-navbar"><ul class="nav navbar-nav navbar-right"><li><a href="/archives">Archive</a></li><li><a href="https://github.com/wololock/wololock.github.io" target="_blank" rel="noopener">GitHub</a></li><li><a href="/youtube">YouTube</a></li><li><a class="stack-overflow" href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" target="_blank" rel="noopener"><img class="so-icon" src="/img/so.png"><b class="rep">26,883</b><span class="badges"><span class="gold"><span class="b">●</span><span class="c">9</span></span><span class="silver"><span class="b">●</span><span class="c">61</span></span><span class="bronze"><span class="b">●</span><span class="c">94</span></span></span></a></li></ul></div></div></nav><header class="header-section"><div class="intro-header" style="background-image:url(/images/spock-random-tests-bg.jpg)"><div class="container"><div class="row"><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><div class="post-heading"><a class="category" href="/groovy-cookbook/">Groovy Cookbook</a><h1>Spock random order of tests - how to?</h1><div class="post-meta"><ul><li><time datetime="2019-04-06T08:52:11.000Z" itemprop="datePublished">Apr 6, 2019</time></li><li>5 minutes read</li><li><a href="https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/#disqus_thread">0 Comments</a></li></ul><section class="post-tags"><ul class="tags"><li><a class="tag post-meta" href="/t/groovy/">groovy</a></li><li><a class="tag post-meta" href="/t/junit/">junit</a></li><li><a class="tag post-meta" href="/t/unit-test/">unit-test</a></li><li><a class="tag post-meta" href="/t/spock/">spock</a></li><li><a class="tag post-meta" href="/t/random/">random</a></li></ul></section></div></div></div></div></div></div></header><div class="container"><div class="row"><div class="col-lg-10 col-lg-offset-1 col-md-10 col-md-offset-1"><article class="blog-post" role="main"><div class="paragraph"><p><a href="http://spockframework.org/" target="_blank" rel="noopener">Spock Framework</a> executes test methods <em>(features)</em> in a single class <em>(specification)</em> in the declaration order. There is nothing wrong in this default behavior - we should write tests with their isolation in mind. However, in some cases, we would like to randomize test methods execution. Today we are going to learn how to do it.</p></div><a id="more"></a><div class="sect1"><h2 id="introduction">Introduction</h2><div class="sectionbody"><div class="paragraph"><p>Let&#8217;s start with a reasonably simple specification that prints a number to the console.</p></div><div class="listingblock"><div class="title">Listing 1. src/test/groovy/com/github/wololock/RandomSpockSpec.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololock

import spock.lang.Specification

class RandomSpockSpec extends Specification {

    def "test 1"() {
        when:
        def number = 1

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 2"() {
        when:
        def number = 2

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 3"() {
        when:
        def number = 3

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 4"() {
        when:
        def number = 4

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 5"() {
        when:
        def number = 5

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }
}</code></pre></div></div><div class="paragraph"><p>When we execute this specification, we get all numbers printed in the ascending order.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/spock-random-tests-01.jpg"><div class="img-lazyload-container" style="width:989px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/spock-random-tests-01.jpg" height="266" width="989" style="padding-top:26.895854398382202%"></div></a></div></div></div></div><div class="admonitionblock note"><table><tr><td class="icon"><i class="fa icon-note" title="Note"></i></td><td class="content">You can find the source code of this example in the <a href="https://github.com/wololock/spock-random-order-demo" target="_blank" rel="noopener">following repository</a>.</td></tr></table></div></div></div><div class="sect1"><h2 id="forcing-random-order">Forcing random order</h2><div class="sectionbody"><div class="paragraph"><p>Now let&#8217;s try to randomize the execution order. One way to do it is to use Spock&#8217;s extensions - an <a href="http://spockframework.org/spock/docs/1.1/extensions.html#_annotation_driven_local_extensions" target="_blank" rel="noopener">annotation-driven local extensions</a> in this case. Let&#8217;s create a new annotation called <code>@RandomizedOrder</code> with the following content.</p></div><div class="listingblock"><div class="title">Listing 2. src/test/groovy/com/github/wololock/RandomizedOrder.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololock

import org.spockframework.runtime.extension.ExtensionAnnotation

import java.lang.annotation.ElementType
import java.lang.annotation.Retention
import java.lang.annotation.RetentionPolicy
import java.lang.annotation.Target

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@ExtensionAnnotation(RandomizedOrderExtension)
@interface RandomizedOrder {}</code></pre></div></div><div class="paragraph"><p>After creating annotation interface, we can create the extension class. This class implements <code>visitSpecAnnotation</code> interceptor method that gets executed right before specification executes any feature.</p></div><div class="listingblock"><div class="title">Listing 3. src/test/groovy/com/github/wololock/RandomizedOrderExtension.groovy</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololock

import org.spockframework.runtime.extension.AbstractAnnotationDrivenExtension
import org.spockframework.runtime.model.SpecInfo

final class RandomizedOrderExtension extends AbstractAnnotationDrivenExtension&lt;RandomizedOrder&gt; {

    public static final String SPOCK_RANDOM_ORDER_SEED = "spock.random.order.seed"

    private static final long seed = System.getProperty(SPOCK_RANDOM_ORDER_SEED)?.toLong() ?: System.nanoTime()

    static {
        println "Random seed used: ${seed}\nYou can re-run the test with predefined seed by passing -D${SPOCK_RANDOM_ORDER_SEED}=${seed}\n\n"
    }

    @Override
    void visitSpecAnnotation(RandomizedOrder annotation, SpecInfo spec) {
        final Random random = new Random(seed) <i class="conum" data-value="1"></i><b>(1)</b>

        final List&lt;Integer&gt; order = (0..(spec.features.size())) as ArrayList <i class="conum" data-value="2"></i><b>(2)</b>

        Collections.shuffle(order, random) <i class="conum" data-value="3"></i><b>(3)</b>

        spec.features.each { feature -&gt;
            feature.executionOrder = order.pop() <i class="conum" data-value="4"></i><b>(4)</b>
        }
    }
}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>We want to be able to reproduce issues, so we support <code>-Dspock.random.order.seed</code> parameter which allows us to provide a predefined seed value. For instance, running the test with the parameter <code>-Dspock.random.order.seed=42</code> will always produce the same methods orders permutation.</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>A list of all possible orders (0..n).</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Here we shuffle the list to get its random permutation.</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>For each feature method iterated in the declaration order we assign a unique order popped from the shuffled list.</td></tr></table></div><div class="paragraph"><p>This way we override the default execution order of each feature. By default, every feature uses execution order set based on the declaration order. <em>(The first method gets <code>executionOrder == 0</code>, the second one gets <code>executionOrder == 1</code> and so on.)</em></p></div><div class="paragraph"><p>The last thing we need to do is to add <code>@RandomizedOrder</code> annotation to our specification class.</p></div><div class="listingblock"><div class="title">Listing 4. <code>@RandomizedOrder</code> annotationed specification class</div><div class="content"><pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">package com.github.wololock

import spock.lang.Specification

@RandomizedOrder
class RandomSpockSpec extends Specification {

    def "test 1"() {
        when:
        def number = 1

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 2"() {
        when:
        def number = 2

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 3"() {
        when:
        def number = 3

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 4"() {
        when:
        def number = 4

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }

    def "test 5"() {
        when:
        def number = 5

        then:
        println "[${new Date().format("HH:mm:ss.SSS")}] number ${number}"
    }
}</code></pre></div></div><div class="paragraph"><p>We are ready to run the test now. Let&#8217;s see if the execution order has changed.</p></div><div class="openblock text-center"><div class="content"><div class="imageblock img-responsive img-thumbnail"><div class="content"><a class="image" href="/images/spock-random-tests-02.jpg"><div class="img-lazyload-container" style="width:1251px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==);background-repeat:no-repeat;background-position:center"><img data-original="/images/spock-random-tests-02.jpg" height="303" width="1251" style="padding-top:24.22062350119904%"></div></a></div></div></div></div><div class="paragraph"><p><strong>It worked!</strong> We can see that in the above example the execution order was: Test 4, Test 3, Test 5, Test&nbsp;1, and Test 2. And what&#8217;s even more important - the solution is simple and clean.</p></div></div></div><div class="sect1"><h2 id="why-the-random-execution">Why the random execution?</h2><div class="sectionbody"><div class="paragraph"><p>Is there any specific reason to run tests in the random order? It depends. In general, every feature in the specification should live in <strong>isolation</strong>. It means that it <strong>should not depend on any side effects or any state</strong>, and should not cause any side effects either. <em>(If we need to rely on specific state and order, Spock&#8217;s <code>@Stepwise</code> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> and <code>@Shared</code> <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> annotations are our best friends.)</em> If we follow this rule, it doesn&#8217;t matter in which order the specification executes all features. However, sometimes we have to jump into the ongoing project, and we have to deal with existing unit tests we didn&#8217;t see before. Switching to a random order execution in the unit tests might help us verifying if they are correctly written. <em>(We can also use Spock&#8217;s <a href="http://spockframework.org/spock/docs/1.1/extensions.html#_global_extensions" target="_blank" rel="noopener">Global Extension</a> mechanism to add the new extension without annotating classes - might be useful if we have tons of test classes to deal with.)</em> In other cases, we might also benefit from the random execution order as a safeguard that always forces us (and our teammates) to write tests that are isolated and atomic.</p></div><br><div class="row"><div class="col-md-10 col-md-offset-1"><div class="video-container"><iframe width="560" height="315" src="https://www.youtube.com/embed/lwlfUGkTf8c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div></div><h2 id="thank-you" class="discrete">Thank you!</h2><div class="paragraph"><p>If you read up to this point - leave me a comment below, so I can <strong>thank you</strong> in person for such an engagement. You can also share this blog post on <span class="icon color-twitter"><i class="fa fa-twitter"></i></span> <a href="https://twitter.com/intent/tweet?text=%22Spock%20random%20order%20of%20tests%20-%20how%20to?%22%20https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/%20via%20@wololock" target="_blank" rel="noopener">Twitter</a>, <span class="icon color-facebook"><i class="fa fa-facebook-square"></i></span> <a href="https://www.facebook.com/sharer/sharer.php?u=https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/&t=Spock%20random%20order%20of%20tests%20-%20how%20to?" target="_blank" rel="noopener">Facebook</a>, or <span class="icon color-linkedin"><i class="fa fa-linkedin-square"></i></span> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://e.printstacktrace.blog/spock-random-order-of-tests-how-to/&title=Spock%20random%20order%20of%20tests%20-%20how%20to?" target="_blank" rel="noopener">LinkedIn</a> if you think other people can benefit from reading it. Thanks in advance!</p></div><div class="paragraph"><p>PS: Creating high-quality content takes a lot of time and effort. I want to deliver the best possible value to my readers and keep the blog always <strong>ad-free</strong>. If you have two more minutes, please take a look at this dedicated page where I listed a few different options to <a href="https://e.printstacktrace.blog/support-me" class="ga-track">support my efforts</a>. If my vision for the <em>e.printstacktrace.blog</em> development resonates with you, I will be grateful if you consider supporting me in this journey. <strong>Thank you! <span class="icon color-red"><i class="fa fa-heart"></i></span></strong></p></div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"><a href="#_footnoteref_1">1</a>. <a href="http://spockframework.org/spock/javadoc/1.1/spock/lang/Stepwise.html" target="_blank" rel="noopener" class="bare">http://spockframework.org/spock/javadoc/1.1/spock/lang/Stepwise.html</a></div><div class="footnote" id="_footnotedef_2"><a href="#_footnoteref_2">2</a>. <a href="http://spockframework.org/spock/javadoc/1.1/spock/lang/Shared.html" target="_blank" rel="noopener" class="bare">http://spockframework.org/spock/javadoc/1.1/spock/lang/Shared.html</a></div></div><footer class="post-footer"><img class="img-responsive img-circle" src="https://www.gravatar.com/avatar/b22c1842c6e8f7f2b9b3ed8c0d4efb4d?s=200"><div class="row author"><div class="col-lg-8 col-lg-offset-2 col-xs-10 col-xs-offset-1"><h4>Szymon Stepniak</h4><p><a class="stack-overflow" href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" target="_blank" rel="noopener"><img class="so-icon" src="/img/so.png"><b class="rep">26,883</b><span class="badges"><span class="gold"><span class="b">●</span><span class="c">9</span></span><span class="silver"><span class="b">●</span><span class="c">61</span></span><span class="bronze"><span class="b">●</span><span class="c">94</span></span></span></a></p><p>Groovista, Upwork's Top Rated freelancer, Toruń Java User Group founder, open&nbsp;source contributor, Stack Overflow addict, bedroom guitar player. I walk through e.printStackTrace() so you don't have to.</p><ul class="social-links"><li><a href="https://feeds.feedburner.com/Eprintstacktracenet" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-rss"></span></a></li><li><a href="https://twitter.com/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-twitter"></span></a></li><li><a href="https://github.com/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-github"></span></a></li><li><a href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-stack-overflow"></span></a></li><li><a href="https://www.youtube.com/c/eprintstacktrace" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-youtube"></span></a></li><li><a href="mailto:szymon.stepniak@gmail.com" onclick="return window.open(this.href),!1"><span class="fa fa-envelope"></span></a></li><li><a href="https://www.linkedin.com/in/szymon-stępniak-9a0b1630" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-linkedin"></span></a></li><li><a href="https://keybase.io/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-user-secret"></span></a></li></ul></div></div></footer><section class="related-posts"><h2>You may also like</h2><div class="row"><div class="col-lg-4"><a href="/how-to-avoid-no-tests-were-found-when-using-junit5-with-groovy/"><img class="img-responsive" src="/images/og/groovy-junit5.jpg"><h3>How to avoid "No tests were found" when using JUnit 5 with Groovy?</h3></a><p>In this short blog post I would like to explain how to avoid popular mistake when you write your first JUnit 5 test case in Groovy.</p></div><div class="col-lg-4"><a href="/ratpack-mocking-Session-object-in-GroovyRequestFixture-test/"><img class="img-responsive" src="/images/og/ratpack-mocking-session.jpg"><h3>Ratpack: mocking Session object in GroovyRequestFixture test</h3></a><p>Ratpack allows you unit test handlers using GroovyRequestFixture class. The good thing about this approach is that it does not require running the whole application and you can quickly test if the ...</p></div><div class="col-lg-4"><a href="/ratpack-register-session-module-in-handler-unit-test/"><img class="img-responsive" src="/images/og/ratpack-session-module.jpg"><h3>Ratpack: register SessionModule in handler unit test</h3></a><p>Unit testing Ratpack handlers has many benefits. In the previous post we have learned how to mock Session object to use it with GroovyRequestFixture. Today instead of mocking we will register Sessi...</p></div></div></section></article><nav class="pagination" role="pagination"><a class="pull-left btn" href="/debugging-teams-book-review/">← Next post</a><a class="pull-right btn" href="/graalvm-heap-size-of-native-image-how-to-set-it/">Previous post →</a></nav><div class="disqus-comments"><div class="comments"><div id="disqus_thread"></div></div></div><script>var url_parts=window.location.href.split("?"),disqus_url=url_parts[0];!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//eprintstacktrace.disqus.com/embed.js",(document.head||d.body).appendChild(t)}()</script></div></div></div><script async id="dsq-count-scr" src="//eprintstacktrace.disqus.com/count.js"></script><footer class="site-footer"><div class="container-fluid"><div class="row"><div class="col-lg-10 col-lg-offset-1 col-xs-10 col-xs-offset-1"><div class="row"><div class="col-lg-4"><h4 class="marked">Recent video on YouTube</h4><section class="recent-posts"><a href="https://www.youtube.com/watch?v=APZhRF-sfqg" target="_blank" rel="noopener"><img class="img-thumbnail img-noborder" src="https://i3.ytimg.com/vi/APZhRF-sfqg/mqdefault.jpg" alt="型 Clojure Programming Kata: threading macro, binary string, maps"></a></section><h4>e.printstacktrace.blog © 2020</h4><p><em>"I walk through e.printStackTrace() so you don't have to"</em></p></div><div class="col-lg-4"><h4 class="marked">Recent articles</h4><section class="recent-posts"><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/how-to-time-out-jenkins-pipeline-stage-and-keep-the-pipeline-running/">How to time out Jenkins Pipeline stage and keep the pipeline running?</a></li><li class="post-list-item"><a class="post-list-link" href="/my-first-200-youtube-subscribers-thank-you/">My first 200 YouTube subscribers - Thank You!</a></li><li class="post-list-item"><a class="post-list-link" href="/groovy-dynamic-maps-generic-type-erasure-and-raw-types/">Groovy dynamic Maps, generic type erasure, and raw types - an interesting use case to learn from</a></li><li class="post-list-item"><a class="post-list-link" href="/groovy-3-nullcheck-annotation-less-code-and-less-npe/">Groovy 3 @NullCheck annotation - less code and less NPE</a></li><li class="post-list-item"><a class="post-list-link" href="/groovy-3-string-gdk-improvements-takeright-takebetween-and-a-few-others/">Groovy 3 String GDK improvements - takeRight, takeBetween, and a few others</a></li><li class="post-list-item"><a class="post-list-link" href="/jenkins-scripted-pipeline-vs-declarative-pipeline-the-4-practical-differences/">Jenkins Scripted Pipeline vs. Declarative Pipeline - the 4 practical differences</a></li></ul></section></div><div class="col-lg-4"><h4 class="marked">Stay connected</h4><div class="social-links"><ul><li><a href="https://feeds.feedburner.com/Eprintstacktracenet" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-rss"></span></a></li><li><a href="https://twitter.com/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-twitter"></span></a></li><li><a href="https://github.com/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-github"></span></a></li><li><a href="https://stackoverflow.com/users/2194470/szymon-stepniak?tab=profile" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-stack-overflow"></span></a></li><li><a href="https://www.youtube.com/c/eprintstacktrace" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-youtube"></span></a></li><li><a href="mailto:szymon.stepniak@gmail.com" onclick="return window.open(this.href),!1"><span class="fa fa-envelope"></span></a></li><li><a href="https://www.linkedin.com/in/szymon-stępniak-9a0b1630" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-linkedin"></span></a></li><li><a href="https://keybase.io/wololock" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><span class="fa fa-user-secret"></span></a></li></ul></div><h4 class="marked">Most popular tags</h4><section class="tagcloud"><a href="/t/affiliate/" style="font-size:12pt;color:#777">affiliate</a> <a href="/t/benchmark/" style="font-size:12pt;color:#777">benchmark</a> <a href="/t/book/" style="font-size:16pt;color:#858585">book</a> <a href="/t/cicd/" style="font-size:24pt;color:#9f9f9f">cicd</a> <a href="/t/devops/" style="font-size:12pt;color:#777">devops</a> <a href="/t/docker/" style="font-size:12pt;color:#777">docker</a> <a href="/t/github/" style="font-size:8pt;color:#6a6a6a">github</a> <a href="/t/graalvm/" style="font-size:24pt;color:#9f9f9f">graalvm</a> <a href="/t/groovy/" style="font-size:32pt;color:#bababa">groovy</a> <a href="/t/haskell/" style="font-size:8pt;color:#6a6a6a">haskell</a> <a href="/t/java/" style="font-size:28pt;color:#adadad">java</a> <a href="/t/java-8/" style="font-size:8pt;color:#6a6a6a">java-8</a> <a href="/t/jenkins/" style="font-size:20pt;color:#929292">jenkins</a> <a href="/t/jenkins-pipeline/" style="font-size:20pt;color:#929292">jenkins-pipeline</a> <a href="/t/jmh/" style="font-size:16pt;color:#858585">jmh</a> <a href="/t/junit/" style="font-size:8pt;color:#6a6a6a">junit</a> <a href="/t/micronaut/" style="font-size:12pt;color:#777">micronaut</a> <a href="/t/native-image/" style="font-size:12pt;color:#777">native-image</a> <a href="/t/non-blocking/" style="font-size:12pt;color:#777">non-blocking</a> <a href="/t/ratpack/" style="font-size:24pt;color:#9f9f9f">ratpack</a> <a href="/t/reading/" style="font-size:8pt;color:#6a6a6a">reading</a> <a href="/t/review/" style="font-size:16pt;color:#858585">review</a> <a href="/t/sdkman/" style="font-size:12pt;color:#777">sdkman</a> <a href="/t/spock/" style="font-size:12pt;color:#777">spock</a> <a href="/t/unit-test/" style="font-size:12pt;color:#777">unit-test</a></section></div></div></div></div><div class="row"><div class="col-lg-10 col-lg-offset-1 col-xs-10 col-xs-offset-1 text-center"><ul class="footer-links"><li><a href="/privacy-policy/">Privacy policy</a></li><li><a href="/support-me/">Support me</a></li><li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener"><img src="https://badgen.net/badge/license/CC%20BY-NC-SA%204.0/gray"></a></li><li><a href="https://github.com/wololock/wololock.github.io/commits/develop" target="_blank" rel="noopener"><img src="https://badgen.net/github/last-commit/wololock/wololock.github.io?color=blue"></a></li></ul></div></div></div><section class="poweredby"><ul class="text-center"><li><span>Published with </span><a href="https://hexo.io" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><img src="/img/logo-hexo.png"></a></li><li><span>Hosted on </span><a href="https://github.com/wololock/wololock.github.io" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><img src="/img/logo-github.png"></a></li><li><span>Deployed with </span><a href="https://circleci.com/gh/wololock/wololock.github.io" target="_blank" rel="noopener" onclick="return window.open(this.href),!1"><img src="/img/logo-circleci.png"></a></li></ul></section></footer><script async src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script async src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script async id="cookiebanner" src="//cdnjs.cloudflare.com/ajax/libs/cookie-banner/1.2.2/cookiebanner.min.js" data-moreinfo="/privacy-policy/" data-message="This blog uses cookies to enhance your experience. By continuing to visit it you agree to its use of cookies." data-link="#ffad33" data-font-family="Lora,serif" data-font-size="1.6rem" data-bg="#444"></script><script src="/js/main.js?v=5"></script><script src="/js/highlight.pack.js?v=9.18.1"></script><script>hljs.initHighlightingOnLoad()</script><script>"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname&&(!function(a,e,t,n,o,c,i){a.GoogleAnalyticsObject=o,a.ga=a.ga||function(){(a.ga.q=a.ga.q||[]).push(arguments)},a.ga.l=1*new Date,c=e.createElement(t),i=e.getElementsByTagName(t)[0],c.async=1,c.src="//www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-42400890-5","auto"),ga("send","pageview"),jQuery("a.ga-track").click(function(a){var e=jQuery(a.target).text();return ga("send","event","affiliate","click",e),!0}))</script><script>!function(){"use strict";function r(e){var t=e.getAttribute("data-original"),n=new Image;n.onload=function(){e.setAttribute("src",t),e.style.paddingTop=""},n.src=t}document.addEventListener("DOMContentLoaded",function(){var t,e,n,i=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));i.length&&("undefined"!=typeof IntersectionObserver?(t=new IntersectionObserver(function(e,t){e.filter(function(e){return e.isIntersecting}).forEach(function(e){r(e.target),t.unobserve(e.target)})}),i.forEach(function(e){t.observe(e)})):(n=function(){clearTimeout(e),e=setTimeout(function(){if(!(i=i.filter(function(e){return!e.src})).length)return window.removeEventListener("scroll",n),void window.removeEventListener("resize",n);i.filter(function(e){e.getBoundingClientRect().top<window.innerHeight&&r(e)})},100)},window.addEventListener("scroll",n),window.addEventListener("resize",n),n()))},!1)}();</script></body></html>